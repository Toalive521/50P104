Tue Aug 20 18:43:18 2024
-------------------------
CAS V2.15.1-rc1 - (C) Copyright 2000-2012 CHIPMAST TECHNOLOGY CO. LTD.
Main file   : main.asm
Current file: main.asm

     1                        ;********************************************************
     2                        .CHIP           W65C02S
     3                        ;.INCLIST        ON
     4                        .MACLIST        ON
     5                        ;********************************************************
     6                        ;Project Name:
     7                        ;CPU
     8                        ;Start  Date:
     9                        ;Finish Date:
    10                        ;********************************************************
    11                        
    12                        ;********************************************************
    13                        CODE_BEG        EQU     0F000H
    14                        ;********************************************************
    15                        
    16                        ;********************************************************
    17                        PROG    SECTION OFFSET  CODE_BEG
    18                        ;********************************************************
    19                        
    20                        ;********************************************************
    21                        ; header include
    22                        ;********************************************************
    23                        ;.INCLUDE 50X105.H
    24                        .INCLUDE 50P104.H
     1                        ;***********************************************************************
     2                        	.PAGE0
     3                        	.ORG	00H
     4                        
     5                        P_PA		EQU		01H		;Default: 1111 11--B
     6                        PA			EQU		01H
     7                        P_PA_WAKE	EQU		02H		;Default: 0000 00--B
     8                        P_PAWAKE	EQU		02H
     9                        P_PA_IO		EQU		04H		;Default: 1111 11--B
    10                        PAIO		EQU		04H
    11                        P_PADIR		EQU		04H
    12                        PADIR		EQU		04H
    13                        P_PA_DIR	EQU		04H
    14                        
    15                        P_PB		EQU		05H		;Default: ----00---B
    16                        P_PB_TYPE	EQU		06H		;Default: ----11---B, CMOS output
    17                        P_PBTYPE	EQU		06H
    18                        
    19                        P_PC		EQU		07H		;Default: 1111 1111B, Pull High
    20                        PC			EQU		07H
    21                        P_PC_IO		EQU		08H		;Default: 1111 1111B, Input
    22                        P_PC_DIR	EQU		P_PC_IO
    23                        P_PCDIR		EQU		08H
    24                        PCDIR		EQU		08H
    25                        
    26                        P_PCSEG		EQU		09H		;Default: --00 ----B, PC76,PC54
    27                        
    28                        P_PD		EQU		0AH
    29                        P_PDDIR		EQU		0BH
    30                        
    31                        P_PADF0		EQU		0CH		;Default: ---- --0-B, PB3S
    32                        
    33                        P_PADF1		EQU		0DH
    34                        
    35                        P_IER		EQU		0EH		;Default: -0-0 -000B
    36                        P_IFR		EQU		0FH		;Default: -0-0 -000B
    37                        bDIVF	    EQU	   0
    38                        bTMR0F      EQU	   1
    39                        bTMR1F      EQU	   2
    40                        bTMR2F      EQU	   3
    41                        bPAF        EQU	   4
    42                        bLCDF       EQU	   6
    43                        
    44                        P_TMR0		EQU		10H		;Default: xxH
    45                        P_TMR1H		EQU		12H		;Default: xxH
    46                        P_TMR1		EQU		P_TMR1H
    47                        P_TMR2		EQU		14H
    48                        
    49                        P_TMRCTRL	EQU		16H		;Default: 0--0 --00B
    50                        bTMR0ON    	EQU	   0
    51                        bTMR1ON    	EQU	   1
    52                        bLCDON	   	EQU	   4
    53                        bAUDON	   	EQU	   7
    54                        P_TMRC		EQU		16H
    55                        
    56                        P_TMRCLK	EQU		17H		;Default: ---- xx--B
    57                        P_TMCLK		EQU		17H
    58                        
    59                        P_DIVC		EQU		18H		;Default: ---0 xx--B
    60                        
    61                        P_LCDCTRL	EQU		19H		;default: 0--- --11B
    62                        LCDCTRL		EQU		19H
    63                        
    64                        P_LCD_COM	EQU		1AH		;Default: 0--- --xxB
    65                        P_LCDCOM	EQU		1AH
    66                        
    67                        P_WDTC		EQU		1CH
    68                        
    69                        P_SYSCLK	EQU		1DH		;Default: 0--- -101B, Fcpu=Fsys,Fosc ON,Fext OFF,SubClk strong start
    70                        
    71                        P_HALT		EQU		1EH
    72                        
    73                        P_AUD		EQU		1FH		;Default: xxxx xxxxB
    74                        P_AUD0		EQU		1FH
    75                        
    76                        P_AUD_CTL	EQU		20H		;Default: ---- -x--B
    77                        P_AUDCR		EQU		P_AUD_CTL
    78                        
    79                        P_MF0		EQU		2FH
    80                        P_LVC		EQU		3DH
    81                        P_FUSE0		EQU		3EH
    82                        P_FUSE1		EQU		4EH
    83                        P_PDSEG		EQU		5CH
    84                        P_RFCC0		EQU		5DH
    85                        P_RFCC1		EQU		5EH
    86                        P_MF1		EQU		5FH
    87                        	.ENDS
    87                        
    25                        .INCLUDE RAM.inc
     1                        .Kdata
     2                        ;***************************************
     3                        ; RAM Address
     4                        ;***************************************
     5                        BIT0			.EQU	001H
     6                        BIT1			.EQU	002H
     7                        BIT2			.EQU	004H
     8                        BIT3			.EQU	008H
     9                        BIT4			.EQU	010H
    10                        BIT5			.EQU	020H
    11                        BIT6			.EQU	040H
    12                        BIT7			.EQU	080H
    13                        BIT0_			.EQU	0FEH
    14                        BIT1_			.EQU	0FDH
    15                        BIT2_			.EQU	0FBH
    16                        BIT3_			.EQU	0F7H
    17                        BIT4_			.EQU	0EFH
    18                        BIT5_			.EQU	0DFH
    19                        BIT6_			.EQU	0BFH
    20                        BIT7_			.EQU	07FH
    21                        
    22                        RamStarAddr		EQU		1800H
    23                        LCD_RamAddr		EQU		RamStarAddr
    24                        Time_Addr		EQU     RamStarAddr+Time_str_Addr-Page0RamStarAddr
    25                        
    26                        StwFlag_Addr	EQU		RamStarAddr+Stw_Flag_Addr-Page0RamStarAddr
    27                        StwSec_Addr		EQU		RamStarAddr+Stw_Sec_Addr-Page0RamStarAddr
    28                        StwMin_Addr		EQU		RamStarAddr+Stw_Min_Addr-Page0RamStarAddr
    29                        StwHr_Addr		EQU		RamStarAddr+Stw_Hr_Addr-Page0RamStarAddr
    30                        StwSecSpl_Addr	EQU		RamStarAddr+Stw_Sec_Spl_Addr-Page0RamStarAddr
    31                        StwMinSpl_Addr	EQU		RamStarAddr+Stw_Min_Spl_Addr-Page0RamStarAddr
    32                        StwHrSpl_Addr	EQU		RamStarAddr+Stw_Hr_Spl_Addr-Page0RamStarAddr
    33                        
    34                        DigitStr		EQU		1
    35                        Digit1			EQU		DigitStr+0
    36                        Digit2			EQU		DigitStr+1
    37                        Digit3			EQU		DigitStr+2
    38                        Digit4			EQU		DigitStr+3
    39                        Digit5			EQU		DigitStr+4
    40                        Digit6			EQU		DigitStr+5
    41                        
    42                        2Digit1			EQU		DigitStr+0
    43                        2Digit2			EQU		DigitStr+1
    44                        2Digit3			EQU		DigitStr+2
    45                        2Digit4			EQU		DigitStr+3
    46                        2Digit5			EQU		DigitStr+4
    47                        2Digit6			EQU		DigitStr+5
    48                        
    49                        3Digit1			EQU		DigitStr+12
    50                        3Digit2			EQU		DigitStr+13
    51                        3Digit3			EQU		DigitStr+14
    52                        3Digit4			EQU		DigitStr+15
    53                        3Digit5			EQU		DigitStr+16
    54                        3Digit6			EQU		DigitStr+17
    55                        
    56                        D_ExitSetTime	EQU		20
    57                        ;***************************************
    58                        .PAGE0
    59                        ;***************************************
    60                        	ORG	0080H
    61                        Page0RamStarAddr	EQU		$
    62 00:0080: xx xx xx xx   LCDRAM			DS		4*6
    62 00:0080: xx xx xx xx   
    62 00:0080: xx xx xx xx   
    63 00:0098: xx            R_Int_Backup	DS		1
    64 00:0099: xx            Sys_Flag_A	 DS		1
    65                        ;bit0 = 2HZ
    66                        ;bit1 =	1HZ
    67                        ;bit2 = 32HZ
    68                        ;bit3 =
    69                        ;bit4 = 标记PA2按键是否按下
    70                        ;bit5 =
    71                        ;bit6 =	标记PA5按键是否按下
    72                        ;bit7 =	标记PA7按键是否按下
    73                        
    74 00:009A: xx            Sys_Flag_B		DS	1
    75                        ;bit0 = 时间/计时  0：时间  1：计时
    76                        ;bit1 = 计时开始/暂停  0：暂停  1：开始
    77                        ;bit2 =	正计时/倒计时  0:正计时 1：倒计时
    78                        ;bit3 = 0-未结束   1-结束
    79                        ;bit4 =
    80                        ;bit5 = 12/24HR	0：24Hr  1:12hr
    81                        ;bit6 =
    82                        ;bit7 =
    83                        
    84 00:009B: xx            Sys_Flag_C		DS	1
    85                        ;bit0 = 	快加/快减标志
    86                        ;bit1 =
    87                        ;bit2 =
    88                        ;bit3 =
    89                        ;bit4 =
    90                        ;bit5 =
    91                        ;bit6 =
    92                        ;bit7 =
    93                        
    94 00:009C: xx            Sys_Flag_D		DS	1
    95                        ;bit0 =
    96                        ;bit1 =
    97                        ;bit2 =
    98                        ;bit3 =
    99                        ;bit4 =
   100                        ;bit5 =
   101                        ;bit6 =
   102                        ;bit7 =
   103                        
   104 00:009D: xx            R_Key_Flag		DS	1
   105                        ;bit0=	SATART_KEY HOLD
   106                        ;bit1=	UP_KEY HOLD
   107                        ;bit2=	DOWN_KEY HOLD
   108                        ;bit3=	判断是否有任意键按下过
   109                        ;bit4=
   110                        ;bit5=
   111                        ;bit6=
   112                        ;bit7=
   113                        
   114                        
   115                        Stw_Flag_Addr 	.EQU  $
   116 00:009E: xx xx         R_Stw_Flag		DS	2
   117                        ;bit0=
   118                        ;bit1=
   119                        ;bit2=
   120                        ;bit3=
   121                        ;bit4=
   122                        ;bit5=
   123                        ;bit6=
   124                        ;bit7=
   125                        
   126 00:00A0: xx            R_Day_Flag		DS	1	;
   127                        ;bit0=
   128                        ;bit1=
   129                        ;bit2=
   130                        ;bit3=
   131                        ;bit4=
   132                        ;bit5=
   133                        ;bit6=
   134                        ;bit7=
   135                        
   136 00:00A1: xx            R_Set_Flag		DS	1	;
   137                        ;bit0=
   138                        ;bit1=
   139                        ;bit2=
   140                        ;bit3=
   141                        ;bit4=
   142                        ;bit5=
   143                        ;bit6=
   144                        ;bit7=
   145 00:00A2: xx            R_No_Key		DS	1	;
   146                        ;bit0=
   147                        ;bit1=
   148                        ;bit2=
   149                        ;bit3=
   150                        ;bit4=
   151                        ;bit5=
   152                        ;bit6=
   153                        ;bit7=
   154 00:00A3: xx            R_STW_Key		DS	1
   155 00:00A4: xx            R_Mode_Flag		DS	1
   156                        ;bit0= 0：正计时/1：倒计时
   157                        ;bit1=
   158                        ;bit2=
   159                        ;bit3=
   160                        ;bit4=
   161                        ;bit5=
   162                        ;bit6=
   163                        ;bit7=
   164                        
   165                        ;;计时
   166 00:00A5: xx            R_CtwTime_Min	DS	1
   167 00:00A6: xx            R_CtwTime_Sec	DS	1
   168                        
   169                        
   170                        Time_str_Addr		.EQU  $
   171 00:00A7: xx            R_Time_Min			DS	1
   172 00:00A8: xx            R_Time_Sec			DS	1
   173 00:00A9: xx            R_Time_Hr			DS	1
   174                        
   175 00:00AA: xx            R_Stw_Mode		DS  1
   176                        D_Stw			.EQU  0
   177                        D_Stw2		    .EQU  1
   178                        
   179                        Stw_Sec_Addr	.equ	$
   180 00:00AB: xx            R_Stw_Sec		DS	1
   181                        Stw_Min_Addr	.equ	$
   182 00:00AC: xx            R_Stw_Min	   	DS	1
   183                        Stw_Hr_Addr		.equ	$
   184 00:00AD: xx            R_Stw_Hr		DS	1
   185                        
   186 00:00AE: xx            R_Mode			DS	1
   187 00:00AF: xx            R_Set			DS	1
   188                        D_Time_Mode		.equ	0
   189                        D_Stw_Mode		.equ	1
   190                        D_Al_Mode		.equ	2
   191                        ;D_Al2_Mode		.equ	3
   192                        ;D_StwDay_Mode	.equ	4
   193                        D_Max_Mode		.equ	2+1
   194                        
   195                        Stw_Sec_Spl_Addr		.equ	$
   196 00:00B0: xx xx         R_Stw_Sec_Spl   DS	2
   197                        Stw_Min_Spl_Addr		.equ	$
   198 00:00B2: xx xx         R_Stw_Min_Spl   DS	2
   199                        Stw_Hr_Spl_Addr		.equ	$
   200 00:00B4: xx xx         R_Stw_Hr_Spl    DS	2
   201                        
   202 00:00B6: xx            R_Al_Sec_Spl   	DS	1
   203 00:00B7: xx            R_Al_Min_Spl   	DS	1
   204                        
   205 00:00B8: xx            R_Al_Sec		DS	1
   206 00:00B9: xx            R_Al_Min		DS	1
   207 00:00BA: xx            R_Al_Hr			DS	1
   208                        
   209 00:00BB: xx            R_Alarm_Mode	DS	1
   210 00:00BC: xx            R_Beep_Time		DS	1
   211 00:00BD: xx            R_Voice_Unit	DS	1
   212 00:00BE: xx            R_KeyHold_Time	DS	1
   213 00:00BF: xx            R_Fast_Time		DS	1
   214                        C_Fast_Time		.EQU  32/8
   215                        
   216 00:00C0: xx            R_Key	DS	1
   217                        
   218 00:00C1: xx            R_Num			DS	1
   219                        ;---------------------------------------
   220                        ;---------------------------------------
   221 00:00C2: xx xx xx xx   P_Temp			DS	8
   221 00:00C2: xx xx xx xx   
   222                        R_Temp				.equ	P_Temp
   223 00:00CA: xx            P_Num			DS	1
   224                        
   225 00:00CB: xx            PADIR_TEMP		DS	1
   226 00:00CC: xx            PA_TEMP			DS	1
   227 00:00CD: xx            PCDIR_TEMP		DS	1
   228 00:00CE: xx            PC_TEMP			DS	1
   229                        
   230 00:00CF: xx            R_KeyValue		DS	1
   231                        ;***************************************
   232                        .ENDS
   233                        ;***************************************
   234                        ;.Udata
   235                        ;;---------------------------------------
   236                        ;	ORG    1800H
   237                        ;
   238                        ;;---------------------------------------
   239                        ;	ORG    1847H
   240                        ;;---------------------------------------
   241                        ;.ENDS
   241                        
    26                        .INCLUDE MACRO.MAC
     1                        ;***********************************************************************
     2                        JMP_IDX MACRO	MEM
     3                        	if	MEM<$100
     4                        	JMP	($80+MEM)
     5                        	else
     6                        	JMP	(MEM)
     7                        	endif
     8                        	ENDM
     9                        ;*************************************
    10                        LDLN	MACRO	mem
    11                        	if	mem<$100
    12                        	LDA	mem-$40
    13                        	else
    14                        	LDA	mem-$60
    15                        	endif
    16                        	ENDM
    17                        
    18                        LDHN	MACRO	mem
    19                        	if	mem<$100
    20                        	LDA	mem-$20
    21                        	else
    22                        	LDA	men-$40
    23                        	endif
    24                        	ENDM
    25                        
    26                        STLN	MACRO	mem
    27                        	if	mem<$100
    28                        	STA	mem-$40
    29                        	else
    30                        	STA	mem-$60
    31                        	endif
    32                        	ENDM
    33                        
    34                        STHN	MACRO	mem
    35                        	if	mem<$100
    36                        	STA	mem-$20
    37                        	else
    38                        	STA	men-$40
    39                        	endif
    40                        	ENDM
    41                        ;************************************
    42                        
    43                        LXLN	MACRO	mem
    44                        	if	mem<$100
    45                        	LDX	$780+mem
    46                        	else
    47                        	LDX	$700+mem
    48                        	endif
    49                        	ENDM
    50                        
    51                        LXHN	MACRO	mem
    52                        	if	mem<$100
    53                        	LDX	$F80+mem
    54                        	else
    55                        	LDX	$F00+mem
    56                        	endif
    57                        	ENDM
    58                        
    59                        SXLN	MACRO	mem
    60                        	if	mem<$100
    61                        	STX	$780+mem
    62                        	else
    63                        	STX	$700+mem
    64                        	endif
    65                        	ENDM
    66                        
    67                        SXHN	MACRO	mem
    68                        	if	mem<$100
    69                        	STX	$F80+mem
    70                        	else
    71                        	STX	$F00+mem
    72                        	endif
    73                        	ENDM
    74                        
    75                        LDLN_X	MACRO	mem
    76                        	if	mem<$100
    77                        	LDA	$780+mem,X
    78                        	else
    79                        	LDA	$700+mem,X
    80                        	endif
    81                        	ENDM
    82                        
    83                        STLN_X	MACRO	mem
    84                        	if	mem<$100
    85                        	STA	$780+mem,X
    86                        	else
    87                        	STA	$700+mem,X
    88                        	endif
    89                        	ENDM
    90                        
    91                        LDHN_X	MACRO	mem
    92                        	if	mem<$100
    93                        	LDA	$F80+mem,X
    94                        	else
    95                        	LDA	$F00+mem,X
    96                        	endif
    97                        	ENDM
    98                        
    99                        STHN_X	MACRO	mem
   100                        	if	mem<$100
   101                        	STA	$F80+mem,X
   102                        	else
   103                        	STA	$F00+mem,X
   104                        	endif
   105                        	ENDM
   106                        
   107                        INCHN_X	MACRO	mem
   108                        	if	mem<$100
   109                        	INC	$F80+mem,X
   110                        	else
   111                        	INC	$F00+mem,X
   112                        	endif
   113                        	ENDM
   114                        
   115                        DECHN_X	MACRO	mem
   116                        	if	mem<$100
   117                        	DEC	$F80+mem,X
   118                        	else
   119                        	DEC	$F00+mem,X
   120                        	endif
   121                        	ENDM
   122                        
   123                        ADCLN	MACRO	mem
   124                        	if	mem<$100
   125                        	ADC	$780+mem
   126                        	else
   127                        	ADC	$700+mem
   128                        	endif
   129                        	ENDM
   130                        
   131                        ADCHN	MACRO	mem
   132                        	if	mem<$100
   133                        	ADC	$F80+mem
   134                        	else
   135                        	ADC	$F00+mem
   136                        	endif
   137                        	ENDM
   138                        
   139                        CMPLN	MACRO	mem
   140                        	if	mem<$100
   141                        	CMP	$780+mem
   142                        	else
   143                        	CMP	$700+mem
   144                        	endif
   145                        	ENDM
   146                        
   147                        CMPHN	MACRO	mem
   148                        	if	mem<$100
   149                        	CMP	$F80+mem
   150                        	else
   151                        	CMP	$F00+mem
   152                        	endif
   153                        	ENDM
   154                        
   155                        
   156                        ;*************************
   157                        ;*************************
   158                        INCLN	MACRO	mem
   159                        	if	mem<$100
   160                        	INC	mem-$40
   161                        	else
   162                        	INC	mem-$60
   163                        	endif
   164                        	ENDM
   165                        
   166                        INCHN	MACRO	mem
   167                        	if	mem<$100
   168                        	INC	mem-$20
   169                        	else
   170                        	INC	mem-$40
   171                        	endif
   172                        	ENDM
   173                        
   174                        DECLN	MACRO	mem
   175                        	if	mem<$100
   176                        	DEC mem-$40
   177                        	else
   178                        	DEC mem-$60
   179                        	endif
   180                        	ENDM
   181                        
   182                        DECHN	MACRO	mem
   183                        	if	mem<$100
   184                        	DEC	mem-$20
   185                        	else
   186                        	DEC	mem-$40
   187                        	endif
   188                        	ENDM
   189                        ;*************************
   190                        ;*************************
   191                        
   192                        
   193                        
   194                        LDA_X	MACRO	mem
   195                        	if	mem<$100
   196                        	LDA	$80+mem,X
   197                        	else
   198                        	LDA	mem,X
   199                        	endif
   200                        	ENDM
   201                        
   202                        STA_X	MACRO	mem
   203                        	if	mem<$100
   204                        	STA	$80+mem,X
   205                        	else
   206                        	STA	mem,X
   207                        	endif
   208                        	ENDM
   209                        
   210                        STZ_X	MACRO	mem
   211                        	if	mem<$100
   212                        	STZ	$80+mem,X
   213                        	else
   214                        	STZ	mem,X
   215                        	endif
   216                        	ENDM
   217                        
   218                        INC_X	MACRO	mem
   219                        	if	mem<$100
   220                        	INC	$80+mem,X
   221                        	else
   222                        	INC	mem,X
   223                        	endif
   224                        	ENDM
   225                        
   226                        ADC_X	MACRO	mem
   227                        	if	mem<$100
   228                        	ADC	$80+mem,X
   229                        	else
   230                        	ADC	mem,X
   231                        	endif
   232                        	ENDM
   233                        
   234                        SBC_X	MACRO	mem
   235                        	if	mem<$100
   236                        	SBC	$80+mem,X
   237                        	else
   238                        	SBC	mem,X
   239                        	endif
   240                        	ENDM
   241                        
   242                        CMP_X	MACRO	mem
   243                        	if	mem<$100
   244                        	CMP	$80+mem,X
   245                        	else
   246                        	CMP	mem,X
   247                        	endif
   248                        	ENDM
   249                        
   250                        ASLLN	MACRO	mem
   251                        	if	mem<$100
   252                        	ASL	$780+mem
   253                        	else
   254                        	ASL	$700+mem
   255                        	endif
   256                        	ENDM
   257                        
   258                        LSRLN	MACRO	mem
   259                        	if	mem<$100
   260                        	LSR	$780+mem
   261                        	else
   262                        	LSR	$700+mem
   263                        	endif
   264                        	ENDM
   265                        
   266                        ROLLN	MACRO	mem
   267                        	if	mem<$100
   268                        	ROL	$780+mem
   269                        	else
   270                        	ROL	$700+mem
   271                        	endif
   272                        	ENDM
   273                        
   274                        RORLN	MACRO	mem
   275                        	if	mem<$100
   276                        	ROR	$780+mem
   277                        	else
   278                        	ROR	$700+mem
   279                        	endif
   280                        	ENDM
   281                        
   282                        ASLHN	MACRO	mem
   283                        	if	mem<$100
   284                        	ASL	$F80+mem
   285                        	else
   286                        	ASL	$F00+mem
   287                        	endif
   288                        	ENDM
   289                        
   290                        LSRHN	MACRO	mem
   291                        	if	mem<$100
   292                        	LSR	$F80+mem
   293                        	else
   294                        	LSR	$F00+mem
   295                        	endif
   296                        	ENDM
   297                        
   298                        ROLHN	MACRO	mem
   299                        	if	mem<$100
   300                        	ROL	$F80+mem
   301                        	else
   302                        	ROL	$F00+mem
   303                        	endif
   304                        	ENDM
   305                        
   306                        RORHN	MACRO	mem
   307                        	if	mem<$100
   308                        	ROR	$F80+mem
   309                        	else
   310                        	ROR	$F00+mem
   311                        	endif
   312                        	ENDM
   313                        
   314                        BR0	MACRO	PARA,VAR,LABLE
   315                        	BBR@<VAR.mod.8> PARA,LABLE
   316                        	ENDM
   317                        
   318                        BR1	MACRO	PARA,VAR,LABLE
   319                        	BBS@<VAR.mod.8>	PARA,LABLE
   320                        	ENDM
   321                        
   322                        xSETB	MACRO	flag,bit
   323                        	SMB@<bit>  flag
   324                        	ENDM
   325                        
   326                        xCLRB	MACRO	flag,bit
   327                        	RMB@<bit>  flag
   328                        	ENDM
   328                        
    27                        ;.INCLUDE 50X105.MAC
    28                        .INCLUDE 50P104.MAC
     1                        ;------------------------------------
     2                        PB2_PB2_CMOS MACRO
     3                                RMB0    P_PADF0
     4                                SMB2    P_PBTYPE ;COMS
     5                                ENDM
     6                        PB2_PB2_NMOS MACRO
     7                                RMB0    P_PADF0
     8                                RMB2    P_PBTYPE ;NOMS
     9                                ENDM
    10                        PB2_PWM MACRO
    11                                SMB0    P_PADF0
    12                                SMB2    P_PBTYPE ;COMS
    13                                ENDM
    14                        
    15                        PB3_PB3_CMOS MACRO
    16                                RMB1    P_PADF0
    17                                SMB3    P_PBTYPE ;CMOS
    18                                ENDM
    19                        PB3_PB3_NMOS MACRO
    20                                RMB1    P_PADF0
    21                                RMB3    P_PBTYPE ;CMOS
    22                                ENDM
    23                        PB3_PWM MACRO
    24                                SMB1    P_PADF0
    25                                SMB3    P_PBTYPE ;CMOS
    26                                ENDM
    27                        
    28                        PC67_PC67       MACRO
    29                                RMB5    P_PCSEG
    30                                RMB4    P_DIVC
    31                                ENDM
    32                        PC67_EL01       MACRO
    33                                RMB5    P_PCSEG
    34                                SMB4    P_DIVC
    35                                ENDM
    36                        PC67_SEG	MACRO
    37                                SMB5    P_PCSEG
    38                                ENDM
    39                        
    40                        PC45_PC45       MACRO
    41                                RMB4    P_PCSEG
    42                                ENDM
    43                        PC45_SEG       MACRO
    44                                SMB4    P_PCSEG
    45                                ENDM
    46                        
    47                        PC0_PC0       MACRO
    48                                RMB0    P_PCSEG
    49                                ENDM
    50                        PC03_PC03       MACRO
    51                                RMB0    P_PCSEG
    52                                RMB1    P_PCSEG
    53                                RMB2    P_PCSEG
    54                                RMB3    P_PCSEG
    55                                ENDM
    56                        PC0_SEG       MACRO
    57                                SMB0    P_PCSEG
    58                                ENDM
    59                        PC13_SEG       MACRO
    60                                SMB1    P_PCSEG
    61                                SMB2    P_PCSEG
    62                                SMB3    P_PCSEG
    63                        		RMB3	P_LCDCTRL
    64                                ENDM
    65                        
    66                        PD03_SEG	MACRO
    67                        		SMB6	P_PCSEG
    68                                ENDM
    69                        PD03_RFC	MACRO
    70                        		RMB6	P_PCSEG
    71                        		RMB0	P_PDSEG
    72                        		RMB1	P_PDSEG
    73                        		RMB2	P_PDSEG
    74                        		RMB3	P_PDSEG
    75                        		SMB0	P_RFCC0
    76                        		SMB1	P_RFCC0
    77                        		SMB2	P_RFCC0
    78                        		SMB3	P_RFCC0
    79                                ENDM
    80                        PD03_PD03	MACRO
    81                        		RMB6	P_PCSEG
    82                        		RMB0	P_PDSEG
    83                        		RMB1	P_PDSEG
    84                        		RMB2	P_PDSEG
    85                        		RMB3	P_PDSEG
    86                        		RMB0	P_RFCC0
    87                        		RMB1	P_RFCC0
    88                        		RMB2	P_RFCC0
    89                        		RMB3	P_RFCC0
    90                                ENDM
    91                        PD0_SEG	MACRO
    92                        		SMB0	P_PDSEG
    93                                ENDM
    94                        PD1_SEG	MACRO
    95                        		SMB1	P_PDSEG
    96                                ENDM
    97                        PD2_SEG	MACRO
    98                        		SMB2	P_PDSEG
    99                                ENDM
   100                        PD3_SEG	MACRO
   101                        		SMB3	P_PDSEG
   102                                ENDM
   103                        
   104                        PD47_SEG	MACRO
   105                        		SMB7	P_PCSEG
   106                                ENDM
   107                        PD4_RFC	MACRO
   108                        		RMB7	P_PCSEG
   109                        		RMB4	P_PDSEG
   110                        		SMB4	P_RFCC0
   111                                ENDM
   112                        PD4_PD4	MACRO
   113                        		RMB7	P_PCSEG
   114                        		RMB4	P_PDSEG
   115                        		RMB4	P_RFCC0
   116                                ENDM
   117                        PD47_PD47	MACRO
   118                        		RMB7	P_PCSEG
   119                        		RMB4	P_PDSEG
   120                        		RMB5	P_PDSEG
   121                        		RMB6	P_PDSEG
   122                        		RMB7	P_PDSEG
   123                        		RMB4	P_RFCC0
   124                                ENDM
   125                        PD57_PD57	MACRO
   126                        		RMB7	P_PCSEG
   127                        		RMB5	P_PDSEG
   128                        		RMB6	P_PDSEG
   129                        		RMB7	P_PDSEG
   130                                ENDM
   131                        PD4_SEG	MACRO
   132                        		SMB4	P_PDSEG
   133                                ENDM
   134                        PD5_SEG	MACRO
   135                        		SMB5	P_PDSEG
   136                                ENDM
   137                        PD5_PD5	MACRO
   138                        		RMB7	P_PCSEG
   139                        		RMB5	P_PDSEG
   140                                ENDM
   141                        PD6_SEG	MACRO
   142                        		SMB6	P_PDSEG
   143                                ENDM
   144                        PD6_PD6	MACRO
   145                        		RMB7	P_PCSEG
   146                        		RMB6	P_PDSEG
   147                                ENDM
   148                        PD7_SEG	MACRO
   149                        		SMB7	P_PDSEG
   150                                ENDM
   151                        PD7_PD7	MACRO
   152                        		RMB7	P_PCSEG
   153                        		RMB7	P_PDSEG
   154                                ENDM
   155                        
   156                        PC_PD_SEG	MACRO
   157                        		LDA		#$FF
   158                        		STA		P_PCSEG	;S1~S7,S8~S15
   159                                ENDM
   160                        
   161                        LCD_3COM	MACRO
   162                        		RMB0	P_LCDCOM
   163                        		RMB1	P_LCDCOM
   164                                ENDM
   165                        LCD_4COM	MACRO
   166                        		SMB0	P_LCDCOM
   167                        		RMB1	P_LCDCOM
   168                                ENDM
   169                        LCD_5COM	MACRO
   170                        		RMB0	P_LCDCOM
   171                        		SMB1	P_LCDCOM
   172                                ENDM
   173                        LCD_6COM	MACRO
   174                        		SMB0	P_LCDCOM
   175                        		SMB1	P_LCDCOM
   176                                ENDM
   177                        
   178                        LCD_ENCH_EN		MACRO
   179                        		SMB6	P_LCDCOM
   180                                ENDM
   181                        LCD_ENCH_DIS	MACRO
   182                        		RMB6	P_LCDCOM
   183                                ENDM
   184                        
   185                        LCD_DRIVE_2	MACRO
   186                        		SMB0	P_LCDCTRL
   187                        		RMB1	P_LCDCTRL
   188                                ENDM
   189                        LCD_DRIVE_4	MACRO
   190                        		RMB0	P_LCDCTRL
   191                        		SMB1	P_LCDCTRL
   192                                ENDM
   193                        LCD_DRIVE_8	MACRO
   194                        		SMB0	P_LCDCTRL
   195                        		SMB1	P_LCDCTRL
   196                                ENDM
   197                        LCD_DRIVE_FULL	MACRO
   198                        		RMB0	P_LCDCTRL
   199                        		RMB1	P_LCDCTRL
   200                                ENDM
   201                        
   202                        LCD_1_2_BAIS_3V	MACRO
   203                        		RMB2	P_LCDCTRL
   204                        		RMB3	P_LCDCTRL
   205                                ENDM
   206                        LCD_1_3_BAIS_4V	MACRO
   207                        		SMB2	P_LCDCTRL
   208                        		RMB3	P_LCDCTRL
   209                                ENDM
   210                        LCD_1_3_BAIS_3V	MACRO
   211                        		SMB3	P_LCDCTRL
   212                                ENDM
   213                        LCDS_2	MACRO
   214                        		RMB5	P_LCDCOM
   215                                ENDM
   216                        LCDS_1	MACRO
   217                        		SMB5	P_LCDCOM
   218                                ENDM
   219                        ;------------------------------------
   220                        Fext_WEAK       MACRO
   221                                RMB0    P_SYSCLK
   222                                ENDM
   223                        Fext_STRONG     MACRO
   224                                SMB0    P_SYSCLK
   225                                ENDM
   226                        
   227                        Fext_OFF        MACRO
   228                                RMB1    P_SYSCLK
   229                                ENDM
   230                        Fext_ON         MACRO
   231                                SMB1    P_SYSCLK
   232                                ENDM
   233                        
   234                        Fosc_OFF        MACRO
   235                                RMB2    P_SYSCLK
   236                                ENDM
   237                        Fosc_ON         MACRO
   238                                SMB2    P_SYSCLK
   239                                ENDM
   240                        
   241                        Fext_Xtal       MACRO
   242                                RMB3    P_SYSCLK
   243                                ENDM
   244                        Fext_RC         MACRO
   245                                SMB3    P_SYSCLK
   246                                ENDM
   247                        
   248                        Fsys_Fosc_1 MACRO
   249                                RMB4    P_SYSCLK
   250                                ENDM
   251                        Fsys_Fosc_2 MACRO
   252                                SMB4    P_SYSCLK
   253                                ENDM
   254                        
   255                        Fcpu_Fext  MACRO
   256                                SMB7    P_SYSCLK
   257                                ENDM
   258                        Fcpu_Fsys  MACRO
   259                                RMB7    P_SYSCLK
   260                                ENDM
   261                        ;------------------------------------
   262                        DIV_8KHZ  MACRO
   263                                RMB0    P_DIVC
   264                                RMB1    P_DIVC
   265                        		RMB5	P_DIVC
   266                                ENDM
   267                        DIV_16KHZ  MACRO
   268                                SMB0    P_DIVC
   269                                RMB1    P_DIVC
   270                        		RMB5	P_DIVC
   271                                ENDM
   272                        DIV_512HZ  MACRO
   273                                RMB0    P_DIVC
   274                                SMB1    P_DIVC
   275                        		RMB5	P_DIVC
   276                                ENDM
   277                        DIV_1KHZ  MACRO
   278                                SMB0    P_DIVC
   279                                SMB1    P_DIVC
   280                        		RMB5	P_DIVC
   281                                ENDM
   282                        DIV_256HZ  MACRO
   283                        		SMB5	P_DIVC
   284                                ENDM
   285                        ;------------------------------------
   286                        WDTC_CLK_256HZ   MACRO
   287                                RMB0    P_WDTC
   288                                RMB1    P_WDTC
   289                                ENDM
   290                        WDTC_CLK_DIV     MACRO
   291                                SMB0    P_WDTC
   292                                RMB1    P_WDTC
   293                                ENDM
   294                        WDTC_CLK_TMR1   MACRO
   295                                RMB0    P_WDTC
   296                                SMB1    P_WDTC
   297                                ENDM
   298                        WDTC_CLK_LCDS    MACRO
   299                                SMB0    P_WDTC
   300                                SMB1    P_WDTC
   301                                ENDM
   302                        
   303                        WDTC_CLR MACRO
   304                                RMB2    P_WDTC
   305                                ENDM
   306                        
   307                        WDTC_ON  MACRO
   308                                SMB3    P_WDTC
   309                                ENDM
   310                        WDTC_OFF MACRO
   311                                RMB3    P_WDTC
   312                                ENDM
   313                        
   314                        IF_WDTC MACRO   LAB
   315                                BBS4    P_WDTC,LAB
   316                                ENDM
   317                        
   318                        ;------------------------------------
   319                        TMR0_ON MACRO
   320                                SMB0    P_TMRC
   321                                ENDM
   322                        TMR0_OFF MACRO
   323                                RMB0    P_TMRC
   324                                ENDM
   325                        TMR0_CLK_FOSC   MACRO
   326                                SMB0    P_TMCLK
   327                                RMB1    P_TMCLK
   328                                ENDM
   329                        TMR0_CLK_FSUB    MACRO
   330                                RMB0    P_TMCLK
   331                                RMB1    P_TMCLK
   332                                RMB0	P_PADF1
   333                                ENDM
   334                        TMR0_CLK_128K	macro
   335                        		RMB0    P_TMCLK
   336                                SMB1    P_TMCLK
   337                                ENDM
   338                        TMR0_CLK_32K	macro
   339                        		RMB0    P_TMCLK
   340                                RMB1    P_TMCLK
   341                                SMB0	P_PADF1
   342                                ENDM
   343                        TMR0_CLK_FOSC_4   MACRO
   344                                SMB0    P_TMCLK
   345                                SMB1    P_TMCLK
   346                                RMB6	P_TMRC
   347                                ENDM
   348                        
   349                        TMR1_ON MACRO
   350                                SMB1    P_TMRC
   351                                ENDM
   352                        TMR1_OFF MACRO
   353                                RMB1    P_TMRC
   354                                ENDM
   355                        TMR1_CLK_TMR0   MACRO
   356                                RMB2    P_TMCLK
   357                                RMB3    P_TMCLK
   358                                ENDM
   359                        TMR1_CLK_512Hz    MACRO
   360                                SMB2    P_TMCLK
   361                                RMB3    P_TMCLK
   362                                ENDM
   363                        TMR1_CLK_128K	macro
   364                        		RMB2    P_TMCLK
   365                                SMB3    P_TMCLK
   366                                ENDM
   367                        TMR1_CLK_FOSC_4		macro
   368                        		SMB2    P_TMCLK
   369                                SMB3    P_TMCLK
   370                                ENDM
   371                        
   372                        TMR2_ON MACRO
   373                                SMB2    P_TMRC
   374                                ENDM
   375                        TMR2_OFF MACRO
   376                                RMB2    P_TMRC
   377                                ENDM
   378                        TMR2_CLK_512Hz MACRO
   379                                RMB2    P_TMRC
   380                                ENDM
   381                        
   382                        
   383                        TONE_2KHZ_1_2_Duty     MACRO
   384                                RMB2    P_DIVC
   385                                RMB3    P_DIVC
   386                                RMB7    P_DIVC
   387                                ENDM
   388                        TONE_TMR0_2_1_2_Duty      MACRO
   389                                SMB2    P_DIVC
   390                                RMB3    P_DIVC
   391                                RMB7    P_DIVC
   392                                ENDM
   393                        TONE_L       MACRO
   394                                RMB2    P_DIVC
   395                                SMB3    P_DIVC
   396                                ENDM
   397                        TONE_H       MACRO
   398                                SMB2    P_DIVC
   399                                SMB3    P_DIVC
   400                                ENDM
   401                        TONE_2KHZ_3_4_Duty     MACRO
   402                                RMB2    P_DIVC
   403                                RMB3    P_DIVC
   404                                SMB7    P_DIVC
   405                                ENDM
   406                        TONE_4KHZ_3_4_Duty      MACRO
   407                                SMB2    P_DIVC
   408                                RMB3    P_DIVC
   409                                SMB7    P_DIVC
   410                                ENDM
   411                        ;------------------------------------
   412                        EN_DIV_IRQ     MACRO
   413                                SMB0    P_IER
   414                                ENDM
   415                        EN_TMR0_IRQ     MACRO
   416                                SMB1    P_IER
   417                                ENDM
   418                        EN_TMR1_IRQ     MACRO
   419                                SMB2    P_IER
   420                                ENDM
   421                        EN_TMR2_IRQ     MACRO
   422                                SMB3    P_IER
   423                                ENDM
   424                        EN_KEY_IRQ      MACRO
   425                                SMB4    P_IER
   426                                ENDM
   427                        EN_PA_IRQ      MACRO
   428                                SMB4    P_IER
   429                                ENDM
   430                        EN_LCD_IRQ      MACRO
   431                                SMB6    P_IER
   432                                ENDM
   433                        
   434                        DIS_DIV_IRQ     MACRO
   435                                RMB0    P_IER
   436                                ENDM
   437                        DIS_TMR0_IRQ     MACRO
   438                                RMB1    P_IER
   439                                ENDM
   440                        DIS_TMR1_IRQ     MACRO
   441                                RMB2    P_IER
   442                                ENDM
   443                        DIS_TMR2_IRQ     MACRO
   444                                RMB3    P_IER
   445                                ENDM
   446                        DIS_KEY_IRQ      MACRO
   447                                RMB4    P_IER
   448                                ENDM
   449                        DIS_PA_IRQ		 MACRO
   450                                RMB4    P_IER
   451                                ENDM
   452                        DIS_LCD_IRQ      MACRO
   453                                RMB6    P_IER
   454                                ENDM
   455                        
   456                        CLR_DIV_IRQ_FLAG MACRO
   457                                RMB0    P_IFR
   458                                ENDM
   459                        CLR_TMR0_IRQ_FLAG      MACRO
   460                                RMB1    P_IFR
   461                                ENDM
   462                        CLR_TMR1_IRQ_FLAG      MACRO
   463                                RMB2    P_IFR
   464                                ENDM
   465                        CLR_TMR2_IRQ_FLAG      MACRO
   466                                RMB3    P_IFR
   467                                ENDM
   468                        CLR_KEY_IRQ_FLAG      MACRO
   469                                RMB4    P_IFR
   470                                ENDM
   471                        CLR_PA_IRQ_FLAG      MACRO
   472                                RMB4    P_IFR
   473                                ENDM
   474                        CLR_LCD_IRQ_FLAG       MACRO
   475                                RMB6    P_IFR
   476                                ENDM
   477                        
   478                        IF_DIV_IRQ_FLAG MACRO   LAB1
   479                                BBS0    P_IFR,LAB1
   480                                ENDM
   481                        IF_TMR0_IRQ_FLAG MACRO   LAB1
   482                                BBS1    P_IFR,LAB1
   483                                ENDM
   484                        IF_TMR1_IRQ_FLAG MACRO   LAB1
   485                                BBS2    P_IFR,LAB1
   486                                ENDM
   487                        IF_TMR2_IRQ_FLAG MACRO   LAB1
   488                                BBS3    P_IFR,LAB1
   489                                ENDM
   490                        IF_KEY_IRQ_FLAG MACRO   LAB1
   491                                BBS4    P_IFR,LAB1
   492                                ENDM
   493                        IF_LCD_IRQ_FLAG MACRO   LAB1
   494                                BBS6    P_IFR,LAB1
   495                                ENDM
   496                        ;------------------------------------
   497                        LCD_ON           MACRO
   498                                SMB4    P_TMRC
   499                                ENDM
   500                        LCD_OFF          MACRO
   501                                RMB4    P_TMRC
   502                                ENDM
   503                        
   504                        PWM_ON  MACRO
   505                        		SMB0	P_SYSCLK	;Strong Mode
   506                                SMB7    P_TMRC
   507                                ENDM
   508                        PWM_OFF MACRO
   509                                RMB7    P_TMRC
   510                        ;		LDA		R_Strong_2S
   511                        ;		BNE		?Skip
   512                        		RMB0	P_SYSCLK	;WeakMode
   513                        ?Skip:
   514                                ENDM
   515                        
   516                        IF_PWM_ON       MACRO   LAB
   517                                BBS7    P_TMRC,LAB
   518                                ENDM
   519                        IF_PWM_OFF      MACRO   LAB
   520                                BBR7    P_TMRC,LAB
   521                                ENDM
   522                        
   523                        SEL_PWM MACRO
   524                                SMB1    P_AUDCR
   525                                ENDM
   526                        SEL_TONE MACRO
   527                                RMB1    P_AUDCR
   528                                ENDM
   529                        ;------------------------------------
   530                        ClrAllRam MACRO
   531                            LDA		#$00
   532                        	LDX		#$FF
   533                        	STA		$1800
   534                        ?ClrAllRamLoop:
   535                        	STA		$1800,X
   536                        	DEX
   537                        	BNE		?ClrAllRamLoop
   538                            ENDM
   539                        ;------------------------------------
   539                        
    29                        ;********************************************************
    30                        STACK_BOT       EQU     FFH
    31                        ;********************************************************
    32                        .PROG
    33                        V_RESET:
    34 00:F000: 1A                NOP
    35 00:F001: 1A                NOP
    36 00:F002: 1A                NOP
    37 00:F003: 01                SEI
    38 00:F004: 5E FF             LDX     #STACK_BOT
    39 00:F006: 1E                TXS     ; 锟斤拷始锟斤拷锟斤拷栈指锟斤拷
    40 00:F007: 53 07             LDA     #$07
    41 00:F009: 7F 1D             STA     P_SYSCLK    ;Fcpu=560K, Fext=32768,Strong ,Fosc/1
    42                            ClrAllRam
+   42 00:F00B: 53 00          LDA #$0000
+   42 00:F00D: 5E FF          LDX #$00FF
+   42 00:F00F: 4F 00 18       STA $1800
+   42                        ?ClrAllRamLoop:
+   42 00:F012: 6F 00 18       STA $1800,X
+   42 00:F015: 0F             DEX
+   42 00:F016: 12 FA          BNE ?ClrAllRamLoop
    43 00:F018: 15 8D F0          JSR     L_InitSPR_Prog
    44 00:F01B: 15 FA F0          JSR     F_FillScreen
    45                            LCD_ON
+   45 00:F01E: 2C 16          SMB4 P_TMRC
    46                            TMR1_ON
+   46 00:F020: 29 16          SMB1 P_TMRC
    47                            EN_TMR1_IRQ
+   47 00:F022: 2A 0E          SMB2 P_IER
    48 00:F024: 73 3E             LDA     P_FUSE0
    49 00:F026: 7F 2F             STA     P_MF0
    50 00:F028: 7F 1E             STA     P_HALT
    51 00:F02A: 1A                NOP
    52 00:F02B: 1A                NOP
    53 00:F02C: 1A                NOP
    54 00:F02D: 22 0F             RMB2    P_IFR
    55 00:F02F: 7F 1E             STA     P_HALT
    56 00:F031: 1A                NOP
    57 00:F032: 1A                NOP
    58 00:F033: 1A                NOP
    59 00:F034: 22 0F             RMB2    P_IFR
    60 00:F036: 7F 1E             STA     P_HALT
    61 00:F038: 1A                NOP
    62 00:F039: 1A                NOP
    63 00:F03A: 1A                NOP
    64 00:F03B: 22 0F             RMB2    P_IFR
    65                            WDTC_CLR
+   65 00:F03D: 22 1C          RMB2 P_WDTC
    66                            Fsys_Fosc_1
+   66 00:F03F: 24 1D          RMB4 P_SYSCLK
    67                            EN_LCD_IRQ
+   67 00:F041: 2E 0E          SMB6 P_IER
    68                             ; JSR     Change_Key_BIT3
    69                        
    70 00:F043: 53 FF             LDA	    #$FF
    71 00:F045: 7F 05         	STA	    P_PB
    72                            ; JSR     F_KeyBeep
    73                            ; JSR     F_KeyLight
    74                            ; JSR     L_Beep_Control_Prog
    75                        
    76 00:F047: 53 A4             LDA     #10100100B
    77 00:F049: 7F 02             STA     P_PA_WAKE
    78                        
    79 00:F04B: 53 00             LDA     #0
    80 00:F04D: 7F A4             STA     R_Mode_Flag
    81                        
    82 00:F04F: 53 00             LDA     #0
    83 00:F051: 7F A1             STA     R_Set_Flag
    84                        
    85 00:F053: 53 00             LDA     #0
    86 00:F055: 7F C8             STA     P_Temp+6
    87 00:F057: 7F C9             STA     P_Temp+7
    88 00:F059: 7F C7             STA     P_Temp+5
    89 00:F05B: 15 FE F0          JSR     F_ClearScreen
    90                        ;    JSR     F_KeyUpdateDis
    91                        
    92 00:F05E: 05                CLI
    93                        
    94                        ;--------------------------------------------------------
    95                        Mainloop:
    96                        
    97 00:F05F: 15 0F F5          JSR     L_2Hz_Prog
    98 00:F062: 15 D4 F1          JSR     L_32Hz_Prog
    99                        
   100                        
   101                        ;     RMB2    P_WDTC          ;CLR_WDTC
   102                        ; ;    JSR     L_Mode_Prog
   103                        ;     ; JSR     L_32Hz_Prog
   104                        
   105 00:F065: 3F 16 F7          BBS7    P_TMRC,Mainloop ;锟斤拷锟斤拷锟斤拷
   106                            ; LDA     R_Light_Unit
   107                            ; BNE     Mainloop
   108                            Fsys_Fosc_2
+  108 00:F068: 2C 1D          SMB4 P_SYSCLK
   109 00:F06A: 7F 1E             STA     P_HALT
   110 00:F06C: 15 77 F0          JSR     L_Judge_32hz
   111 00:F06F: 1A                NOP
   112 00:F070: 1A                NOP
   113 00:F071: 1A                NOP
   114                            Fsys_Fosc_1
+  114 00:F072: 24 1D          RMB4 P_SYSCLK
   115 00:F074: 16 5F F0          JMP     Mainloop
   116                        
   117                        L_Judge_32hz:
   118 00:F077: 73 01             LDA     PA
   119 00:F079: 52 A4             EOR     #10100100B
   120 00:F07B: 51 A4             AND     #10100100B
   121 00:F07D: 13 02             BEQ     ?OFF
   122                            EN_LCD_IRQ
+  122 00:F07F: 2E 0E          SMB6 P_IER
   123                        
   124                        ?OFF:
   125 00:F081: 09                RTS
   126                        ;--------------------------------------------------------
   127                        .INCLUDE    Init.asm
     1                        
     2                        ;------------------------------------------------------
     3                        ;L_Init_SystemRam_Prog:
     4                        ;	LDA		#3
     5                        ;	STA		R_Reset_1S
     6                        ;	STA		R_Strong_2S
     7                        
     8                        ;	LDA		#$06
     9                        ;	STA		R_Alarm1_Hr
    10                        ;	LDA		#$12
    11                        ;	STA		R_Alarm2_Hr
    12                        ;	RTS
    13                        ;------------------------------------------------------
    14                        ;------------------------------------------------------
    15                        ;-----------------------------------------------------
    16                        ;-----------------------------------------------------
    17                        F_Delay30Ms_32KHz:
    18 00:F082: 53 8C         	LDA		#140		;2
    19 00:F084: 7F C7         	STA		R_Temp+5
    20                        ?OOP_DELAY:
    21 00:F086: 79 C7         	DEC		R_Temp+5	;2*256
    22 00:F088: 73 C7         	LDA		R_Temp+5	;
    23 00:F08A: 12 FA         	BNE		?OOP_DELAY	;3*256
    24 00:F08C: 09            	RTS
    25                        ;------------------------------------------------------
    26                        L_InitSPR_Prog:
    27 00:F08D: 53 0C         	LDA		#00001100B
    28 00:F08F: 7F 02         	STA		P_PAWAKE
    29                        
    30 00:F091: 53 04         	LDA		#00000100B
    31 00:F093: 7F 04         	STA		P_PADIR
    32                        
    33 00:F095: 53 00         	LDA		#0
    34 00:F097: 7F 01         	STA		P_PA	;PA56���0,������������
    35                        
    36                        	PB2_PB2_CMOS
+   36 00:F099: 20 0C          RMB0 P_PADF0
+   36 00:F09B: 2A 06          SMB2 P_PBTYPE
    37                        	PB3_PB3_CMOS
+   37 00:F09D: 21 0C          RMB1 P_PADF0
+   37 00:F09F: 2B 06          SMB3 P_PBTYPE
    38                        	WDTC_CLR
+   38 00:F0A1: 22 1C          RMB2 P_WDTC
    39                        	PC03_PC03
+   39 00:F0A3: 20 09          RMB0 P_PCSEG
+   39 00:F0A5: 21 09          RMB1 P_PCSEG
+   39 00:F0A7: 22 09          RMB2 P_PCSEG
+   39 00:F0A9: 23 09          RMB3 P_PCSEG
    40                        	PC45_PC45
+   40 00:F0AB: 24 09          RMB4 P_PCSEG
    41                        	PC67_SEG
+   41 00:F0AD: 2D 09          SMB5 P_PCSEG
    42                        	PD03_SEG
+   42 00:F0AF: 2E 09          SMB6 P_PCSEG
    43                        	PD47_SEG
+   43 00:F0B1: 2F 09          SMB7 P_PCSEG
    44                        ;	LDA		#$FF
    45                        ;	STA		P_PB
    46 00:F0B3: 53 00         	LDA		#0
    47 00:F0B5: 7F 05         	STA		P_PB
    48 00:F0B7: 7F 08         	STA		P_PC_IO
    49 00:F0B9: 7F 07         	STA		P_PC
    50 00:F0BB: 7F 0B         	STA		P_PDDIR
    51 00:F0BD: 7F 0A         	STA		P_PD
    52                        	LCD_4COM
+   52 00:F0BF: 28 1A          SMB0 P_LCDCOM
+   52 00:F0C1: 21 1A          RMB1 P_LCDCOM
    53                        	LCD_DRIVE_4
+   53 00:F0C3: 20 19          RMB0 P_LCDCTRL
+   53 00:F0C5: 29 19          SMB1 P_LCDCTRL
    54                        	LCD_ENCH_EN
+   54 00:F0C7: 2E 1A          SMB6 P_LCDCOM
    55                        	LCD_1_2_BAIS_3V
+   55 00:F0C9: 22 19          RMB2 P_LCDCTRL
+   55 00:F0CB: 23 19          RMB3 P_LCDCTRL
    56                        	LCDS_2
+   56 00:F0CD: 25 1A          RMB5 P_LCDCOM
    57 00:F0CF: 53 00         	LDA		#0
    58 00:F0D1: 7F 0D         	STA		P_PADF1
    59 00:F0D3: 7F 10         	STA		P_TMR0
    60 00:F0D5: 7F 12         	STA		P_TMR1
    61 00:F0D7: 7F 14         	STA		P_TMR2
    62 00:F0D9: 7F 18         	STA		P_DIVC
    63 00:F0DB: 7F 0E         	STA		P_IER
    64 00:F0DD: 7F 0F         	STA		P_IFR
    65 00:F0DF: 7F 1F         	STA		P_AUD0
    66 00:F0E1: 7F 20         	STA		P_AUDCR
    67                        ;	LDA		#01111100B
    68                        ;	STA		P_PA_WAKE
    69                        	DIV_512HZ
+   69 00:F0E3: 20 18          RMB0 P_DIVC
+   69 00:F0E5: 29 18          SMB1 P_DIVC
+   69 00:F0E7: 25 18          RMB5 P_DIVC
    70                        	TMR0_CLK_128K
+   70 00:F0E9: 20 17          RMB0 P_TMCLK
+   70 00:F0EB: 29 17          SMB1 P_TMCLK
    71                        	TMR1_CLK_512Hz
+   71 00:F0ED: 2A 17          SMB2 P_TMCLK
+   71 00:F0EF: 23 17          RMB3 P_TMCLK
    72                        	TMR2_CLK_512Hz
+   72 00:F0F1: 22 16          RMB2 P_TMRC
    73                        	WDTC_CLK_TMR1
+   73 00:F0F3: 20 1C          RMB0 P_WDTC
+   73 00:F0F5: 29 1C          SMB1 P_WDTC
    74                        	WDTC_OFF
+   74 00:F0F7: 23 1C          RMB3 P_WDTC
    75 00:F0F9: 09            	RTS
    76                        ;------------------------------------------------------
    77                        
    77                        
   128                        .INCLUDE    Disp.asm
     1                        
     2                        
     3                        ;===========================================================
     4                        ;LCD_RamAddr		equ		RamStarAddr
     5                        ;===========================================================
     6                        F_FillScreen:
     7 00:F0FA: 53 FF         	LDA		#0FFH
     8 00:F0FC: 12 02         	BNE		L_FillLcd
     9                        F_ClearScreen:
    10 00:F0FE: 53 00         	LDA		#0
    11                        L_FillLcd:
    12 00:F100: 5E 00         	LDX		#0
    13                        L_FillLcd_1:
    14 00:F102: 6F 00 18         STA		LCD_RamAddr+0*6,X       ;;COM0
    15 00:F105: 6F 06 18         STA		LCD_RamAddr+1*6,X       ;;COM1
    16 00:F108: 6F 0C 18         STA		LCD_RamAddr+2*6,X       ;;COM2
    17 00:F10B: 6F 12 18         STA		LCD_RamAddr+3*6,X       ;;COM3
    18                        ;   STA		Lcd_RamAddr+4*6,x       ;;COM4
    19                        ;   STA		Lcd_RamAddr+5*6,x       ;;COM5
    20 00:F10E: 0B               INX
    21 00:F10F: 57 06            CPX    	#6
    22 00:F111: 10 EF            BCC    	L_FillLcd_1
    23                        	; STA		0200H
    24                        	; STA		0201H
    25                        	; STA		0208H
    26                        	; STA		0209H
    27                        	; STA		0210H
    28                        	; STA		0211H
    29                        	; STA		0218H
    30                        	; STA		0219H
    31 00:F113: 09            	RTS
    32                        
    33                        
    34                        ;===========================================================
    35                        ;程序功能：	显示8BIT字段
    36                        ;程序入口：	A =  显示内容
    37                        ;			X =  ofc
    38                        ;影响资源：P_Temp，P_Temp+1，P_Temp+2，P_Temp+3,X，A
    39                        ;===========================================================
    40                        L_Dis_8Bit_DigitDot_Prog:
    41                        ;	STA		P_Temp
    42                        ;	LDA		Table_Digit_Add   r_Offset,X
    43 00:F114: 7C C3         	STX		P_Temp+1
    44 00:F116: 1B            	TAX
    45 00:F117: 63 7E F1      	LDA		Table_Digit_DataDot,X
    46 00:F11A: 7E C3         	LDX		P_Temp+1
    47                        F_DispPro:
    48 00:F11C: 7F C2         	STA		P_Temp
    49 00:F11E: 7C C3         	STX		P_Temp+1	;
    50 00:F120: 53 07         	LDA		#7
    51 00:F122: 7F C5         	STA		P_Temp+3	;显示段数
    52                        L_Judge_Dis_8Bit_DigitDot:
    53 00:F124: 7E C3         	LDX		P_Temp+1
    54 00:F126: 63 B4 F1      	LDA		lcd_bit,X
    55 00:F129: 7F C4         	STA		P_Temp+2
    56 00:F12B: 63 94 F1      	LDA		lcd_byte,X
    57 00:F12E: 1B            	TAX
    58 00:F12F: 7B C2         	ROR		P_Temp
    59 00:F131: 10 0A         	BCC		L_CLR
    60 00:F133: 63 00 18      	LDA		LCD_RamAddr,X
    61 00:F136: 70 C4         	ORA		P_Temp+2
    62 00:F138: 6F 00 18      	STA		LCD_RamAddr,X
    63 00:F13B: 17 0A         	BRA		L_Inc_Dis_Index_Prog
    64                        L_CLR:
    65 00:F13D: 63 00 18      	LDA		LCD_RamAddr,X
    66 00:F140: 70 C4         	ORA		P_Temp+2
    67 00:F142: 72 C4         	EOR		P_Temp+2
    68 00:F144: 6F 00 18      	STA		LCD_RamAddr,X
    69                        L_Inc_Dis_Index_Prog:
    70 00:F147: 78 C3         	INC		P_Temp+1
    71 00:F149: 79 C5         	DEC		P_Temp+3
    72 00:F14B: 12 D7         	BNE		L_Judge_Dis_8Bit_DigitDot
    73 00:F14D: 09            	RTS
    74                        
    75                        F_DispPro_8bit:
    76 00:F14E: 7F C2         	STA		P_Temp
    77 00:F150: 7C C3         	STX		P_Temp+1
    78 00:F152: 53 08         	LDA		#8
    79 00:F154: 7F C5         	STA		P_Temp+3	;显示段数
    80 00:F156: 17 CC         	BRA		L_Judge_Dis_8Bit_DigitDot
    81                        ;-----------------------------------------
    82                        F_DispSymbol:		;input Xcc -> ofs
    83                        ;	LDA		Lcd_bit,X
    84                        ;	STA		P_Temp+2
    85                        ;	LDA		Lcd_byte,X
    86                        ;	TAX
    87                        ;	LDA		LCD_RamAddr,X
    88                        ;	ORA		P_Temp+2
    89 00:F158: 15 68 F1      	JSR		F_DispSymbol_Com
    90 00:F15B: 6F 00 18      	STA		LCD_RamAddr,X
    91 00:F15E: 09            	RTS
    92                        ;-----------------------------------------
    93                        F_ClrpSymbol:		;input Xcc -> ofs
    94                        ;	LDA		Lcd_bit,X
    95                        ;	STA		P_Temp+2
    96                        ;	LDA		Lcd_byte,X
    97                        ;	TAX
    98                        ;	LDA		LCD_RamAddr,X
    99                        ;	ORA		P_Temp+2
   100 00:F15F: 15 68 F1      	JSR		F_DispSymbol_Com
   101 00:F162: 72 C4         	EOR		P_Temp+2
   102 00:F164: 6F 00 18      	STA		LCD_RamAddr,X
   103 00:F167: 09            	RTS
   104                        
   105                        F_DispSymbol_Com:
   106 00:F168: 63 B4 F1      	LDA		lcd_bit,X
   107 00:F16B: 7F C4         	STA		P_Temp+2
   108 00:F16D: 63 94 F1      	LDA		lcd_byte,X
   109 00:F170: 1B            	TAX
   110 00:F171: 63 00 18      	LDA		LCD_RamAddr,X
   111 00:F174: 70 C4         	ORA		P_Temp+2
   112 00:F176: 09            	RTS
   113                        ;============================================================
   114                        ;==================================== ===========
   115                        L_ROR_4Bit_Prog:
   116                        L_ROR4Bit_Prog:
   117                        L_LSR4Bit_Prog:
   118                        F_MSBToLSB:
   119 00:F177: 19            	ROR
   120 00:F178: 19            	ROR
   121 00:F179: 19            	ROR
   122 00:F17A: 19            	ROR
   123 00:F17B: 51 0F         	AND		#$0F
   124 00:F17D: 09            	RTS
   125                        ;================================================
   126                        ;********************************************
   127                        Table_Digit_DataDot:	;显示内容对应显示的段码
   128 00:F17E: 3F            	.BYTE 	3fh	;0
   129 00:F17F: 06            	.BYTE	06h	;1
   130 00:F180: 5B            	.BYTE	5bh	;2
   131 00:F181: 4F            	.BYTE	4fh	;3
   132 00:F182: 66            	.BYTE	66h	;4
   133                        Tab_S:
   134                        Char_S  .EQU	Tab_S-Table_Digit_DataDot
   135 00:F183: 6D            	.BYTE	6dh	;5
   136 00:F184: 7D            	.BYTE	7dh	;6
   137 00:F185: 07            	.BYTE	07h	;7			;带钩	27h	;7
   138 00:F186: 7F            	.BYTE	7fh	;8
   139 00:F187: 6F            	.BYTE	6fh	;9
   140 00:F188: 00            	.BYTE	00h	; 		;A
   141 00:F189: 40            	.BYTE	40h	;负号	;B
   142 00:F18A: 77            	.BYTE	77h	;A		;C
   143 00:F18B: 38            	.BYTE	38h	;L		;D
   144 00:F18C: 76            	.BYTE	76h	;H		;E
   145 00:F18D: 50            	.BYTE	50H	;r		;F
   146                        	;.BYTE	01H	;test
   147                        Tab_C:
   148                        Char_C  .EQU	Tab_C-Table_Digit_DataDot
   149 00:F18E: 39            	.BYTE	39h	;C		;10
   150 00:F18F: 71            	.BYTE	71h	;F		;11
   151                        Tab_A:
   152                        Char_A	.EQU	Tab_A-Table_Digit_DataDot
   153 00:F190: 77            	.BYTE	77h	;A		;12
   154                        Tab_P:
   155                        Char_P  .EQU	Tab_P-Table_Digit_DataDot
   156 00:F191: 73            	.BYTE	73h	;P		;13
   157                        Tab_o:
   158                        Char_o  .EQU	Tab_o-Table_Digit_DataDot
   159 00:F192: 5C            	.BYTE	5Ch	;o		;14
   160                        Tab_n:
   161                        Char_n  .EQU	Tab_n-Table_Digit_DataDot
   162 00:F193: 54            	.BYTE	54h	;n		;15
   163                        ;-----------------------------------------------------------
   163                        
   129                        .INCLUDE    Lcdtab.asm
     1                        ;4 COM*8 SEG
     2                        
     3                        ;--------COM------------
     4                        C1  .equ    0
     5                        C2  .equ    1
     6                        C3  .equ    2
     7                        C4  .equ    3
     8                        ;;--------SEG------------
     9                        S3      .EQU    43
    10                        S4      .EQU    42
    11                        S5      .EQU    41
    12                        S6      .EQU    40
    13                        S7      .EQU    15
    14                        S8      .EQU    14
    15                        S9      .EQU    13
    16                        S10     .EQU    12
    17                        
    18                        db_c_s:      .macro  com,seg
    19                                    db com*6+seg/8
    20                                      .endm
    21                        
    22                        db_c_y:       .macro  com,seg
    23                                    db 1.shl.(seg-seg/8*8)
    24                                    .endm
    25                        
    26                        lcd_byte:
    27                        lcd_table1:
    28                        lcd_d1 .equ $-lcd_table1
    29                            db_c_s  C1,S3   ;;1A
+   29 00:F194: 05             .DB C1*$0006+S3/$0008
    30                            db_c_s  C1,S4   ;;1B
+   30 00:F195: 05             .DB C1*$0006+S4/$0008
    31                            db_c_s  C3,S4   ;;1C
+   31 00:F196: 11             .DB C3*$0006+S4/$0008
    32                            db_c_s  C4,S4   ;;1D
+   32 00:F197: 17             .DB C4*$0006+S4/$0008
    33                            db_c_s  C3,S3   ;;1E
+   33 00:F198: 11             .DB C3*$0006+S3/$0008
    34                            db_c_s  C2,S3   ;;1F
+   34 00:F199: 0B             .DB C2*$0006+S3/$0008
    35                            db_c_s  C2,S4   ;;1G
+   35 00:F19A: 0B             .DB C2*$0006+S4/$0008
    36                        
    37                        lcd_d2 .equ $-lcd_table1
    38                            db_c_s  C1,S5   ;;2A
+   38 00:F19B: 05             .DB C1*$0006+S5/$0008
    39                            db_c_s  C1,S6   ;;2B
+   39 00:F19C: 05             .DB C1*$0006+S6/$0008
    40                            db_c_s  C3,S6   ;;2C
+   40 00:F19D: 11             .DB C3*$0006+S6/$0008
    41                            db_c_s  C4,S6   ;;2D
+   41 00:F19E: 17             .DB C4*$0006+S6/$0008
    42                            db_c_s  C3,S5   ;;2E
+   42 00:F19F: 11             .DB C3*$0006+S5/$0008
    43                            db_c_s  C2,S5   ;;2F
+   43 00:F1A0: 0B             .DB C2*$0006+S5/$0008
    44                            db_c_s  C2,S6   ;;2G
+   44 00:F1A1: 0B             .DB C2*$0006+S6/$0008
    45                        
    46                        lcd_d3 equ $-lcd_table1
    47                            db_c_s  C1,S7   ;;3A
+   47 00:F1A2: 01             .DB C1*$0006+S7/$0008
    48                            db_c_s  C1,S8   ;;3B
+   48 00:F1A3: 01             .DB C1*$0006+S8/$0008
    49                            db_c_s  C3,S8   ;;3C
+   49 00:F1A4: 0D             .DB C3*$0006+S8/$0008
    50                            db_c_s  C4,S8   ;;3D
+   50 00:F1A5: 13             .DB C4*$0006+S8/$0008
    51                            db_c_s  C3,S7   ;;3E
+   51 00:F1A6: 0D             .DB C3*$0006+S7/$0008
    52                            db_c_s  C2,S7   ;;3F
+   52 00:F1A7: 07             .DB C2*$0006+S7/$0008
    53                            db_c_s  C2,S8   ;;3G
+   53 00:F1A8: 07             .DB C2*$0006+S8/$0008
    54                        
    55                        lcd_d4 equ $-lcd_table1
    56                            db_c_s  C1,S9   ;;4A
+   56 00:F1A9: 01             .DB C1*$0006+S9/$0008
    57                            db_c_s  C1,S10  ;;4B
+   57 00:F1AA: 01             .DB C1*$0006+S10/$0008
    58                            db_c_s  C3,S10  ;;4C
+   58 00:F1AB: 0D             .DB C3*$0006+S10/$0008
    59                            db_c_s  C4,S10  ;;4D
+   59 00:F1AC: 13             .DB C4*$0006+S10/$0008
    60                            db_c_s  C3,S9   ;;4E
+   60 00:F1AD: 0D             .DB C3*$0006+S9/$0008
    61                            db_c_s  C2,S9   ;;4F
+   61 00:F1AE: 07             .DB C2*$0006+S9/$0008
    62                            db_c_s  C2,S10  ;;4G
+   62 00:F1AF: 07             .DB C2*$0006+S10/$0008
    63                        
    64                        lcd_dot:
    65                        lcd_col equ $-lcd_table1
    66                            db_c_s  C4,S7  ;;COL
+   66 00:F1B0: 13             .DB C4*$0006+S7/$0008
    67                        lcd_am equ $-lcd_table1
    68                            db_c_s  C4,S3  ;;AM
+   68 00:F1B1: 17             .DB C4*$0006+S3/$0008
    69                        lcd_pm equ $-lcd_table1
    70                            db_c_s  C4,S5  ;;PM
+   70 00:F1B2: 17             .DB C4*$0006+S5/$0008
    71                        lcd_ms equ $-lcd_table1
    72                            db_c_s  C4,S9  ;;M,S
+   72 00:F1B3: 13             .DB C4*$0006+S9/$0008
    73                        
    74                        ;=========================================
    75                        lcd_bit:
    76                            db_c_y  C1,S3   ;;1A
+   76 00:F1B4: 08             .DB $0001<<(S3-S3/$0008*$0008)
    77                            db_c_y  C1,S4   ;;1B
+   77 00:F1B5: 04             .DB $0001<<(S4-S4/$0008*$0008)
    78                            db_c_y  C3,S4   ;;1C
+   78 00:F1B6: 04             .DB $0001<<(S4-S4/$0008*$0008)
    79                            db_c_y  C4,S4   ;;1D
+   79 00:F1B7: 04             .DB $0001<<(S4-S4/$0008*$0008)
    80                            db_c_y  C3,S3   ;;1E
+   80 00:F1B8: 08             .DB $0001<<(S3-S3/$0008*$0008)
    81                            db_c_y  C2,S3   ;;1F
+   81 00:F1B9: 08             .DB $0001<<(S3-S3/$0008*$0008)
    82                            db_c_y  C2,S4   ;;1G
+   82 00:F1BA: 04             .DB $0001<<(S4-S4/$0008*$0008)
    83                        
    84                            db_c_y  C1,S5   ;;2A
+   84 00:F1BB: 02             .DB $0001<<(S5-S5/$0008*$0008)
    85                            db_c_y  C1,S6   ;;2B
+   85 00:F1BC: 01             .DB $0001<<(S6-S6/$0008*$0008)
    86                            db_c_y  C3,S6   ;;2C
+   86 00:F1BD: 01             .DB $0001<<(S6-S6/$0008*$0008)
    87                            db_c_y  C4,S6   ;;2D
+   87 00:F1BE: 01             .DB $0001<<(S6-S6/$0008*$0008)
    88                            db_c_y  C3,S5   ;;2E
+   88 00:F1BF: 02             .DB $0001<<(S5-S5/$0008*$0008)
    89                            db_c_y  C2,S5   ;;2F
+   89 00:F1C0: 02             .DB $0001<<(S5-S5/$0008*$0008)
    90                            db_c_y  C2,S6   ;;2G
+   90 00:F1C1: 01             .DB $0001<<(S6-S6/$0008*$0008)
    91                        
    92                            db_c_y  C1,S7   ;;3A
+   92 00:F1C2: 80             .DB $0001<<(S7-S7/$0008*$0008)
    93                            db_c_y  C1,S8   ;;3B
+   93 00:F1C3: 40             .DB $0001<<(S8-S8/$0008*$0008)
    94                            db_c_y  C3,S8   ;;3C
+   94 00:F1C4: 40             .DB $0001<<(S8-S8/$0008*$0008)
    95                            db_c_y  C4,S8   ;;3D
+   95 00:F1C5: 40             .DB $0001<<(S8-S8/$0008*$0008)
    96                            db_c_y  C3,S7   ;;3E
+   96 00:F1C6: 80             .DB $0001<<(S7-S7/$0008*$0008)
    97                            db_c_y  C2,S7   ;;3F
+   97 00:F1C7: 80             .DB $0001<<(S7-S7/$0008*$0008)
    98                            db_c_y  C2,S8   ;;3G
+   98 00:F1C8: 40             .DB $0001<<(S8-S8/$0008*$0008)
    99                        
   100                            db_c_y  C1,S9   ;;4A
+  100 00:F1C9: 20             .DB $0001<<(S9-S9/$0008*$0008)
   101                            db_c_y  C1,S10  ;;4B
+  101 00:F1CA: 10             .DB $0001<<(S10-S10/$0008*$0008)
   102                            db_c_y  C3,S10  ;;4C
+  102 00:F1CB: 10             .DB $0001<<(S10-S10/$0008*$0008)
   103                            db_c_y  C4,S10  ;;4D
+  103 00:F1CC: 10             .DB $0001<<(S10-S10/$0008*$0008)
   104                            db_c_y  C3,S9   ;;4E
+  104 00:F1CD: 20             .DB $0001<<(S9-S9/$0008*$0008)
   105                            db_c_y  C2,S9   ;;4F
+  105 00:F1CE: 20             .DB $0001<<(S9-S9/$0008*$0008)
   106                            db_c_y  C2,S10  ;;4G
+  106 00:F1CF: 10             .DB $0001<<(S10-S10/$0008*$0008)
   107                        
   108                            db_c_y  C4,S7  ;;COL
+  108 00:F1D0: 80             .DB $0001<<(S7-S7/$0008*$0008)
   109                            db_c_y  C4,S3  ;;AM
+  109 00:F1D1: 08             .DB $0001<<(S3-S3/$0008*$0008)
   110                            db_c_y  C4,S5  ;;PM
+  110 00:F1D2: 02             .DB $0001<<(S5-S5/$0008*$0008)
   111                            db_c_y  C4,S9  ;;M,S
+  111 00:F1D3: 20             .DB $0001<<(S9-S9/$0008*$0008)
   112                        ;=========================================
   112                        
   130                        ; .include    Key\KeyBeep.asm
   131                        .include    Key\KeyScan.asm
     1                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     2                        D_Key1S		.EQU  32*1
     3                        D_Key2S		.EQU  25*2
     4                        D_Key3S		.EQU  30*3
     5                        
     6                        D_Key2		.EQU  %00000100
     7                        D_Key5		.EQU  %00100000
     8                        D_Key7		.EQU  %10000000
     9                        D_Key57		.EQU  %10100000
    10                        
    11                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    12                        L_32Hz_Prog:
    13 00:F1D4: 73 99         	LDA		Sys_Flag_A
    14 00:F1D6: 51 04         	AND		#BIT2
    15 00:F1D8: 13 0B         	BEQ		L_End_32Hz_Prog
    16                        
    17 00:F1DA: 01            	SEI
    18 00:F1DB: 73 99         	LDA		Sys_Flag_A
    19 00:F1DD: 51 FB         	AND		#BIT2_
    20 00:F1DF: 7F 99         	STA		Sys_Flag_A
    21 00:F1E1: 05            	CLI
    22                        	; JSR		L_Beep_Control_Prog
    23 00:F1E2: 15 E6 F1      	JSR		L_Scankey_Prog
    24                        L_End_32Hz_Prog:
    25 00:F1E5: 09            	RTS
    26                        ;---------------------------------------------------------
    27                        L_Scankey_Prog:
    28 00:F1E6: 15 F5 F4      	JSR		F_KeyIoPAInputHigh
    29                        
    30 00:F1E9: 15 06 F5      	JSR		L_ScanKey_Delay_Prog		;	等待功能，跑循环
    31 00:F1EC: 73 01         	LDA     P_PA
    32 00:F1EE: 52 A4             EOR     #10100100B			;;取反，区分按下和未按下的键
    33 00:F1F0: 51 A4             AND     #10100100B			;;去除其余干扰位，确定按键
    34 00:F1F2: 7F C3             STA     P_Temp+1
    35 00:F1F4: 12 03         	BNE		L_Havekey
    36 00:F1F6: 16 CB F2      	JMP		L_Null_Key_Prog
    37                        L_Havekey:
    38 00:F1F9: 73 C3         	LDA		P_Temp+1
    39 00:F1FB: 76 CF         	CMP		R_KeyValue
    40 00:F1FD: 13 03         	BEQ		L_KeyLine1
    41 00:F1FF: 7F CF         	STA		R_KeyValue
    42 00:F201: 09            	RTS
    43                        
    44                        L_KeyLine1:
    45 00:F202: 73 9D         	LDA		R_Key_Flag
    46 00:F204: 51 80         	AND		#BIT7
    47 00:F206: 13 01         	BEQ		L_KeyLine1_
    48 00:F208: 09            	RTS
    49                        
    50                        L_KeyLine1_:
    51                        ;	JSR		Stop_Alarm_Beep		;有键按下即关闭闹钟
    52                        
    53 00:F209: 73 C3         	LDA		P_Temp+1
    54 00:F20B: 56 04         	CMP		#D_Key2
    55 00:F20D: 13 25         	BEQ		L_Key2_Enter
    56                        
    57 00:F20F: 56 20         	CMP		#D_Key5
    58 00:F211: 13 4B         	BEQ		L_Key5_Enter
    59                        
    60 00:F213: 56 80         	CMP		#D_Key7
    61 00:F215: 13 76         	BEQ		L_Key7_Enter
    62                        
    63 00:F217: 56 A0         	CMP		#D_Key57
    64 00:F219: 13 03         	BEQ		L_Key57_Enter
    65                        
    66 00:F21B: 16 C4 F2      	JMP		L_ManyKey
    67                        ;============================================================
    68                        L_Key57_Enter:
    69 00:F21E: 30 9A 12      	BBR0	Sys_Flag_B,L_Key57_Enter_RTS	;;判断是否在计时模式下
    70 00:F221: 3C 99 0F      	BBS4	Sys_Flag_A,L_Key57_Enter_RTS	;;标记57键是否为按下状态
    71 00:F224: 2C 99         	SMB4	Sys_Flag_A
    72                        
    73 00:F226: 53 00         	LDA		#0
    74 00:F228: 7F AB         	STA		R_Stw_Sec		;;同时按下则清零
    75 00:F22A: 7F AC         	STA		R_Stw_Min
    76 00:F22C: 22 9A         	RMB2	Sys_Flag_B			;;清零后，标记为正计时
    77 00:F22E: 21 9A         	RMB1	Sys_Flag_B			;;计时暂停状态
    78 00:F230: 16 88 F3      	JMP		L_Display_Mode0Prog
    79                        L_Key57_Enter_RTS:
    80 00:F233: 09            	RTS
    81                        ;============================================================
    82                        L_Key2_Enter:
    83 00:F234: 3C 99 04      	BBS4	Sys_Flag_A,?RTS		;;判断Sys_Flag_A的bit4=1？ 不为1，则往下执行；为1 说明按键已经按下，直接跳转
    84 00:F237: 2C 99         	SMB4	Sys_Flag_A		;;标记Sys_Flag_A的bit4=1
    85 00:F239: 28 9D         	SMB0	R_Key_Flag		;;R_Key_Flag的bit0=1
    86                        
    87                        ?RTS:
    88 00:F23B: 73 BE         	LDA		R_KeyHold_Time
    89 00:F23D: 56 5A         	CMP		#D_Key3S
    90 00:F23F: 13 06         	BEQ		L_Key2_Enter_End		;;判断是否按下满足3S
    91 00:F241: 73 BE         	LDA		R_KeyHold_Time
    92 00:F243: 03            	INC
    93 00:F244: 7F BE         	STA		R_KeyHold_Time
    94 00:F246: 09            	RTS
    95                        
    96                        L_Key2_Enter_End:			;;满足3S
    97 00:F247: 30 9D 13      	BBR0	R_Key_Flag, ?RTS  ;;判断bit2=0?  =0：不是2key，跳转
    98 00:F24A: 20 9D         	RMB0	R_Key_Flag			;;bit0=1时，清除-->bit0=0
    99 00:F24C: 53 00         	LDA		#0
   100 00:F24E: 7F A2         	STA		R_No_Key			;;若10S内有按键按下，重置R_No_Key
   101 00:F250: 53 00         	LDA		#0
   102 00:F252: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   103 00:F254: 73 A1         	LDA		R_Set_Flag
   104 00:F256: 12 05         	BNE		?RTS				;;判断R_Set_Flag不为0 ？ 不为0：跳转	为0 ：R_Set_Flag加1,R_Set_Flag=1
   105 00:F258: 78 A1         	INC		R_Set_Flag
   106 00:F25A: 15 88 F3      	JSR		L_Display_Mode0Prog	;;R_Set_Flag=1
   107                        ?RTS:
   108 00:F25D: 09            	RTS
   109                        
   110                        ;=================================================
   111                        L_Key5_Enter:
   112 00:F25E: 39 9A 13      	BBS1	Sys_Flag_B,?End		;;判断计时开始/暂停状态
   113 00:F261: 3E 99 04      	BBS6	Sys_Flag_A,?RTS
   114 00:F264: 2E 99         	SMB6	Sys_Flag_A
   115 00:F266: 29 9D         	SMB1	R_Key_Flag		;;bit1=1
   116                        
   117                        ?RTS:
   118 00:F268: 73 BE         	LDA		R_KeyHold_Time
   119 00:F26A: 56 5A         	CMP		#D_Key3S
   120 00:F26C: 13 07         	BEQ		L_Key5_Enter_End
   121 00:F26E: 73 BE         	LDA		R_KeyHold_Time
   122 00:F270: 03            	INC
   123 00:F271: 7F BE         	STA		R_KeyHold_Time
   124 00:F273: 09            	RTS
   125                        ?End:
   126 00:F274: 09            	RTS
   127                        
   128                        L_Key5_Enter_End:
   129 00:F275: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   130 00:F277: 53 00         	LDA		#0
   131 00:F279: 7F A2         	STA		R_No_Key			;;若10S内有按键按下，重置R_No_Key
   132 00:F27B: 53 00         	LDA		#0
   133 00:F27D: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   134 00:F27F: 73 BF         	LDA		R_Fast_Time
   135 00:F281: 56 04         	CMP		#C_Fast_Time
   136 00:F283: 10 37         	BCC		L_Inc_Fast_Time		;;R_Fast_Time<C_Fast_Time,C=0时跳转,R_Fast_Time继续累加
   137 00:F285: 53 00         	LDA		#0
   138 00:F287: 7F BF         	STA		R_Fast_Time			;;达到按键时长,R_Fast_Time>=C_Fast_Time,C=1不跳转,R_Fast_Time重置为0,一次快加结束
   139 00:F289: 15 66 F4      	JSR		L_FastAdd_Prog
   140 00:F28C: 09            	RTS
   141                        
   142                        ;==================================================
   143                        L_Key7_Enter:
   144 00:F28D: 39 9A 13      	BBS1	Sys_Flag_B,?End		;;判断计时开始/暂停状态
   145 00:F290: 3F 99 04      	BBS7	Sys_Flag_A,?RTS
   146 00:F293: 2F 99         	SMB7	Sys_Flag_A
   147 00:F295: 2A 9D         	SMB2	R_Key_Flag		;;bit2=1
   148                        
   149                        ?RTS:
   150 00:F297: 73 BE         	LDA		R_KeyHold_Time
   151 00:F299: 56 5A         	CMP		#D_Key3S
   152 00:F29B: 13 07         	BEQ		L_Key7_Enter_End
   153 00:F29D: 73 BE         	LDA		R_KeyHold_Time
   154 00:F29F: 03            	INC
   155 00:F2A0: 7F BE         	STA		R_KeyHold_Time
   156 00:F2A2: 09            	RTS
   157                        ?End:
   158 00:F2A3: 09            	RTS
   159                        
   160                        L_Key7_Enter_End:
   161 00:F2A4: 53 00         	LDA		#0
   162 00:F2A6: 7F A2         	STA		R_No_Key		;;若10S内有按键按下，重置R_No_Key
   163 00:F2A8: 53 00         	LDA		#0
   164 00:F2AA: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   165 00:F2AC: 22 9D         	RMB2	R_Key_Flag
   166 00:F2AE: 73 BF         	LDA		R_Fast_Time
   167 00:F2B0: 56 04         	CMP		#C_Fast_Time
   168 00:F2B2: 10 08         	BCC		L_Inc_Fast_Time		;;R_Fast_Time<C_Fast_Time,C=0时跳转,R_Fast_Time继续累加
   169 00:F2B4: 53 00         	LDA		#0
   170 00:F2B6: 7F BF         	STA		R_Fast_Time
   171 00:F2B8: 15 AA F4      	JSR		L_FastDec_Prog
   172 00:F2BB: 09            	RTS
   173                        
   174                        ;============================================================
   175                        L_Inc_Fast_Time:
   176 00:F2BC: 04            	CLC
   177 00:F2BD: 73 BF         	LDA		R_Fast_Time
   178 00:F2BF: 54 01         	ADC		#1
   179 00:F2C1: 7F BF         	STA		R_Fast_Time
   180 00:F2C3: 09            	RTS
   181                        ;============================================================
   182                        L_ManyKey:
   183 00:F2C4: 73 9D         	LDA		R_Key_Flag
   184 00:F2C6: 50 80         	ORA		#BIT7
   185 00:F2C8: 7F 9D         	STA		R_Key_Flag
   186                        L_End_KeyScan_Prog:
   187 00:F2CA: 09            	RTS
   188                        
   189                        ;============================================================
   190                        ;============================================================
   191                        L_Null_Key_Prog:
   192 00:F2CB: 15 F5 F4      	JSR		F_KeyIoPAInputHigh
   193 00:F2CE: 53 00         	LDA		#$0
   194 00:F2D0: 7F BE         	STA		R_KeyHold_Time
   195                        
   196 00:F2D2: 15 F7 F2      	JSR		L_REALSE_2KEY
   197 00:F2D5: 15 3A F3      	JSR		L_REALSE_5KEY
   198 00:F2D8: 15 61 F3      	JSR		L_REALSE_7KEY
   199                        
   200 00:F2DB: 24 99         	RMB4 	Sys_Flag_A
   201 00:F2DD: 26 99         	RMB6 	Sys_Flag_A
   202 00:F2DF: 27 99         	RMB7 	Sys_Flag_A
   203                        
   204 00:F2E1: 20 9B         	RMB0	Sys_Flag_C		;;清除快加/快减标志位
   205                        
   206 00:F2E3: 73 9D         	LDA		R_Key_Flag
   207 00:F2E5: 51 7F         	AND		#%01111111
   208 00:F2E7: 7F 9D         	STA		R_Key_Flag
   209                        
   210 00:F2E9: 15 EE F4      	JSR		Stz_Fast_Hold_Key
   211 00:F2EC: 73 BD         	LDA		R_Voice_Unit
   212 00:F2EE: 12 06         	BNE		L_End_Null_Key_Prog
   213                        
   214                        ;	JSR		L_Mode_Prog
   215                        ;;L_Exit_Null_Key_Prog:
   216                        ;	ST_DIS
   217                        	DIS_LCD_IRQ
+  217 00:F2F0: 26 0E          RMB6 P_IER
   218 00:F2F2: 24 0F         	RMB4	P_IFR
   219                        	EN_PA_IRQ
+  219 00:F2F4: 2C 0E          SMB4 P_IER
   220                        L_End_Null_Key_Prog:
   221 00:F2F6: 09            	RTS
   222                        ;============================================================
   223                        L_REALSE_2KEY:
   224 00:F2F7: 30 9D 3F      	BBR0	R_Key_Flag, L_REALSE_2KEY_RTS  ;;判断bit0=0?  =0：不是2key，跳转
   225 00:F2FA: 20 9D         	RMB0	R_Key_Flag			;;bit0=1时，清除-->bit0=0
   226                        
   227 00:F2FC: 38 9A 23      	BBS0	Sys_Flag_B,?Start		;;判断是否已经进入计时模式
   228 00:F2FF: 53 00         	LDA		#0
   229 00:F301: 7F A2         	STA		R_No_Key		;;若10S内有按键按下，重置R_No_Key
   230 00:F303: 53 00         	LDA		#0
   231 00:F305: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   232 00:F307: 73 A1         	LDA		R_Set_Flag
   233 00:F309: 13 11         	BEQ		?RTS		;;判断R_Set_Flag=0？ 为0 ：不执行 不为0：R_Set_Flag+1
   234 00:F30B: 78 A1         	INC		R_Set_Flag
   235 00:F30D: 73 A1         	LDA		R_Set_Flag
   236 00:F30F: 56 04         	CMP		#4			;;判断R_Set_Flag
   237 00:F311: 13 04         	BEQ		?ZERO
   238 00:F313: 15 88 F3      	JSR		L_Display_Mode0Prog
   239 00:F316: 09            	RTS
   240                        ?ZERO:
   241 00:F317: 53 00         	LDA		#0				;;R_Set_Flag置0
   242 00:F319: 7F A1         	STA		R_Set_Flag
   243 00:F31B: 09            	RTS
   244                        ?RTS:
   245 00:F31C: 28 9A         	SMB0	Sys_Flag_B			;;set=0，短按标记，进入计时模式
   246 00:F31E: 15 88 F3      	JSR		L_Display_Mode0Prog
   247 00:F321: 09            	RTS
   248                        
   249                        ?Start:
   250 00:F322: 3B 9A 07      	BBS3	Sys_Flag_B,?CTW_Zero	;;判断是否是正计时最大状态下
   251 00:F325: 73 9A         	LDA		Sys_Flag_B		;;控制计时开始/暂停
   252 00:F327: 52 02         	EOR		#BIT1
   253 00:F329: 7F 9A         	STA		Sys_Flag_B
   254 00:F32B: 09            	rts
   255                        ?CTW_Zero:
   256 00:F32C: 53 00         	LDA		#0
   257 00:F32E: 7F AB         	STA		R_Stw_Sec		;;清零
   258 00:F330: 7F AC         	STA		R_Stw_Min
   259 00:F332: 23 9A         	RMB3	Sys_Flag_B
   260 00:F334: 22 9A         	RMB2	Sys_Flag_B			;;清零后，标记为正计时
   261 00:F336: 16 88 F3      	JMP		L_Display_Mode0Prog
   262                        
   263                        
   264                        L_REALSE_2KEY_RTS:
   265 00:F339: 09            	RTS
   266                        ;============================================================
   267                        L_REALSE_5KEY:
   268 00:F33A: 31 9D 23      	BBR1	R_Key_Flag,L_REALSE_5KEY_RTS	;;判断是否是PA5按下
   269 00:F33D: 73 A1         	LDA		R_Set_Flag
   270 00:F33F: 13 0F         	BEQ		?STW					;;Set=0？ =0：计时模式
   271 00:F341: 53 00         	LDA		#0
   272 00:F343: 7F A2         	STA		R_No_Key
   273 00:F345: 53 00         	LDA		#0
   274 00:F347: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   275 00:F349: 15 E7 F3      	JSR		L_Set_Flag_Prog
   276 00:F34C: 15 88 F3      	JSR		L_Display_Mode0Prog
   277 00:F34F: 09            	RTS
   278                        ?STW:
   279 00:F350: 30 9A 07      	BBR0	Sys_Flag_B,?CTW_5Key		;;判断是否为计时模式(BIT0=0,跳转)
   280 00:F353: 39 9A 0A      	BBS1	Sys_Flag_B,L_REALSE_5KEY_RTS	;;判断是否为暂停状态
   281 00:F356: 15 E7 F3      	JSR		L_Set_Flag_Prog
   282 00:F359: 09            	RTS
   283                        
   284                        ?CTW_5Key:
   285 00:F35A: 28 9A         	SMB0	Sys_Flag_B			;;标记计时模式
   286 00:F35C: 15 88 F3      	JSR		L_Display_Mode0Prog
   287 00:F35F: 09            	RTS
   288                        
   289                        L_REALSE_5KEY_RTS:
   290 00:F360: 09            	RTS
   291                        ;===============================================================
   292                        L_REALSE_7KEY:
   293 00:F361: 32 9D 23      	BBR2	R_Key_Flag,L_REALSE_7KEY_RTS
   294 00:F364: 73 A1         	LDA		R_Set_Flag
   295 00:F366: 13 0F         	BEQ		?STW
   296 00:F368: 53 00         	LDA		#0
   297 00:F36A: 7F A2         	STA		R_No_Key
   298 00:F36C: 53 00         	LDA		#0
   299 00:F36E: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   300 00:F370: 15 E7 F3      	JSR		L_Set_Flag_Prog
   301 00:F373: 15 88 F3      	JSR		L_Display_Mode0Prog
   302 00:F376: 09            	RTS
   303                        ?STW:
   304 00:F377: 30 9A 07      	BBR0	Sys_Flag_B,?CTW_7Key		;;判断是否为计时模式(BIT0=0,跳转)
   305 00:F37A: 39 9A 0A      	BBS1	Sys_Flag_B,L_REALSE_7KEY_RTS	;;判断是否为暂停状态
   306 00:F37D: 15 E7 F3      	JSR		L_Set_Flag_Prog
   307 00:F380: 09            	RTS
   308                        ?CTW_7Key:
   309 00:F381: 28 9A         	SMB0	Sys_Flag_B
   310 00:F383: 15 88 F3      	JSR		L_Display_Mode0Prog
   311 00:F386: 09            	RTS
   312                        L_REALSE_7KEY_RTS:
   313 00:F387: 09            	RTS
   314                        ;===============================================================
   315                        ;===============================================================
   316                        L_Display_Mode0Prog:
   317 00:F388: 38 9A 0E      	BBS0	Sys_Flag_B,?STW
   318 00:F38B: 73 A1         	LDA		R_Set_Flag
   319 00:F38D: 04            	CLC
   320 00:F38E: 18            	ROL
   321 00:F38F: 1B            	TAX
   322 00:F390: 63 9D F3      	LDA		T_Display_Table+1,X
   323 00:F393: 0A            	PHA
   324 00:F394: 63 9C F3      	LDA		T_Display_Table,X
   325 00:F397: 0A            	PHA
   326 00:F398: 09            	RTS
   327                        ?STW:
   328 00:F399: 16 67 F5      	JMP		L_STWDisplay_Prog
   329                        
   330                        T_Display_Table:
   331 00:F39C: A3 F3         	DW		L_Display_Prog-1	;;R_Set_Flag=0
   332 00:F39E: 30 F6         	DW		L_Key5_DisHR-1		;;R_Set_Flag=1
   333 00:F3A0: A3 F3         	DW		L_Display_Prog-1	;;R_Set_Flag=2
   334 00:F3A2: A3 F3         	DW		L_Display_Prog-1	;;R_Set_Flag=3
   335                        
   336                        L_Display_Prog:
   337 00:F3A4: 15 BF F5      	JSR		F_ClrMs
   338 00:F3A7: 15 37 F7      	JSR		L_Dis_TimeHr
   339 00:F3AA: 15 2B F6      	JSR		L_Dis_TimeMin
   340 00:F3AD: 15 27 F6      	JSR		L_DisCol_Prog
   341 00:F3B0: 09            	RTS
   342                        ;===============================================================
   343                        ;===============================================================
   344                        L_1Hz_Flash_Prog:
   345 00:F3B1: 39 9A 2F      	BBS1	Sys_Flag_B,L_MS_Flash
   346 00:F3B4: 38 9B 0D      	BBS0	Sys_Flag_C,?RTS			;;判断bit0=1? =1:快加/快减标志,不执行闪烁
   347 00:F3B7: 73 A1         	LDA		R_Set_Flag
   348 00:F3B9: 04            	CLC
   349 00:F3BA: 18            	ROL
   350 00:F3BB: 1B            	TAX
   351 00:F3BC: 63 C6 F3      	LDA		T_Flash_Table+1,X
   352 00:F3BF: 0A            	PHA
   353 00:F3C0: 63 C5 F3      	LDA		T_Flash_Table,X
   354 00:F3C3: 0A            	PHA
   355                        ?RTS:
   356 00:F3C4: 09            	RTS
   357                        
   358                        T_Flash_Table:
   359 00:F3C5: CC F3         	DW		L_Flash_Set0-1		;;R_Set_Flag=0
   360 00:F3C7: D3 F3         	DW		L_Flash_Set1-1		;;R_Set_Flag=1
   361 00:F3C9: DA F3         	DW		L_Flash_Set2-1		;;R_Set_Flag=2
   362 00:F3CB: DE F3         	DW		L_Flash_Set3-1		;;R_Set_Flag=3
   363                        
   364                        L_Flash_Set0:
   365 00:F3CD: 38 9A 03      	BBS0	Sys_Flag_B,?RTS
   366 00:F3D0: 15 85 F5      	JSR		F_ClrCol
   367                        ?RTS:
   368 00:F3D3: 09            	rts
   369                        L_Flash_Set1:
   370 00:F3D4: 15 8A F5      	JSR		F_Clr12
   371 00:F3D7: 15 98 F5      	JSR		F_Clr34
   372 00:F3DA: 09            	rts
   373                        L_Flash_Set2:
   374 00:F3DB: 15 8A F5      	JSR		F_Clr12
   375 00:F3DE: 09            	rts
   376                        L_Flash_Set3:
   377 00:F3DF: 15 98 F5      	JSR		F_Clr34
   378 00:F3E2: 09            	rts
   379                        
   380                        L_MS_Flash:
   381 00:F3E3: 15 BF F5      	JSR		F_ClrMs
   382 00:F3E6: 09            	RTS
   383                        ; ;=======================================================
   384                        L_Set_Flag_Prog:
   385 00:F3E7: 73 A1         	LDA		R_Set_Flag
   386 00:F3E9: 04            	CLC
   387 00:F3EA: 18            	ROL
   388 00:F3EB: 1B            	TAX
   389 00:F3EC: 63 F6 F3      	LDA		T_Set_Table+1,X
   390 00:F3EF: 0A            	PHA
   391 00:F3F0: 63 F5 F3      	LDA		T_Set_Table,X
   392 00:F3F3: 0A            	PHA
   393 00:F3F4: 09            	RTS
   394                        
   395                        T_Set_Table:
   396 00:F3F5: FC F3         	DW		L_Flag_Set0-1		;;R_Set_Flag=0
   397 00:F3F7: 19 F4         	DW		L_Flag_Set1-1		;;R_Set_Flag=1
   398 00:F3F9: 33 F4         	DW		L_Flag_Set2-1		;;R_Set_Flag=2
   399 00:F3FB: 4C F4         	DW		L_Flag_Set3-1		;;R_Set_Flag=3
   400                        
   401                        L_Flag_Set0:
   402 00:F3FD: 31 9D 0B      	BBR1	R_Key_Flag, L_REALSE_CTW7KEY_SecFlag  ;;判断bit1=0?  =0：不是5key，跳转
   403 00:F400: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   404 00:F402: 15 20 F7      	JSR		R_CtwInc_Min				;;"分"加
   405 00:F405: 73 AC         	LDA		R_Stw_Min
   406 00:F407: 15 DD F5      	JSR		L_Dis_Digit12
   407 00:F40A: 09            	RTS
   408                        L_REALSE_CTW7KEY_SecFlag:
   409 00:F40B: 32 9D 0B      	BBR2	R_Key_Flag,?RTS  ;;判断bit2=0?  =0：不是7key，跳转
   410 00:F40E: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   411 00:F410: 15 1C F7      	JSR		R_CtwInc_Sec				;;"秒"加
   412 00:F413: 73 AB         	LDA		R_Stw_Sec
   413 00:F415: 15 F0 F5      	JSR		L_Dis_Digit34
   414 00:F418: 09            	RTS
   415                        ?RTS:
   416 00:F419: 09            	rts
   417                        
   418                        
   419                        L_Flag_Set1:					;;12/24HR
   420 00:F41A: 31 9D 06      	BBR1	R_Key_Flag, L_REALSE_7KEY_12or24Flag  ;;判断bit1=0?  =0：不是5key，跳转
   421 00:F41D: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   422 00:F41F: 15 2D F4      	JSR		L_REALSE_12or24Flag
   423 00:F422: 09            	RTS
   424                        L_REALSE_7KEY_12or24Flag:
   425 00:F423: 32 9D 06      	BBR2	R_Key_Flag,?RTS  	;;判断bit2=0?  =0：不是7key，跳转
   426 00:F426: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   427 00:F428: 15 2D F4      	JSR		L_REALSE_12or24Flag
   428 00:F42B: 09            	RTS
   429                        ?RTS:
   430 00:F42C: 09            	rts
   431                        
   432                        L_REALSE_12or24Flag:
   433 00:F42D: 73 9A         	LDA		Sys_Flag_B
   434 00:F42F: 52 20         	EOR		#BIT5
   435 00:F431: 7F 9A         	STA		Sys_Flag_B			;;改变bit5位
   436 00:F433: 09            	RTS
   437                        
   438                        
   439                        L_Flag_Set2:
   440 00:F434: 31 9D 09      	BBR1	R_Key_Flag, L_REALSE_7KEY_HrFlag  ;;判断bit1=0?  =0：不是5key，跳转
   441 00:F437: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   442 00:F439: 15 C0 F6      	JSR		F_HrInc				;;"时"加
   443 00:F43C: 15 37 F7      	JSR		L_Dis_TimeHr
   444 00:F43F: 09            	RTS
   445                        L_REALSE_7KEY_HrFlag:
   446 00:F440: 32 9D 09      	BBR2	R_Key_Flag,?RTS  ;;判断bit2=0?  =0：不是7key，跳转
   447 00:F443: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   448 00:F445: 15 C6 F6      	JSR		F_HrDec				;;"时"减
   449 00:F448: 15 37 F7      	JSR		L_Dis_TimeHr
   450 00:F44B: 09            	RTS
   451                        ?RTS:
   452 00:F44C: 09            	rts
   453                        
   454                        L_Flag_Set3:
   455 00:F44D: 31 9D 09      	BBR1	R_Key_Flag, L_REALSE_7KEY_MinFlag  ;;判断bit1=0?  =0：不是5key，跳转
   456 00:F450: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   457 00:F452: 15 CC F6      	JSR		F_MinInc				;;"分"加
   458 00:F455: 15 37 F7      	JSR		L_Dis_TimeHr
   459 00:F458: 09            	RTS
   460                        L_REALSE_7KEY_MinFlag:
   461 00:F459: 32 9D 09      	BBR2	R_Key_Flag,?RTS	 ;;判断bit2=0?  =0：不是7key，跳转
   462 00:F45C: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   463 00:F45E: 15 D0 F6      	JSR		F_MinDec				;;"分"减
   464 00:F461: 15 37 F7      	JSR		L_Dis_TimeHr
   465 00:F464: 09            	RTS
   466                        ?RTS:
   467 00:F465: 09            	rts
   468                        ; ;=======================================================
   469                        L_FastAdd_Prog:
   470 00:F466: 28 9B         	SMB0	Sys_Flag_C			;;标记快加
   471 00:F468: 73 A1         	LDA		R_Set_Flag
   472 00:F46A: 04            	CLC
   473 00:F46B: 18            	ROL
   474 00:F46C: 1B            	TAX
   475 00:F46D: 63 77 F4      	LDA		T_FastAdd_Table+1,X
   476 00:F470: 0A            	PHA
   477 00:F471: 63 76 F4      	LDA		T_FastAdd_Table,X
   478 00:F474: 0A            	PHA
   479 00:F475: 09            	RTS
   480                        
   481                        T_FastAdd_Table:
   482 00:F476: 7D F4         	DW		L_FastAdd_Set0-1		;;R_Set_Flag=0
   483 00:F478: 9A F4         	DW		L_FastAdd_Set1-1		;;R_Set_Flag=1
   484 00:F47A: 9B F4         	DW		L_FastAdd_Set2-1		;;R_Set_Flag=2
   485 00:F47C: A2 F4         	DW		L_FastAdd_Set3-1		;;R_Set_Flag=3
   486                        
   487                        L_FastAdd_Set0:
   488 00:F47E: 31 9D 0B      	BBR1	R_Key_Flag, L_FsatAdd_CTW7KEY_SecFlag  ;;判断bit1=0?  =0：不是5key，跳转
   489 00:F481: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   490 00:F483: 15 20 F7      	JSR		R_CtwInc_Min				;;"分"加
   491 00:F486: 73 AC         	LDA		R_Stw_Min
   492 00:F488: 15 DD F5      	JSR		L_Dis_Digit12
   493 00:F48B: 09            	RTS
   494                        L_FsatAdd_CTW7KEY_SecFlag:
   495 00:F48C: 32 9D 0B      	BBR2	R_Key_Flag,?RTS  ;;判断bit1=0?  =0：不是7key，跳转
   496 00:F48F: 22 9D         	RMB2	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   497 00:F491: 15 1C F7      	JSR		R_CtwInc_Sec				;;"秒"加
   498 00:F494: 73 AB         	LDA		R_Stw_Sec
   499 00:F496: 15 F0 F5      	JSR		L_Dis_Digit34
   500 00:F499: 09            	rts
   501                        ?RTS:
   502 00:F49A: 09            	RTS
   503                        L_FastAdd_Set1:
   504 00:F49B: 09            	rts
   505                        L_FastAdd_Set2:
   506 00:F49C: 15 C0 F6      	JSR		F_HrInc				;;"时"加
   507 00:F49F: 15 37 F7      	JSR		L_Dis_TimeHr
   508 00:F4A2: 09            	RTS
   509                        
   510                        L_FastAdd_Set3:
   511 00:F4A3: 15 CC F6      	JSR		F_MinInc				;;"分"加
   512 00:F4A6: 15 2B F6      	JSR		L_Dis_TimeMin
   513 00:F4A9: 09            	RTS
   514                        ; ;=======================================================
   515                        L_FastDec_Prog:
   516 00:F4AA: 28 9B         	SMB0	Sys_Flag_C		;;标记快减
   517 00:F4AC: 73 A1         	LDA		R_Set_Flag
   518 00:F4AE: 04            	CLC
   519 00:F4AF: 18            	ROL
   520 00:F4B0: 1B            	TAX
   521 00:F4B1: 63 BB F4      	LDA		T_FastDec_Table+1,X
   522 00:F4B4: 0A            	PHA
   523 00:F4B5: 63 BA F4      	LDA		T_FastDec_Table,X
   524 00:F4B8: 0A            	PHA
   525 00:F4B9: 09            	RTS
   526                        
   527                        T_FastDec_Table:
   528 00:F4BA: C1 F4         	DW		L_FastDec_Set0-1		;;R_Set_Flag=0
   529 00:F4BC: DE F4         	DW		L_FastDec_Set1-1		;;R_Set_Flag=1
   530 00:F4BE: DF F4         	DW		L_FastDec_Set2-1		;;R_Set_Flag=2
   531 00:F4C0: E6 F4         	DW		L_FastDec_Set3-1		;;R_Set_Flag=3
   532                        
   533                        L_FastDec_Set0:
   534 00:F4C2: 31 9D 0B      	BBR1	R_Key_Flag, L_FsatAdd_STW7KEY_SecFlag  ;;判断bit1=0?  =0：不是5key，跳转
   535 00:F4C5: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   536 00:F4C7: 15 20 F7      	JSR		R_CtwInc_Min				;;"分"加
   537 00:F4CA: 73 AC         	LDA		R_Stw_Min
   538 00:F4CC: 15 DD F5      	JSR		L_Dis_Digit12
   539 00:F4CF: 09            	RTS
   540                        L_FsatAdd_STW7KEY_SecFlag:
   541 00:F4D0: 32 9D 0B      	BBR2	R_Key_Flag,?RTS  ;;判断bit1=0?  =0：不是7key，跳转
   542 00:F4D3: 22 9D         	RMB2	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   543 00:F4D5: 15 1C F7      	JSR		R_CtwInc_Sec				;;"秒"加
   544 00:F4D8: 73 AB         	LDA		R_Stw_Sec
   545 00:F4DA: 15 F0 F5      	JSR		L_Dis_Digit34
   546 00:F4DD: 09            	rts
   547                        ?RTS:
   548 00:F4DE: 09            	RTS
   549                        
   550                        L_FastDec_Set1:
   551 00:F4DF: 09            	rts
   552                        L_FastDec_Set2:
   553 00:F4E0: 15 C6 F6      	JSR		F_HrDec				;;"时"减
   554 00:F4E3: 15 37 F7      	JSR		L_Dis_TimeHr
   555 00:F4E6: 09            	RTS
   556                        
   557                        L_FastDec_Set3:
   558 00:F4E7: 15 D0 F6      	JSR		F_MinDec				;;"分"减
   559 00:F4EA: 15 2B F6      	JSR		L_Dis_TimeMin
   560 00:F4ED: 09            	RTS
   561                        
   562                        
   563                        ;============================================================
   564                        Stz_Fast_Hold_Key:
   565 00:F4EE: 53 00         	LDA		#0
   566 00:F4F0: 7F BF         	STA		R_Fast_Time
   567 00:F4F2: 7F BE         	STA		R_KeyHold_Time
   568 00:F4F4: 09            	RTS
   569                        ;============================================================
   570                        ;===============================================================
   571                        ; F_KeyUpdateDis:
   572                        ; 	JSR		F_ClearScreen
   573                        ; 	; JMP		L_Display_Prog
   574                        
   575                        
   576                        ; L_Beep_Control_Prog:			;控制声音频率
   577                        ; 	LDA		Sys_Flag_B
   578                        ; 	AND		#BIT2				;静音状态不发出声音
   579                        ; 	BNE		L_StzVoice
   580                        
   581                        ; 	LDA     Sys_Flag_B
   582                        ;     AND     #BIT3
   583                        ;     BEQ     L_Set16HzBIT
   584                        
   585                        ; 	LDA		Sys_Flag_B
   586                        ; 	AND		#BIT3_
   587                        ; 	STA		Sys_Flag_B
   588                        
   589                        
   590                        
   591                        ; 	LDA		R_Voice_Unit
   592                        ; 	BEQ		L_End_OpenBeep
   593                        ; 	DEC		R_Voice_Unit
   594                        ; 	BNE		L_ContinueJudge
   595                        ; 	;JSR		L_LightOff
   596                        ; 	BRA		L_CloseBeep
   597                        ; L_ContinueJudge:
   598                        ; 	LDA		R_Voice_Unit
   599                        ; 	AND		#BIT0
   600                        ; 	BEQ		L_JudgeOpenBeep	;L_OpenBeep
   601                        ; 	BRA		L_CloseBeep
   602                        ; ;	JSR		L_LightOn
   603                        ; L_StzVoice:
   604                        ; 	LDA		#0
   605                        ; 	STA		R_Voice_Unit
   606                        ; L_CloseBeep:
   607                        ; 	PB2_PB2_NMOS
   608                        ; 	PB3_PB3_NMOS
   609                        ; 	LDA	 #$FF
   610                        ; 	STA	 P_PB
   611                        ; 	PWM_OFF
   612                        ; 	RTS
   613                        
   614                        ; L_JudgeOpenBeep:
   615                        ; ;	JSR		L_LightOff
   616                        ; L_OpenBeep:
   617                        ; 	PB2_PWM
   618                        ;     LDA	 #$FF
   619                        ; 	STA	 P_PB
   620                        ; 	PB3_PWM
   621                        ; 	PWM_ON
   622                        
   623                        ; ?3Key:
   624                        ;     TONE_4KHZ_3_4_Duty
   625                        ; 	;TONE_2KHZ_3_4_Duty
   626                        ; 	;PWM_ON
   627                        ; 	RTS
   628                        ; L_End_OpenBeep:
   629                        ; 	RTS
   630                        
   631                        ; L_Set16HzBIT:
   632                        ; 	LDA		Sys_Flag_B
   633                        ; 	ORA		#BIT3
   634                        ; 	STA		Sys_Flag_B
   635                        ; 	RTS
   636                        ;;--------------------------------------------------------------
   637                        ;;==============================================================
   638                        ;;==============================================================
   639                        ; F_KeyIoPCInputLow:
   640                        ; 	LDA		PCDIR_TEMP
   641                        ; 	AND		#00000000B
   642                        ; 	STA		PCDIR_TEMP
   643                        ; 	STA		PCDIR
   644                        ; 	LDA		PC_TEMP
   645                        ; 	AND		#00000000B
   646                        ; 	STA		PC_TEMP
   647                        ; 	STA		PC
   648                        ; 	NOP
   649                        ; 	LDA		PCDIR_TEMP
   650                        ; 	ORA		#00111111B
   651                        ; 	STA		PCDIR_TEMP
   652                        ; 	STA		PCDIR
   653                        ; 	LDA		PC_TEMP
   654                        ; 	ORA		#00111111B
   655                        ; 	STA		PC_TEMP
   656                        ; 	STA		PC
   657                        ; 	RTS
   658                        
   659                        ; F_KeyIoPCOutputLow:
   660                        ; 	LDA		PCDIR_TEMP
   661                        ; 	AND		#00000000B
   662                        ; 	STA		PCDIR_TEMP
   663                        ; 	STA		PCDIR
   664                        ; 	LDA		PC_TEMP
   665                        ; 	AND		#00000000B
   666                        ; 	STA		PC_TEMP
   667                        ; 	STA		PC
   668                        ; 	RTS
   669                        
   670                        
   671                        ; F_KeyIoPAOutputLow:
   672                        ; 	LDA		PADIR_TEMP
   673                        ; 	AND		#11111011B
   674                        ; 	STA		PADIR_TEMP
   675                        ; 	STA		PADIR
   676                        ; 	LDA		PA_TEMP
   677                        ; 	ORA		#00000100B
   678                        ; 	STA		PA_TEMP
   679                        ; 	STA		PA
   680                        ; 	RTS
   681                        
   682                        F_KeyIoPAInputHigh:
   683 00:F4F5: 73 CB         	LDA		PADIR_TEMP
   684 00:F4F7: 50 A4         	ORA		#10100100B
   685 00:F4F9: 7F CB         	STA		PADIR_TEMP
   686 00:F4FB: 7F 04         	STA		PADIR
   687 00:F4FD: 73 CC         	LDA		PA_TEMP
   688 00:F4FF: 51 5B         	AND		#01011011B
   689 00:F501: 7F CC         	STA		PA_TEMP
   690 00:F503: 7F 01         	STA		PA
   691 00:F505: 09            	RTS
   692                        
   693                        
   694                        ;;===========================
   695                        L_ScanKey_Delay_Prog:		;等待功能，循环
   696 00:F506: 53 F0         	LDA		#$F0
   697 00:F508: 7F C2         	STA		P_Temp
   698                        L_Loop_ScanKey_Delay:
   699 00:F50A: 78 C2         	INC		P_Temp
   700 00:F50C: 12 FC         	BNE		L_Loop_ScanKey_Delay
   701 00:F50E: 09            	RTS
   702                        ;;===========================
   703                        
   704                        ;;==========================
   705                        
   706                        ;===========================
   707                        
   708                        ;=================================================
   709                        ; Judge_Stw_Ending_Voice:
   710                        ;     LDA     Sys_Flag_B
   711                        ;     AND     #BIT4
   712                        ;     BNE     Judge_Stw_Ending_Voice_AlRun
   713                        
   714                        ; 	LDA		R_Key_Flag
   715                        ; 	AND		#BIT7
   716                        ; 	BNE		Skip_Then
   717                        
   718                        ; 	BRA		Judge_Stw_Ending_Voice_End
   719                        
   720                        ; Judge_Stw_Ending_Voice_AlRun:
   721                        ; 	LDA     Sys_Flag_B
   722                        ;     AND     #BIT4_
   723                        ; 	STA		Sys_Flag_B
   724                        
   725                        ; 	LDA		#0
   726                        ; 	STA		R_Beep_Time
   727                        ; ;	JSR		Judge_F_AlarmBeepControl
   728                        ; 	LDA		R_KeyValue
   729                        ; 	CMP		#D_Key4
   730                        ; 	BNE		Skip_Then
   731                        
   732                        ; 	LDA		Sys_Flag_B
   733                        ; 	ORA		#BIT1
   734                        ; 	STA		Sys_Flag_B
   735                        
   736                        
   737                        ; ;	JSR		Judge_Alarm_Spl
   738                        
   739                        ; 	JSR		F_DisZZ
   740                        
   741                        ;     BRA     Skip_Then
   742                        ; Skip_Then:
   743                        ; 	LDA     R_Key_Flag
   744                        ;     ORA     #BIT7
   745                        ;     STA     R_Key_Flag
   746                        
   747                        ;     SEC
   748                        ;     RTS
   749                        ; Judge_Stw_Ending_Voice_End:
   750                        ;     CLC
   751                        ;     RTS
   752                        ; ;===============
   753                        ; Judge_NoVoice:
   754                        ; 	LDA		Sys_Flag_B
   755                        ; 	AND		#BIT2
   756                        ; 	BEQ		Judge_NoVoice_End
   757                        ; 	JSR		F_DisMute
   758                        ; 	RTS
   759                        ; Judge_NoVoice_End:
   760                        ; 	JSR		F_ClrMute
   761                        ; 	RTS
   761                        
   132                        ; .include    Key\KeyNumb.asm
   133                        ; .include    Key\KeyLock.asm
   134                        ; .include    Key\KeyShort.asm
   135                        ; .include    Key\KeyLong.asm
   136                        
   137                        .include    Half_S.asm
     1                        ;=======================================================
     2                        L_2Hz_Prog:
     3 00:F50F: 73 99         	LDA		Sys_Flag_A
     4 00:F511: 51 01         	AND		#BIT0
     5 00:F513: 13 11         	BEQ		L_End_2Hz_Prog
     6                        
     7                        
     8 00:F515: 73 99         	LDA		Sys_Flag_A
     9 00:F517: 51 FE         	AND		#~BIT0		;清半秒标志
    10 00:F519: 52 02         	EOR		#BIT1
    11 00:F51B: 7F 99         	STA		Sys_Flag_A
    12                        
    13                        	;JSR		Judge_Alarm_T1_Flash
    14                        	;JSR		Judge_Stw_TimeKeeping
    15                        	;JSR		Judge_Stw_Forward
    16                        
    17 00:F51D: 73 99         	LDA		Sys_Flag_A
    18 00:F51F: 51 02         	AND		#BIT1
    19 00:F521: 13 04         	BEQ		L_1Hz_Prog
    20                        
    21 00:F523: 15 B1 F3      	JSR		L_1Hz_Flash_Prog	;;闪烁
    22                        L_End_2Hz_Prog:
    23 00:F526: 09            	RTS
    24                        ;========================================================
    25                        
    26                        L_1Hz_Prog:
    27 00:F527: 15 79 F6      	JSR		F_Update_Time_Prog
    28 00:F52A: 15 89 F6      	JSR		F_Update_STW_Prog	;;更新计时
    29 00:F52D: 15 37 F5      	JSR		L_Nokey_Save		;;10S无操作保存退出设置
    30 00:F530: 15 4A F5      	JSR		L_STWKey_Exit		;;计时模式30S无操作退出
    31 00:F533: 15 88 F3      	JSR		L_Display_Mode0Prog
    32                        
    33                        L_1Hz_Prog_End:
    34 00:F536: 09            	RTS
    35                        
    36                        ; ;======================================================
    37                        ; ;============================================================
    38                        ;;设置过程中无操作10S，自动保存当前值，并退出设置模式
    39                        L_Nokey_Save:
    40 00:F537: 73 A2         	LDA		R_No_Key
    41 00:F539: 56 0A         	CMP		#10
    42 00:F53B: 10 07         	BCC		L_Inc_Nokey_Time
    43 00:F53D: 53 00         	LDA		#0
    44 00:F53F: 7F A1         	STA		R_Set_Flag
    45 00:F541: 7F A2         	STA		R_No_Key
    46 00:F543: 09            	RTS
    47                        L_Inc_Nokey_Time:
    48 00:F544: 73 A2         	LDA		R_No_Key
    49 00:F546: 03            	INC
    50 00:F547: 7F A2         	STA		R_No_Key
    51 00:F549: 09            	RTS
    52                        ;===============================================================
    53                        ;==============================================================
    54                        ;;计时结束后30秒内无操作退出到时间界面
    55                        L_STWKey_Exit:
    56 00:F54A: 30 9A 12      	BBR0	Sys_Flag_B,?RTS
    57 00:F54D: 39 9A 0F      	BBS1	Sys_Flag_B,?RTS
    58 00:F550: 73 A3         	LDA		R_STW_Key
    59 00:F552: 56 1E         	CMP		#30
    60 00:F554: 10 0A         	BCC		L_Inc_STWKey_Time
    61 00:F556: 53 00         	LDA		#0
    62 00:F558: 7F A1         	STA		R_Set_Flag
    63 00:F55A: 7F A3         	STA		R_STW_Key
    64 00:F55C: 20 9A         	RMB0	Sys_Flag_B
    65 00:F55E: 09            	RTS
    66                        
    67                        ?RTS:
    68 00:F55F: 09            	RTS
    69                        L_Inc_STWKey_Time:
    70 00:F560: 73 A3         	LDA		R_STW_Key
    71 00:F562: 03            	INC
    72 00:F563: 7F A3         	STA		R_STW_Key
    73 00:F565: 09            	RTS
    74                        ;===============================================================
    75                        ; L_1Hz_Prog_Num:
    76                        ; 	JSR		F_Update_Time_Prog
    77                        
    78                        ; 	JSR		Judge_F_AlarmBeepControl	;闹钟声音
    79                        ; 	JSR		F_StwBeepControl
    80                        
    81                        ; 	JSR		L_Mode_Prog
    82                        ; L_Skip_Update_Time_Prog:
    83                        ; 	RTS
    84                        ; ;========================================================
    85                        
    86                        ; Judge_Lock_Num:
    87                        ; 	LDA		R_Mode
    88                        ; 	CMP		#D_Time_Mode
    89                        ; 	BNE		Judge_Lock_Num_End
    90                        
    91                        ; 	LDA		Sys_Flag_A
    92                        ; 	AND		#BIT6
    93                        ; 	BNE		Judge_Lock_Num_End
    94                        
    95                        ; 	LDA		R_Num
    96                        ; 	DEC
    97                        ; 	STA		R_Num
    98                        ; 	BNE		Judge_Lock_Num_End
    99                        
   100                        ; 	LDA		Sys_Flag_A
   101                        ; 	ORA		#BIT6
   102                        ; 	STA		Sys_Flag_A
   103                        ; Judge_Lock_Num_End:
   104                        ; 	RTS
   105                        
   105                        
   138                        .include    Display.asm
     1                        ;===========================================================
     2                         ;;;;;;;;;;;;;;;;;;;;Display Program;;;;;;;;;;;;;;;;;;;;;;;;
     3                        ;===========================================================
     4                        ; To_Timer:
     5                        ; 	JSR		L_Dis_Time
     6                        ; 	BRA		L_End_Mode_Prog
     7                        ; To_Stw:
     8                        ; 	JSR		L_Dis_Stw_Mode
     9                        ; 	BRA		L_End_Mode_Prog
    10                        ; To_AL:
    11                        ; 	JSR		L_Dis_Al_Mode
    12                        ; 	BRA		L_End_Mode_Prog
    13                        
    14                        
    15                        
    16                        ;lcd_alarm
    17                        ; L_Mode_Prog:
    18                        ; 	LDA		R_Mode
    19                        ; 	JSR		Judge_Alarm_Start
    20                        ; 	JSR		Judge_NoVoice
    21                        
    22                        ; 	JSR		Judge_Alarm_T1_Flash
    23                        
    24                        ; 	LDA		R_Mode
    25                        ; 	CMP		#D_Time_Mode
    26                        ; 	BEQ		To_Timer
    27                        ; 	CMP		#D_Stw_Mode
    28                        ; 	BEQ		To_Stw
    29                        ; 	CMP		#D_Al_Mode
    30                        ; 	BEQ		To_AL
    31                        
    32                        
    33                        L_End_Mode_Prog:
    34 00:F566: 09            	RTS
    35                        
    36                        
    37                        ; L_Display_Prog:
    38                        ; 	JMP		L_Mode_Prog
    39                        
    40                        ;========================================
    41                        
    42                        L_STWDisplay_Prog:
    43 00:F567: 15 80 F5      	JSR		F_DisCol
    44 00:F56A: 15 BA F5      	JSR		F_DisMs
    45                        
    46 00:F56D: 53 05             LDA     #$5
    47 00:F56F: 7F AC         	STA		R_Stw_Min
    48 00:F571: 73 AC         	LDA		R_Stw_Min
    49 00:F573: 15 DD F5      	JSR		L_Dis_Digit12
    50 00:F576: 53 00         	LDA		#$0
    51 00:F578: 7F AB         	STA		R_Stw_Sec
    52 00:F57A: 73 AB         	LDA		R_Stw_Sec
    53 00:F57C: 15 F0 F5      	JSR		L_Dis_Digit34
    54 00:F57F: 09            	RTS
    55                        
    56                        F_DisCol:
    57 00:F580: 5E 1C         	LDX		#lcd_col
    58 00:F582: 16 58 F1      	JMP		F_DispSymbol	;显示 两点
    59                        F_ClrCol:
    60 00:F585: 5E 1C         	LDX		#lcd_col
    61 00:F587: 16 5F F1      	JMP		F_ClrpSymbol
    62                        
    63                        F_Clr12:
    64 00:F58A: 53 0A         	LDA		#0AH
    65 00:F58C: 5E 00         	LDX		#lcd_d1
    66 00:F58E: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    67 00:F591: 53 0A         	LDA		#0AH
    68 00:F593: 5E 07         	LDX		#lcd_d2
    69 00:F595: 16 14 F1      	JMP		L_Dis_8Bit_DigitDot_Prog
    70                        
    71                        F_Clr34:
    72 00:F598: 53 0A         	LDA		#0AH
    73 00:F59A: 5E 0E         	LDX		#lcd_d3
    74 00:F59C: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    75 00:F59F: 53 0A         	LDA		#0AH
    76 00:F5A1: 5E 15         	LDX		#lcd_d4
    77 00:F5A3: 16 14 F1      	JMP		L_Dis_8Bit_DigitDot_Prog
    78                        
    79                        F_DisAm:
    80 00:F5A6: 5E 1D         	LDX		#lcd_am
    81 00:F5A8: 16 58 F1      	JMP		F_DispSymbol	;显示AM
    82                        F_ClrAm:
    83 00:F5AB: 5E 1D         	LDX		#lcd_am
    84 00:F5AD: 16 5F F1      	JMP		F_ClrpSymbol
    85                        
    86                        
    87                        F_DisPM:
    88 00:F5B0: 5E 1E         	LDX		#lcd_pm
    89 00:F5B2: 16 58 F1      	JMP		F_DispSymbol	;显示PM
    90                        F_ClrPm:
    91 00:F5B5: 5E 1E         	LDX		#lcd_pm
    92 00:F5B7: 16 5F F1      	JMP		F_ClrpSymbol
    93                        
    94                        F_DisMs:
    95 00:F5BA: 5E 1F         	LDX		#lcd_ms
    96 00:F5BC: 16 58 F1      	JMP		F_DispSymbol	;显示MS
    97                        
    98                        
    99                        F_ClrMs:
   100 00:F5BF: 5E 1F         	LDX		#lcd_ms
   101 00:F5C1: 16 5F F1      	JMP		F_ClrpSymbol	;显示MS
   102                        ; F_DisClock:
   103                        ; 	LDX		#lcd_clock
   104                        ; 	JMP		F_DispSymbol	;显示时钟图标
   105                        
   106                        ; F_DisMute:
   107                        ; 	LDX		#lcd_mute
   108                        ; 	JMP		F_DispSymbol	;显示 静音 图标
   109                        
   110                        ; F_DisTime_end:
   111                        ; 	LDX		#lcd_time_end
   112                        ; 	JMP		F_DispSymbol	;显示时间到图标
   113                        
   114                        ; F_DisTimekeeping:
   115                        ; 	LDX		#lcd_timekeeping
   116                        ; 	JMP		F_DispSymbol	;显示计时图标
   117                        
   118                        ; F_DisStwOne:
   119                        ; 	LDX		#lcd_StwOne
   120                        ; 	JMP		F_DispSymbol
   121                        
   122                        ; F_DisStwTwo:
   123                        ; 	LDX		#lcd_StwTwo
   124                        ; 	JMP		F_DispSymbol
   125                        
   126                        ; F_DisZZ:
   127                        ; 	LDX		#lcd_ZZ
   128                        ; 	JMP		F_DispSymbol
   129                        
   130                        ; F_DisForward:
   131                        ; 	LDX		#lcd_forward
   132                        ; 	JMP		F_DispSymbol	;显示 正 图标
   133                        
   134                        ; F_DisT1:
   135                        ; 	LDX		#lcd_T1
   136                        ; 	JMP		F_DispSymbol	;显示时间到图标
   137                        ; ;=========================================
   138                        ; F_ClrClock:
   139                        ; 	LDX		#lcd_clock
   140                        ; 	JMP		F_ClrpSymbol	;清除时钟图标
   141                        
   142                        ; F_ClrMute:
   143                        ; 	LDX		#lcd_mute
   144                        ; 	JMP		F_ClrpSymbol	;清除 静音 图标
   145                        
   146                        ; F_ClrTime_end:
   147                        ; 	LDX		#lcd_time_end
   148                        ; 	JMP		F_ClrpSymbol	;清除时间到图标
   149                        
   150                        ; F_ClrTimekeeping:
   151                        ; 	LDX		#lcd_timekeeping
   152                        ; 	JMP		F_ClrpSymbol	;清除计时图标
   153                        
   154                        ; F_ClrStwOne:
   155                        ; 	LDX		#lcd_StwOne
   156                        ; 	JMP		F_ClrpSymbol
   157                        
   158                        ; F_ClrStwTwo:
   159                        ; 	LDX		#lcd_StwTwo
   160                        ; 	JMP		F_ClrpSymbol
   161                        
   162                        ; F_ClrZZ:
   163                        ; 	LDX		#lcd_ZZ
   164                        ; 	JMP		F_ClrpSymbol
   165                        
   166                        ; F_ClrForward:
   167                        ; 	LDX		#lcd_forward
   168                        ; 	JMP		F_ClrpSymbol	;清除 正 图标
   169                        
   170                        ; F_ClrT1:
   171                        ; 	LDX		#lcd_T1
   172                        ; 	JMP		F_ClrpSymbol	;显示时间到图标
   173                        ;==========================================
   174                        ;L_Judge_ClrAllDis:
   175                        ;	LDA		R_Bop
   176                        ;	BEQ		L_5Alarm_ClrAllDis
   177                        ;	CMP		#D_Num
   178                        ;	BEQ		L_Numtimer_ClrAllDis
   179                        ;	CMP		#D_Timer5
   180                        ;	BCC		L_4Timer_ClrAllDis
   181                        ;	LDX		#lcd_alarm
   182                        ;	JSR		F_ClrpSymbol
   183                        
   184                        ;	LDX		#lcd_motor
   185                        ;	JSR		F_ClrpSymbol
   186                        ;	RTS
   187                        
   188                        ;L_5Alarm_ClrAllDis:
   189                        ;	LDX		#lcd_t1_t
   190                        ;	JSR		F_ClrpSymbol
   191                        ;	LDX		#lcd_t2_t
   192                        ;	JSR		F_ClrpSymbol
   193                        ;	LDX		#lcd_t3_t
   194                        ;	JSR		F_ClrpSymbol
   195                        ;	LDX		#lcd_t4_t
   196                        ;	JSR		F_ClrpSymbol
   197                        ;	LDX		#lcd_t5_t
   198                        ;	JSR		F_ClrpSymbol
   199                        ;	LDX		#lcd_timer
   200                        ;	JSR		F_ClrpSymbol
   201                        ;	LDX		#lcd_up
   202                        ;	JSR		F_ClrpSymbol
   203                        ;	LDX		#lcd_down
   204                        ;	JMP		F_ClrpSymbol
   205                        
   206                        ;L_4Timer_ClrAllDis:
   207                        ;	LDX		#lcd_motor
   208                        ;	JSR		F_ClrpSymbol
   209                        
   210                        ;	LDX		#lcd_alarm
   211                        ;	JSR		F_ClrpSymbol
   212                        ;	LDX		#lcd_t5_t
   213                        ;	JSR		F_ClrpSymbol
   214                        ;	LDX		#lcd_t5_5
   215                        ;	JSR		F_ClrpSymbol
   216                        ;	LDX		#lcd_al5
   217                        ;	JMP		F_ClrpSymbol
   218                        
   219                        L_Numtimer_ClrAllDis:
   220 00:F5C4: 53 00         	LDA		#0
   221 00:F5C6: 4F 01 02      	STA		0201H
   222 00:F5C9: 4F 02 02      	STA		0202H
   223 00:F5CC: 4F 09 02      	STA		0209H
   224 00:F5CF: 53 80         	LDA		#$80
   225 00:F5D1: 4F 03 02      	STA		0203H
   226 00:F5D4: 53 FE         	LDA		#$FE
   227 00:F5D6: 4F 0A 02      	STA		020AH
   228 00:F5D9: 4F 12 02      	STA		0212H
   229 00:F5DC: 09            	RTS
   230                        ;==========================================
   231                        L_Dis_Digit_AlHr:
   232                        L_Dis_Digit_TimeHr:
   233                        L_Dis_Digit_TimeMonth:
   234                        L_Dis_Digit_TimerHr:
   235                        L_Dis_Digit12:
   236 00:F5DD: 5E 00         	LDX		#lcd_d1
   237 00:F5DF: 0A            	PHA
   238 00:F5E0: 15 77 F1      	JSR		L_ROR_4Bit_Prog
   239                        	; TAX
   240                        	; LDA		Lcd_1_table,X
   241 00:F5E3: 5E 00         	LDX		#lcd_d1
   242 00:F5E5: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
   243 00:F5E8: 5E 07         	LDX		#lcd_d2
   244 00:F5EA: 0C            	PLA
   245                        
   246 00:F5EB: 51 0F         	AND		#$0F
   247 00:F5ED: 16 14 F1      	JMP		L_Dis_8Bit_DigitDot_Prog
   248                        	;BRA		F_Dis_2Digit
   249                        ;=====================================================
   250                        ;=====================================================
   251                        L_Dis_Digit_AlMin:
   252                        L_Dis_Digit_TimeMin:
   253                        L_Dis_Digit_TimeDay:
   254                        L_Dis_Digit_TimerMin:
   255                        L_Dis_Digit34:
   256 00:F5F0: 5E 0E         	LDX		#lcd_d3
   257 00:F5F2: 17 00         	BRA		F_Dis_2Digit
   258                        ;===============================================
   259                        L_Dis_Digit_AlSec:
   260                        L_Dis_Digit_TimeSec:
   261                        L_Dis_Digit_TimerSec:
   262                        L_Dis_Digit56:
   263                        ; 	LDX		#lcd_d5
   264                        ; ;	BRA		F_Dis_2Digit
   265                        F_Dis_2Digit:
   266 00:F5F4: 0A            	PHA
   267 00:F5F5: 15 77 F1      	JSR		L_ROR_4Bit_Prog
   268 00:F5F8: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
   269 00:F5FB: 7E C3         	LDX		P_Temp+1
   270 00:F5FD: 0C            	PLA
   271 00:F5FE: 51 0F         	AND		#$0F
   272 00:F600: 16 14 F1      	JMP		L_Dis_8Bit_DigitDot_Prog
   273                        ;===========================================================
   274                         ;;;;;;;;;;;;;;;;;;;;Flash Program;;;;;;;;;;;;;;;;;;;;;;;;
   275                        ;===========================================================
   276                        ;F_1Hz_Flash_Prog:
   277                        ;	LDA		R_Bop
   278                        ;	BEQ		L_1Hz_Flash_5Alarm
   279                        ;	CMP		#D_Num
   280                        ;	BEQ		L_1Hz_Flash_Num
   281                        ;L_1Hz_Flash_45Timer:
   282                        ;	JMP		L_Flash_Prog_5Timer
   283                        ;L_1Hz_Flash_5Alarm:
   284                        ;	JMP		L_Flash_Prog_5Alarm
   285                        ;L_1Hz_Flash_Num:
   286                        ;	JMP		L_Flash_Prog_Number
   287                        
   288                        L_Flash_Digit3:
   289 00:F603: 5E 0E         	LDX		#lcd_d3
   290                        L_Flash_Digit:
   291 00:F605: 53 0A         	LDA		#$0A
   292 00:F607: 16 14 F1      	JMP		L_Dis_8Bit_DigitDot_Prog
   293                        L_Flash_Digit4:
   294 00:F60A: 5E 15         	LDX		#lcd_d4
   295 00:F60C: 17 F7         	BRA		L_Flash_Digit
   296                        ; L_Flash_Digit5:
   297                        ; 	LDX		#lcd_d5
   298                        ; 	BRA		L_Flash_Digit
   299                        ; L_Flash_Digit6:
   300                        ; 	LDX		#lcd_d6
   301                        ; 	BRA		L_Flash_Digit
   302                        
   303                        L_Flash_Digit12:
   304 00:F60E: 53 AA         	LDA		#$AA
   305 00:F610: 16 DD F5      	JMP		L_Dis_Digit12
   306                        L_Flash_Digit34:
   307 00:F613: 53 AA         	LDA		#$AA
   308 00:F615: 16 F0 F5      	JMP		L_Dis_Digit34
   309                        L_Flash_Digit56:
   310 00:F618: 53 AA         	LDA		#$AA
   311 00:F61A: 16 F4 F5      	JMP		L_Dis_Digit56
   312                        
   313                        L_Flash_Digit23:
   314 00:F61D: 53 AA         	LDA		#$AA
   315 00:F61F: 5E 07         	LDX		#lcd_d2
   316 00:F621: 16 F4 F5      	JMP		F_Dis_2Digit
   317                        ;============================================================
   318                        ;============================================================
   319                        Lcd_1_table:
   320 00:F624: 00            	.BYTE 	00h	;0
   321 00:F625: 06            	.BYTE	06h	;1
   322 00:F626: 03            	.BYTE	03h	;2
   323                        
   324                        
   325                        
   326                        
   327                        ;============================================================
   327                        
   139                        .include    Time\Dis_number.asm
     1                        L_DisCol_Prog:
     2 00:F627: 15 80 F5      	JSR		F_DisCol
     3 00:F62A: 09            	RTS
     4                        
     5                        L_Dis_TimeMin:
     6 00:F62B: 73 A7         	LDA		R_Time_Min
     7 00:F62D: 15 F0 F5      	JSR		L_Dis_Digit34
     8 00:F630: 09            	RTS
     9                        
    10                        L_Key5_DisHR:
    11 00:F631: 15 85 F5      	JSR		F_ClrCol
    12 00:F634: 15 AB F5      	JSR		F_ClrAm
    13 00:F637: 15 B5 F5      	JSR		F_ClrPm
    14 00:F63A: 3D 9A 1F      	BBS5	Sys_Flag_B,L_Key5_Dis12HR
    15 00:F63D: 17 00         	BRA		L_Key5_Dis24HR
    16                        
    17                        L_Key5_Dis24HR:
    18 00:F63F: 53 02         	LDA		#2
    19 00:F641: 5E 00         	LDX		#lcd_d1
    20 00:F643: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    21 00:F646: 53 04         	LDA		#4
    22 00:F648: 5E 07         	LDX		#lcd_d2
    23 00:F64A: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    24 00:F64D: 53 76         	LDA		#76H
    25 00:F64F: 5E 0E         	LDX		#lcd_d3
    26 00:F651: 15 1C F1      	JSR		F_DispPro
    27 00:F654: 53 50         	LDA		#50H
    28 00:F656: 5E 15         	LDX		#lcd_d4
    29 00:F658: 15 1C F1      	JSR		F_DispPro
    30 00:F65B: 09            	RTS
    31                        
    32                        L_Key5_Dis12HR:
    33 00:F65C: 53 01         	LDA		#1
    34 00:F65E: 5E 00         	LDX		#lcd_d1
    35 00:F660: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    36 00:F663: 53 02         	LDA		#2
    37 00:F665: 5E 07         	LDX		#lcd_d2
    38 00:F667: 15 14 F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    39 00:F66A: 53 76         	LDA		#76H
    40 00:F66C: 5E 0E         	LDX		#lcd_d3
    41 00:F66E: 15 1C F1      	JSR		F_DispPro
    42 00:F671: 53 50         	LDA		#50H
    43 00:F673: 5E 15         	LDX		#lcd_d4
    44 00:F675: 15 1C F1      	JSR		F_DispPro
    45 00:F678: 09            	RTS
    46                        
    47                        
    47                        
   140                        .include    Time\Time.asm
     1                        ;=====================================================
     2                        ; ;=====================================================
     3                        F_Update_Time_Prog:
     4 00:F679: 15 D6 F6      	JSR		F_SecInc
     5 00:F67C: 10 0A         	BCC		L_End_Update_Time_Prog
     6 00:F67E: 15 CC F6      	JSR		F_MinInc
     7 00:F681: 10 05         	BCC		L_End_Update_Time_Prog
     8 00:F683: 15 C0 F6      	JSR		F_HrInc
     9 00:F686: 10 00         	BCC		L_End_Update_Time_Prog
    10                        
    11                        L_End_Update_Time_Prog:
    12                        	; JMP		L_CMP_Alarm_Prog
    13 00:F688: 09            	RTS
    14                        ;====================================================
    15                        F_Update_STW_Prog:
    16 00:F689: 2A 9A         	SMB2	Sys_Flag_B
    17 00:F68B: 3B 9A 14      	BBS3	Sys_Flag_B,L_End_MAX_STW_Prog		;判断是否到结束(正计时最大值)
    18 00:F68E: 31 9A 13      	BBR1	Sys_Flag_B,L_End_Update_STW_Prog	;;判断计时是否暂停，0：结束，不在继续计时
    19 00:F691: 32 9A 11      	BBR2	Sys_Flag_B,L_Update_STW_FORW_Prog	;;0：正计时/1：倒计时
    20 00:F694: 17 01         	BRA		L_Update_CTW_FORW_Prog
    21 00:F696: 09            	RTS
    22                        
    23                        
    24                        ;;倒计时
    25                        L_Update_CTW_FORW_Prog:
    26 00:F697: 15 2C F7      	JSR		R_CtwDec_Sec
    27 00:F69A: 11 05         	BCS		L_Update_CTW_FORW_End_Prog
    28 00:F69C: 15 30 F7      	JSR		R_CtwDec_Min
    29 00:F69F: 11 00         	BCS		L_Update_CTW_FORW_End_Prog
    30                        L_Update_CTW_FORW_End_Prog:
    31 00:F6A1: 09            	RTS
    32                        
    33                        L_End_MAX_STW_Prog:
    34 00:F6A2: 21 9A         	RMB1	Sys_Flag_B		;;正计时最大值，结束计时(暂停计时)
    35                        L_End_Update_STW_Prog:
    36 00:F6A4: 09            	RTS
    37                        
    38                        ;;正计时
    39                        L_Update_STW_FORW_Prog:
    40 00:F6A5: 15 1C F7      	JSR		R_CtwInc_Sec
    41 00:F6A8: 10 05         	BCC		L_Update_STW_FORW_End_Prog
    42 00:F6AA: 15 20 F7      	JSR		R_CtwInc_Min
    43 00:F6AD: 10 00         	BCC		L_Update_STW_FORW_End_Prog
    44                        L_Update_STW_FORW_End_Prog:
    45                        	;对比正计时最大值
    46 00:F6AF: 73 AC         	LDA		R_Stw_Min
    47 00:F6B1: 56 99         	CMP		#$99
    48 00:F6B3: 10 0A         	BCC		?RTS
    49 00:F6B5: 73 AB         	LDA		R_Stw_Sec
    50 00:F6B7: 56 59         	CMP		#$59
    51 00:F6B9: 10 04         	BCC		?RTS
    52 00:F6BB: 21 9A         	RMB1	Sys_Flag_B
    53 00:F6BD: 2B 9A         	SMB3	Sys_Flag_B		;;标记正计时达到99M59S
    54                        ?RTS:
    55 00:F6BF: 09            	RTS
    56                        ;====================================================
    57                        ;----------------------------------------------------
    58                        F_HrInc:
    59 00:F6C0: 5E 02         	LDX		#(R_Time_Hr-Time_str_Addr)
    60                        L_Inc_0_To_23_Prog:
    61                        L_Inc_To_24:
    62 00:F6C2: 53 23         	LDA		#$23
    63 00:F6C4: 17 14         	BRA		L_Inc_0_To_Any_Count_Prog
    64                        
    65                        F_HrDec:
    66 00:F6C6: 5E 02         	LDX		#(R_Time_Hr-Time_str_Addr)
    67 00:F6C8: 53 23         	LDA		#$23
    68 00:F6CA: 17 30         	BRA		L_Dec_To_0_Prog
    69                        
    70                        ; F_AlHrInc:	;注意范围
    71                        ; 	LDX		#(R_Al_Hr-Time_str_Addr)
    72                        ; 	LDA		#$23
    73                        ; 	; JMP		L_Inc_0_To_Any_Count_Prog
    74                        ; 	BRA		L_Inc_0_To_23_Prog
    75                        
    76                        ;----------------------------------------------------
    77                        F_MinInc:
    78 00:F6CC: 5E 00         	LDX		#(R_Time_Min-Time_str_Addr)
    79 00:F6CE: 17 08         	BRA		L_Inc_0_To_59_Prog
    80                        
    81                        F_MinDec:
    82 00:F6D0: 5E 00         	LDX		#(R_Time_Min-Time_str_Addr)
    83 00:F6D2: 53 59         	LDA		#$59
    84 00:F6D4: 17 26         	BRA		L_Dec_To_0_Prog
    85                        
    86                        ; F_MinSplDec:
    87                        ; 	LDX		#(R_Al_Min_Spl-Time_str_Addr)
    88                        ; 	LDA		#10
    89                        ; 	BRA		L_Dec_To_0_Prog
    90                        
    91                        ; F_SecSplDec:
    92                        ; 	LDX		#(R_Al_Sec_Spl-Time_str_Addr)
    93                        ; 	BRA		L_Dec_To_60_Prog
    94                        
    95                        
    96                        ; F_AlMinInc:
    97                        ; 	LDX		#(R_Al_Min-Time_str_Addr)
    98                        ; 	BRA		L_Inc_0_To_59_Prog
    99                        ; F_AlInc:
   100                        ; 	LDX		#(R_Al_Sec-Time_str_Addr)
   101                        ; 	BRA		L_Inc_0_To_59_Prog
   102                        
   103                        F_SecInc:
   104 00:F6D6: 5E 01         	LDX 	#(R_Time_Sec-Time_str_Addr)
   105                        L_Inc_0_To_59_Prog:
   106                        L_Inc_To_60:
   107 00:F6D8: 53 59         	LDA		#$59
   108                        L_Inc_0_To_Any_Count_Prog:
   109 00:F6DA: 7F C3         	STA		P_Temp+1	;最大值
   110 00:F6DC: 53 00         	LDA		#$00
   111                        L_Inc_Any_To_Any_Count_Prog:
   112 00:F6DE: 7F C2         	STA		P_Temp		;最小值
   113 00:F6E0: 63 27 18      	LDA		Time_Addr,X	;P_Temp+1
   114 00:F6E3: 76 C3         	CMP		P_Temp+1	;Time_Addr,X
   115 00:F6E5: 11 0C         	BCS		L_Inc_Over
   116 00:F6E7: 04            	CLC
   117 00:F6E8: 02            	SED
   118 00:F6E9: 63 27 18      	LDA		Time_Addr,X
   119 00:F6EC: 54 01         	ADC		#1
   120 00:F6EE: 6F 27 18      	STA		Time_Addr,X
   121 00:F6F1: 06            	CLD
   122 00:F6F2: 09            	RTS
   123                        L_Inc_Over:
   124 00:F6F3: 73 C2         	LDA		P_Temp
   125 00:F6F5: 6F 27 18      	STA		Time_Addr,X
   126 00:F6F8: 00            	SEC
   127 00:F6F9: 09            	RTS
   128                        ;=====================================================
   129                        L_Dec_To_60_Prog:
   130 00:F6FA: 53 59         	LDA		#$59
   131                        L_Dec_To_0_Prog:
   132 00:F6FC: 7F C2         	STA		P_Temp
   133 00:F6FE: 53 00         	LDA		#0
   134                        L_Dec_To_Anycount_Prog:
   135 00:F700: 00            	SEC
   136 00:F701: 65 27 18          SBC     Time_Addr,X
   137 00:F704: 13 0F         	BEQ		L_Dec_Over_Prog
   138 00:F706: 11 0D         	BCS		L_Dec_Over_Prog
   139                        
   140 00:F708: 00            	SEC
   141 00:F709: 02            	SED
   142 00:F70A: 63 27 18      	LDA		Time_Addr,X
   143 00:F70D: 55 01         	SBC		#1
   144 00:F70F: 6F 27 18      	STA		Time_Addr,X
   145 00:F712: 06            	CLD
   146 00:F713: 00            	SEC
   147 00:F714: 09            	RTS
   148                        L_Dec_Over_Prog:
   149 00:F715: 73 C2         	LDA		P_Temp
   150 00:F717: 6F 27 18      	STA		Time_Addr,X
   151 00:F71A: 04            	CLC
   152 00:F71B: 09            	RTS
   153                        ;=====================================================
   154                        R_CtwInc_Sec:
   155 00:F71C: 5E 04         	LDX		#(R_Stw_Sec-Time_str_Addr)
   156                        	; TXA
   157                        	; CLC
   158                        	; ADC		P_Temp+4
   159                        	; TAX
   160 00:F71E: 17 B8         	BRA		L_Inc_To_60
   161                        
   162                        R_CtwInc_Min:
   163 00:F720: 5E 05         	LDX		#(R_Stw_Min-Time_str_Addr)
   164 00:F722: 53 99         	LDA		#$99
   165                        	; TXA
   166                        	; CLC
   167                        	; ADC		P_Temp+4
   168                        	; TAX
   169 00:F724: 17 00         	BRA		L_Inc_0_To_99_Count_Prog
   170                        
   171                        L_Inc_0_To_99_Count_Prog:
   172 00:F726: 7F C3         	STA		P_Temp+1	;最大值
   173 00:F728: 53 00         	LDA		#$00
   174 00:F72A: 17 B2         	BRA		L_Inc_Any_To_Any_Count_Prog
   175                        
   176                        
   177                        ; F_StwHrInc:
   178                        ; 	LDX		#(R_Stw_Hr-Time_str_Addr)
   179                        ; 	TXA
   180                        ; 	CLC
   181                        ; 	ADC		P_Temp+4
   182                        ; 	TAX
   183                        ; 	LDA		#$23
   184                        ; 	BRA		L_Inc_0_To_Any_Count_Prog
   185                        ;-------------------------------------------------
   186                        
   187                        R_CtwDec_Sec:
   188 00:F72C: 5E 04         	LDX		#(R_Stw_Sec-Time_str_Addr)
   189                        	; TXA
   190                        	; CLC
   191                        	; ADC		P_Temp+4
   192                        	; TAX
   193 00:F72E: 17 CA         	BRA		L_Dec_To_60_Prog
   194                        
   195                        R_CtwDec_Min:
   196 00:F730: 5E 05         	LDX		#(R_Stw_Min-Time_str_Addr)
   197                        	; TXA
   198                        	; CLC
   199                        	; ADC		P_Temp+4
   200                        	; TAX
   201 00:F732: 17 C6         	BRA		L_Dec_To_60_Prog
   202                        
   203                        ; F_StwHrDec:
   204                        ; 	LDX		#(R_Stw_Hr-Time_str_Addr)
   205                        ; 	TXA
   206                        ; 	CLC
   207                        ; 	ADC		P_Temp+4
   208                        ; 	TAX
   209                        ; 	LDA		#$99
   210                        ; 	BRA		L_Dec_To_0_Prog
   211                        
   212                        ;-------------------------------------------------
   213                        
   214                        ; F_KeyIncSec:
   215                        ; 	JSR		F_SecInc
   216                        ; 	JSR		L_Dis_Time ;L_Dis_TimeSec
   217                        ; 	RTS
   218                        
   219                        ; F_KeyIncMin:
   220                        ; 	JSR		F_MinInc
   221                        ; 	JMP		L_Dis_Time ;L_Dis_TimeMin
   222                        ; F_KeyIncHr:
   223                        ; 	JSR		F_HrInc
   224                        ; 	LDA		R_Time_Hr
   225                        ; 	BNE		L_Exit_KeyIncHr
   226                        ; 	LDA		Sys_Flag_B
   227                        ; 	EOR		#BIT5
   228                        ; 	STA		Sys_Flag_B	;12hr/24hr
   229                        ; L_Exit_KeyIncHr:
   230                        ; 	JMP		L_Dis_Time ;L_Dis_TimeHr
   230                        
   141                        .include    Time\Dis_time.asm
     1                        ;==========================================
     2                        L_Dis_Time_Mode:
     3                        ;T_DisTimeSetTable:
     4                        ;	.word	L_Dis_TimeOrDate-1
     5                        ;	.word	L_Dis_Time-1
     6                        ;	.word	L_Dis_Time-1
     7                        ;	.word	L_Dis_Time-1
     8                        ;	.word	L_Dis_Date-1
     9                        ;	.word	L_Dis_Date-1
    10                        ;	.word	L_Dis_Date-1
    11                        
    12                        
    13                        L_Dis_Time:
    14 00:F734: 15 80 F5      	JSR		F_DisCol
    15                        L_Dis_TimeHr:
    16 00:F737: 73 A9         	LDA		R_Time_Hr
    17 00:F739: 16 3C F7      	JMP		L_Dis_Hr_Common
    18                        
    19                        L_Dis_Hr_Common:
    20 00:F73C: 7F C6         	STA		P_Temp+4
    21 00:F73E: 73 9A         	LDA		Sys_Flag_B
    22 00:F740: 51 20         	AND		#BIT5
    23 00:F742: 13 2B         	BEQ		L_Dis_TimeHr_24
    24 00:F744: 00            	SEC
    25 00:F745: 02            	SED
    26 00:F746: 73 C6         	LDA		P_Temp+4
    27 00:F748: 55 12         	SBC		#$12
    28 00:F74A: 06            	CLD
    29 00:F74B: 10 0E         	BCC		L_Dis_Hour_12AM
    30 00:F74D: 7F C6         	STA		P_Temp+4
    31 00:F74F: 5E 1D         	LDX		#lcd_am
    32 00:F751: 15 5F F1      	JSR		F_ClrpSymbol
    33 00:F754: 5E 1E         	LDX		#lcd_pm
    34 00:F756: 15 58 F1      	JSR		F_DispSymbol
    35 00:F759: 17 0A         	BRA		L_TimeHr_0To12
    36                        L_Dis_Hour_12AM:
    37 00:F75B: 5E 1D         	LDX		#lcd_am
    38 00:F75D: 15 58 F1      	JSR		F_DispSymbol
    39 00:F760: 5E 1E         	LDX		#lcd_pm
    40 00:F762: 15 5F F1      	JSR		F_ClrpSymbol
    41                        L_TimeHr_0To12:
    42 00:F765: 73 C6         	LDA		P_Temp+4
    43 00:F767: 12 10         	BNE		L_Dis_HourDate_Prog
    44 00:F769: 53 12         	LDA		#$12
    45 00:F76B: 7F C6         	STA		P_Temp+4
    46 00:F76D: 17 0A         	BRA		L_Dis_HourDate_Prog
    47                        L_Dis_TimeHr_24:
    48 00:F76F: 5E 1D         	LDX		#lcd_am
    49 00:F771: 15 5F F1      	JSR		F_ClrpSymbol
    50 00:F774: 5E 1E         	LDX		#lcd_pm
    51 00:F776: 15 5F F1      	JSR		F_ClrpSymbol
    52                        L_Dis_HourDate_Prog:
    53 00:F779: 15 83 F7      	JSR		L_HighBitDealWith
    54 00:F77C: 5E 00         	LDX		#lcd_d1
    55 00:F77E: 73 C6         	LDA		P_Temp+4
    56 00:F780: 16 DD F5      	JMP		L_Dis_Digit12
    57                        
    58                        L_HighBitDealWith:
    59 00:F783: 73 C6         	LDA		P_Temp+4
    60 00:F785: 51 F0         	AND		#$F0
    61 00:F787: 12 06         	BNE		L_Exit_HighBitDealWith
    62                        
    63 00:F789: 73 C6         	LDA		P_Temp+4
    64 00:F78B: 50 A0         	ORA		#$A0
    65 00:F78D: 7F C6         	STA		P_Temp+4
    66                        L_Exit_HighBitDealWith:
    67 00:F78F: 09            	RTS
    68                        ; ;=====================================================
    69                        ;L_TimeHrDealwith:
    70                        ;	lda		R_Time_Hr
    71                        ;	beq		Load12
    72                        ;	cmp		#$12
    73                        ;	beq		L_End_TimeHrDealwith
    74                        ;	bcc		L_End_TimeHrDealwith
    75                        ;	sec
    76                        ;	sed
    77                        ;	sbc		#$12
    78                        ;	CLD
    79                        ;	rts
    80                        ;Load12:
    81                        ;	lda		#$12
    82                        ;L_End_TimeHrDealwith:
    83                        ;	rts
    84                        ; ;=====================================================
    85                        ; ;L_Dis_TimeOrDate:
    86                        ; ;	LDA		Sys_Flag_B
    87                        ; ;	AND		#BIT1
    88                        ; ;	BEQ		L_Dis_Time
    89                        ; ;;=====================================================
    90                        ; ;L_Dis_Date:
    91                        ; ;	LDX		#lcd_date
    92                        ; ;	JSR		F_DispSymbol
    93                        ; ;
    94                        ; ;	JSR		L_Dis_TimeDay
    95                        ; ;	JMP		L_Dis_TimeMonth
    96                        ; ;=====================================================
    97                        ; L_Dis_TimeSec:
    98                        ; 	LDA		R_Time_Sec
    99                        ; 	JMP		L_Dis_Digit_TimeSec
   100                        
   101                        ; L_Dis_TimeMin:
   102                        ; 	LDA		R_Time_Min
   103                        ; 	JMP		L_Dis_Digit_TimeMin
   104                        ;
   105                        ;L_Dis_TimeDay:
   106                        ;	LDA		R_Day
   107                        ;	PHA
   108                        ;	AND		#$F0
   109                        ;	BNE		L_Skip_Dis_TimeDay
   110                        ;;	LDA		R_Day
   111                        ;	PLA
   112                        ;	ORA		#$A0
   113                        ;	JMP		L_Dis_Digit_TimeDay
   114                        ;L_Skip_Dis_TimeDay:
   115                        ;;	LDA		R_Day
   116                        ;	PLA
   117                        ;	JMP		L_Dis_Digit_TimeDay
   118                        ;
   119                        ;L_Dis_TimeMonth:
   120                        ;	LDA		R_Month
   121                        ;	JMP		L_Dis_Digit_TimeMonth
   122                        
   123                        ;L_Dis_TimeYear:
   124                        ;	LDA		R_Year
   125                        ;	JMP		L_Dis_Digit_TimeYear
   126                        ;===============================================
   127                        ;F_JudgeDisWeek:
   128                        ;;	LDA		R_Mode
   129                        ;;	BNE		F_DisAllWeek
   130                        ;;	LDA		R_Set
   131                        ;;	BEQ		F_DisWeek
   132                        ;;	CMP		#4
   133                        ;;	BCC		F_DisAllWeek
   134                        ;F_DisWeek:
   135                        ;	LDX		R_Week
   136                        ;	LDA		TabWeek,X
   137                        ;L_DisWeek_Com:
   138                        ;	LDX		#lcd_Week
   139                        ;	JMP		F_DispPro
   140                        ;TabWeek:
   141                        ;	.BYTE	$01,$02,$04,$08,$10,$20,$40,$01
   142                        ;
   143                        ;;F_DisAllWeek:
   144                        ;;	LDA		#$7F
   145                        ;;	LDX		#lcd_Week
   146                        ;;	JMP		F_DispPro
   147                        ;
   148                        ;L_FlashWeek:
   149                        ;	LDA		#$00
   150                        ;	BRA		L_DisWeek_Com
   151                        ;===============================================
   151                        
   142                        ; .include    stw\Stw.asm
   143                        ; .include    stw\Dis_stw.asm
   144                        ; .include    Day_Ctw\Dayctw.asm
   145                        ; .include    Day_Ctw\Dis_Day.asm
   146                        ; .include    Alarm\Al.asm
   147                        ; .include    Alarm\Dis_al.asm
   148                        ; .include    Test\Test.asm
   149                        ;.include    Time\Tool.asm
   150                        
   151                        
   152                        ;--------------------------------------------------------
   153                        ; ISR
   154                        ;--------------------------------------------------------
   155                        V_IRQ:
   156 00:F790: 0A                PHA
   157 00:F791: 1C                TXA
   158 00:F792: 0A                PHA
   159 00:F793: 73 0E             LDA     P_IER
   160 00:F795: 71 0F             AND     P_IFR
   161 00:F797: 7F 98             STA     R_Int_Backup
   162                        ;   AND     #$01
   163                        ;   BNE     L_Div_IRQ_Prog
   164                        ;   LDA     R_Int_Backup
   165                        ;   AND     #$02
   166                        ;   BNE     L_Timer0_IRQ_Prog
   167                        ;   LDA     R_Int_Backup
   168 00:F799: 51 04             AND     #$04
   169 00:F79B: 12 19             BNE     L_Timer1_IRQ_Prog
   170 00:F79D: 73 98             LDA     R_Int_Backup
   171 00:F79F: 51 10             AND     #$10
   172 00:F7A1: 12 1E             BNE     L_PA_IRQ_Prog
   173 00:F7A3: 73 98             LDA     R_Int_Backup
   174 00:F7A5: 51 40             AND     #$40
   175 00:F7A7: 12 21             BNE     L_LCD_IRQ_Prog
   176 00:F7A9: 16 D2 F7          JMP     L_End_IRQ_Prog
   177                        L_Div_IRQ_Prog:
   178 00:F7AC: 20 0F             RMB0    P_IFR
   179 00:F7AE: 16 D2 F7          JMP     L_End_IRQ_Prog
   180                        
   181                        L_Timer0_IRQ_Prog:
   182 00:F7B1: 21 0F             RMB1    P_IFR
   183 00:F7B3: 16 D2 F7          JMP     L_End_IRQ_Prog
   184                        
   185                        L_Timer1_IRQ_Prog:
   186 00:F7B6: 22 0F             RMB2    P_IFR
   187                        ;   SMB0    Sys_Flag_A      ;Half Second Flag
   188                        
   189 00:F7B8: 73 99             LDA     Sys_Flag_A
   190 00:F7BA: 50 01             ORA     #BIT0               ;2hz
   191 00:F7BC: 7F 99             STA     Sys_Flag_A
   192 00:F7BE: 16 D2 F7          JMP     L_End_IRQ_Prog
   193                        
   194                        L_PA_IRQ_Prog:
   195 00:F7C1: 24 0F             RMB4    P_IFR           ;锟斤拷锟絇A锟叫断憋拷志
   196                            DIS_PA_IRQ              ;锟斤拷PA锟叫讹拷使锟斤拷
+  196 00:F7C3: 24 0E          RMB4 P_IER
   197                            EN_LCD_IRQ              ;锟斤拷32HZ锟叫讹拷使锟斤拷
+  197 00:F7C5: 2E 0E          SMB6 P_IER
   198 00:F7C7: 16 D2 F7          JMP     L_End_IRQ_Prog
   199                        
   200                        L_LCD_IRQ_Prog:
   201 00:F7CA: 26 0F             RMB6    P_IFR           ;锟斤拷锟絃CD锟叫断憋拷志
   202                        ;   SMB2    Sys_Flag_A      ;锟斤拷锟斤拷LCD init flag
   203 00:F7CC: 73 99             LDA     Sys_Flag_A
   204 00:F7CE: 50 04             ORA     #BIT2
   205 00:F7D0: 7F 99             STA     Sys_Flag_A      ;32HZ
   206                        L_End_IRQ_Prog:
   207 00:F7D2: 3A 0F E1          BBS2    P_IFR,L_Timer1_IRQ_Prog
   208 00:F7D5: 0C                PLA
   209 00:F7D6: 1B                TAX
   210 00:F7D7: 0C                PLA
   211 00:F7D8: 08                RTI
   212                        ;--------------------------------------------------------
   213                        ; Interrupt vector
   214                        ;--------------------------------------------------------
   215 00:F7D9: 1A 1A 1A 1A       .BLKB   $FFD5-$,$1A
   215 00:F7D9: 1A 1A 1A 1A   
   215 00:F7D9: 1A 1A 1A 1A   
   216                            .ORG    0FFD5H
   217 00:FFD5: 16 00 F0          JMP     V_RESET
   218 00:FFD8: FF FF FF FF       .BLKB   $FFFF-$,$FF
   218 00:FFD8: FF FF FF FF   
   218 00:FFD8: FF FF FF FF   
   219                            .ORG    0FFF8H
   220 00:FFF8: B7                DB      10110111B      ;;bit7=1 bit6=0  bit3=0
   221                            ; DB      10111111B   ;bit6=1:PB23 CMOS L;BIT0=1 Unprotected
   222                        
   223                        
   224                            .ORG    0FFFCH
   225 00:FFFC: 00 F0             DW      V_RESET
   226 00:FFFE: 90 F7             DW      V_IRQ
   227                            .ENDS
   228                             END

 --------------------
      Warnings:0
      Errors  :0
