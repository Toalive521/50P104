Wed Aug 21 18:55:51 2024
-------------------------
CAS V2.15.1-rc1 - (C) Copyright 2000-2012 CHIPMAST TECHNOLOGY CO. LTD.
Main file   : main.asm
Current file: main.asm

     1                        ;********************************************************
     2                        .CHIP           W65C02S
     3                        ;.INCLIST        ON
     4                        .MACLIST        ON
     5                        ;********************************************************
     6                        ;Project Name:
     7                        ;CPU
     8                        ;Start  Date:
     9                        ;Finish Date:
    10                        ;********************************************************
    11                        
    12                        ;********************************************************
    13                        CODE_BEG        EQU     0F000H
    14                        ;********************************************************
    15                        
    16                        ;********************************************************
    17                        PROG    SECTION OFFSET  CODE_BEG
    18                        ;********************************************************
    19                        
    20                        ;********************************************************
    21                        ; header include
    22                        ;********************************************************
    23                        ;.INCLUDE 50X105.H
    24                        .INCLUDE 50P104.H
     1                        ;***********************************************************************
     2                        	.PAGE0
     3                        	.ORG	00H
     4                        
     5                        P_PA		EQU		01H		;Default: 1111 11--B
     6                        PA			EQU		01H
     7                        P_PA_WAKE	EQU		02H		;Default: 0000 00--B
     8                        P_PAWAKE	EQU		02H
     9                        P_PA_IO		EQU		04H		;Default: 1111 11--B
    10                        PAIO		EQU		04H
    11                        P_PADIR		EQU		04H
    12                        PADIR		EQU		04H
    13                        P_PA_DIR	EQU		04H
    14                        
    15                        P_PB		EQU		05H		;Default: ----00---B
    16                        P_PB_TYPE	EQU		06H		;Default: ----11---B, CMOS output
    17                        P_PBTYPE	EQU		06H
    18                        
    19                        P_PC		EQU		07H		;Default: 1111 1111B, Pull High
    20                        PC			EQU		07H
    21                        P_PC_IO		EQU		08H		;Default: 1111 1111B, Input
    22                        P_PC_DIR	EQU		P_PC_IO
    23                        P_PCDIR		EQU		08H
    24                        PCDIR		EQU		08H
    25                        
    26                        P_PCSEG		EQU		09H		;Default: --00 ----B, PC76,PC54
    27                        
    28                        P_PD		EQU		0AH
    29                        P_PDDIR		EQU		0BH
    30                        
    31                        P_PADF0		EQU		0CH		;Default: ---- --0-B, PB3S
    32                        
    33                        P_PADF1		EQU		0DH
    34                        
    35                        P_IER		EQU		0EH		;Default: -0-0 -000B
    36                        P_IFR		EQU		0FH		;Default: -0-0 -000B
    37                        bDIVF	    EQU	   0
    38                        bTMR0F      EQU	   1
    39                        bTMR1F      EQU	   2
    40                        bTMR2F      EQU	   3
    41                        bPAF        EQU	   4
    42                        bLCDF       EQU	   6
    43                        
    44                        P_TMR0		EQU		10H		;Default: xxH
    45                        P_TMR1H		EQU		12H		;Default: xxH
    46                        P_TMR1		EQU		P_TMR1H
    47                        P_TMR2		EQU		14H
    48                        
    49                        P_TMRCTRL	EQU		16H		;Default: 0--0 --00B
    50                        bTMR0ON    	EQU	   0
    51                        bTMR1ON    	EQU	   1
    52                        bLCDON	   	EQU	   4
    53                        bAUDON	   	EQU	   7
    54                        P_TMRC		EQU		16H
    55                        
    56                        P_TMRCLK	EQU		17H		;Default: ---- xx--B
    57                        P_TMCLK		EQU		17H
    58                        
    59                        P_DIVC		EQU		18H		;Default: ---0 xx--B
    60                        
    61                        P_LCDCTRL	EQU		19H		;default: 0--- --11B
    62                        LCDCTRL		EQU		19H
    63                        
    64                        P_LCD_COM	EQU		1AH		;Default: 0--- --xxB
    65                        P_LCDCOM	EQU		1AH
    66                        
    67                        P_WDTC		EQU		1CH
    68                        
    69                        P_SYSCLK	EQU		1DH		;Default: 0--- -101B, Fcpu=Fsys,Fosc ON,Fext OFF,SubClk strong start
    70                        
    71                        P_HALT		EQU		1EH
    72                        
    73                        P_AUD		EQU		1FH		;Default: xxxx xxxxB
    74                        P_AUD0		EQU		1FH
    75                        
    76                        P_AUD_CTL	EQU		20H		;Default: ---- -x--B
    77                        P_AUDCR		EQU		P_AUD_CTL
    78                        
    79                        P_MF0		EQU		2FH
    80                        P_LVC		EQU		3DH
    81                        P_FUSE0		EQU		3EH
    82                        P_FUSE1		EQU		4EH
    83                        P_PDSEG		EQU		5CH
    84                        P_RFCC0		EQU		5DH
    85                        P_RFCC1		EQU		5EH
    86                        P_MF1		EQU		5FH
    87                        	.ENDS
    87                        
    25                        .INCLUDE RAM.inc
     1                        .Kdata
     2                        ;***************************************
     3                        ; RAM Address
     4                        ;***************************************
     5                        BIT0			.EQU	001H
     6                        BIT1			.EQU	002H
     7                        BIT2			.EQU	004H
     8                        BIT3			.EQU	008H
     9                        BIT4			.EQU	010H
    10                        BIT5			.EQU	020H
    11                        BIT6			.EQU	040H
    12                        BIT7			.EQU	080H
    13                        BIT0_			.EQU	0FEH
    14                        BIT1_			.EQU	0FDH
    15                        BIT2_			.EQU	0FBH
    16                        BIT3_			.EQU	0F7H
    17                        BIT4_			.EQU	0EFH
    18                        BIT5_			.EQU	0DFH
    19                        BIT6_			.EQU	0BFH
    20                        BIT7_			.EQU	07FH
    21                        
    22                        RamStarAddr		EQU		1800H
    23                        LCD_RamAddr		EQU		RamStarAddr
    24                        Time_Addr		EQU     RamStarAddr+Time_str_Addr-Page0RamStarAddr
    25                        
    26                        StwFlag_Addr	EQU		RamStarAddr+Stw_Flag_Addr-Page0RamStarAddr
    27                        StwSec_Addr		EQU		RamStarAddr+Stw_Sec_Addr-Page0RamStarAddr
    28                        StwMin_Addr		EQU		RamStarAddr+Stw_Min_Addr-Page0RamStarAddr
    29                        StwHr_Addr		EQU		RamStarAddr+Stw_Hr_Addr-Page0RamStarAddr
    30                        StwSecSpl_Addr	EQU		RamStarAddr+Stw_Sec_Spl_Addr-Page0RamStarAddr
    31                        StwMinSpl_Addr	EQU		RamStarAddr+Stw_Min_Spl_Addr-Page0RamStarAddr
    32                        StwHrSpl_Addr	EQU		RamStarAddr+Stw_Hr_Spl_Addr-Page0RamStarAddr
    33                        
    34                        DigitStr		EQU		1
    35                        Digit1			EQU		DigitStr+0
    36                        Digit2			EQU		DigitStr+1
    37                        Digit3			EQU		DigitStr+2
    38                        Digit4			EQU		DigitStr+3
    39                        Digit5			EQU		DigitStr+4
    40                        Digit6			EQU		DigitStr+5
    41                        
    42                        2Digit1			EQU		DigitStr+0
    43                        2Digit2			EQU		DigitStr+1
    44                        2Digit3			EQU		DigitStr+2
    45                        2Digit4			EQU		DigitStr+3
    46                        2Digit5			EQU		DigitStr+4
    47                        2Digit6			EQU		DigitStr+5
    48                        
    49                        3Digit1			EQU		DigitStr+12
    50                        3Digit2			EQU		DigitStr+13
    51                        3Digit3			EQU		DigitStr+14
    52                        3Digit4			EQU		DigitStr+15
    53                        3Digit5			EQU		DigitStr+16
    54                        3Digit6			EQU		DigitStr+17
    55                        
    56                        D_ExitSetTime	EQU		20
    57                        ;***************************************
    58                        .PAGE0
    59                        ;***************************************
    60                        	ORG	0080H
    61                        Page0RamStarAddr	EQU		$
    62 00:0080: xx xx xx xx   LCDRAM			DS		4*6
    62 00:0080: xx xx xx xx   
    62 00:0080: xx xx xx xx   
    63 00:0098: xx            R_Int_Backup	DS		1
    64 00:0099: xx            Sys_Flag_A	 DS		1
    65                        ;bit0 = 2HZ
    66                        ;bit1 =	1HZ
    67                        ;bit2 = 32HZ
    68                        ;bit3 =
    69                        ;bit4 = 标记PA2按键是否按下
    70                        ;bit5 =
    71                        ;bit6 =	标记PA5按键是否按下
    72                        ;bit7 =	标记PA7按键是否按下
    73                        
    74 00:009A: xx            Sys_Flag_B		DS	1
    75                        ;bit0 = 时间/计时  0：时间  1：计时
    76                        ;bit1 = 计时开始/暂停  0：暂停  1：开始
    77                        ;bit2 =	正计时/倒计时  0:正计时 1：倒计时
    78                        ;bit3 = 0-未结束   1-结束
    79                        ;bit4 =
    80                        ;bit5 = 12/24HR	0：24Hr  1:12hr
    81                        ;bit6 =
    82                        ;bit7 =
    83                        
    84 00:009B: xx            Sys_Flag_C		DS	1
    85                        ;bit0 = 	快加/快减标志
    86                        ;bit1 =
    87                        ;bit2 =
    88                        ;bit3 =
    89                        ;bit4 =
    90                        ;bit5 =
    91                        ;bit6 =
    92                        ;bit7 =
    93                        
    94 00:009C: xx            Sys_Flag_D		DS	1
    95                        ;bit0 =
    96                        ;bit1 =
    97                        ;bit2 =
    98                        ;bit3 =
    99                        ;bit4 =
   100                        ;bit5 =
   101                        ;bit6 =
   102                        ;bit7 =
   103                        
   104 00:009D: xx            R_Key_Flag		DS	1
   105                        ;bit0=	SATART_KEY HOLD
   106                        ;bit1=	UP_KEY HOLD
   107                        ;bit2=	DOWN_KEY HOLD
   108                        ;bit3=	判断是否有任意键按下过
   109                        ;bit4=
   110                        ;bit5=
   111                        ;bit6=
   112                        ;bit7=
   113                        
   114                        
   115                        Stw_Flag_Addr 	.EQU  $
   116 00:009E: xx xx         R_Stw_Flag		DS	2
   117                        ;bit0=
   118                        ;bit1=
   119                        ;bit2=
   120                        ;bit3=
   121                        ;bit4=
   122                        ;bit5=
   123                        ;bit6=
   124                        ;bit7=
   125                        
   126 00:00A0: xx            R_Day_Flag		DS	1	;
   127                        ;bit0=
   128                        ;bit1=
   129                        ;bit2=
   130                        ;bit3=
   131                        ;bit4=
   132                        ;bit5=
   133                        ;bit6=
   134                        ;bit7=
   135                        
   136 00:00A1: xx            R_Set_Flag		DS	1	;
   137                        ;bit0=
   138                        ;bit1=
   139                        ;bit2=
   140                        ;bit3=
   141                        ;bit4=
   142                        ;bit5=
   143                        ;bit6=
   144                        ;bit7=
   145 00:00A2: xx            R_No_Key		DS	1	;
   146                        ;bit0=
   147                        ;bit1=
   148                        ;bit2=
   149                        ;bit3=
   150                        ;bit4=
   151                        ;bit5=
   152                        ;bit6=
   153                        ;bit7=
   154 00:00A3: xx            R_STW_Key		DS	1
   155 00:00A4: xx            R_Mode_Flag		DS	1
   156                        ;bit0= 0：正计时/1：倒计时
   157                        ;bit1=
   158                        ;bit2=
   159                        ;bit3=
   160                        ;bit4=
   161                        ;bit5=
   162                        ;bit6=
   163                        ;bit7=
   164                        
   165                        ;;计时
   166 00:00A5: xx            R_CtwTime_Min	DS	1
   167 00:00A6: xx            R_CtwTime_Sec	DS	1
   168                        
   169                        
   170                        Time_str_Addr		.EQU  $
   171 00:00A7: xx            R_Time_Min			DS	1
   172 00:00A8: xx            R_Time_Sec			DS	1
   173 00:00A9: xx            R_Time_Hr			DS	1
   174                        
   175 00:00AA: xx            R_Stw_Mode		DS  1
   176                        D_Stw			.EQU  0
   177                        D_Stw2		    .EQU  1
   178                        
   179                        Stw_Sec_Addr	.equ	$
   180 00:00AB: xx            R_Stw_Sec		DS	1
   181                        Stw_Min_Addr	.equ	$
   182 00:00AC: xx            R_Stw_Min	   	DS	1
   183                        Stw_Hr_Addr		.equ	$
   184 00:00AD: xx            R_Stw_Hr		DS	1
   185                        
   186 00:00AE: xx            R_Mode			DS	1
   187 00:00AF: xx            R_Set			DS	1
   188                        D_Time_Mode		.equ	0
   189                        D_Stw_Mode		.equ	1
   190                        D_Al_Mode		.equ	2
   191                        ;D_Al2_Mode		.equ	3
   192                        ;D_StwDay_Mode	.equ	4
   193                        D_Max_Mode		.equ	2+1
   194                        
   195                        Stw_Sec_Spl_Addr		.equ	$
   196 00:00B0: xx xx         R_Stw_Sec_Spl   DS	2
   197                        Stw_Min_Spl_Addr		.equ	$
   198 00:00B2: xx xx         R_Stw_Min_Spl   DS	2
   199                        Stw_Hr_Spl_Addr		.equ	$
   200 00:00B4: xx xx         R_Stw_Hr_Spl    DS	2
   201                        
   202 00:00B6: xx            R_Al_Sec_Spl   	DS	1
   203 00:00B7: xx            R_Al_Min_Spl   	DS	1
   204                        
   205 00:00B8: xx            R_Al_Sec		DS	1
   206 00:00B9: xx            R_Al_Min		DS	1
   207 00:00BA: xx            R_Al_Hr			DS	1
   208                        
   209 00:00BB: xx            R_Alarm_Mode	DS	1
   210 00:00BC: xx            R_Beep_Time		DS	1
   211 00:00BD: xx            R_Voice_Unit	DS	1
   212 00:00BE: xx            R_KeyHold_Time	DS	1
   213 00:00BF: xx            R_Fast_Time		DS	1
   214                        C_Fast_Time		.EQU  32/8
   215                        
   216 00:00C0: xx            R_Key	DS	1
   217                        
   218 00:00C1: xx            R_Num			DS	1
   219                        ;---------------------------------------
   220                        ;---------------------------------------
   221 00:00C2: xx xx xx xx   P_Temp			DS	8
   221 00:00C2: xx xx xx xx   
   222                        R_Temp				.equ	P_Temp
   223 00:00CA: xx            P_Num			DS	1
   224                        
   225 00:00CB: xx            PADIR_TEMP		DS	1
   226 00:00CC: xx            PA_TEMP			DS	1
   227 00:00CD: xx            PCDIR_TEMP		DS	1
   228 00:00CE: xx            PC_TEMP			DS	1
   229                        
   230 00:00CF: xx            R_KeyValue		DS	1
   231                        ;***************************************
   232                        .ENDS
   233                        ;***************************************
   234                        ;.Udata
   235                        ;;---------------------------------------
   236                        ;	ORG    1800H
   237                        ;
   238                        ;;---------------------------------------
   239                        ;	ORG    1847H
   240                        ;;---------------------------------------
   241                        ;.ENDS
   241                        
    26                        .INCLUDE MACRO.MAC
     1                        ;***********************************************************************
     2                        JMP_IDX MACRO	MEM
     3                        	if	MEM<$100
     4                        	JMP	($80+MEM)
     5                        	else
     6                        	JMP	(MEM)
     7                        	endif
     8                        	ENDM
     9                        ;*************************************
    10                        LDLN	MACRO	mem
    11                        	if	mem<$100
    12                        	LDA	mem-$40
    13                        	else
    14                        	LDA	mem-$60
    15                        	endif
    16                        	ENDM
    17                        
    18                        LDHN	MACRO	mem
    19                        	if	mem<$100
    20                        	LDA	mem-$20
    21                        	else
    22                        	LDA	men-$40
    23                        	endif
    24                        	ENDM
    25                        
    26                        STLN	MACRO	mem
    27                        	if	mem<$100
    28                        	STA	mem-$40
    29                        	else
    30                        	STA	mem-$60
    31                        	endif
    32                        	ENDM
    33                        
    34                        STHN	MACRO	mem
    35                        	if	mem<$100
    36                        	STA	mem-$20
    37                        	else
    38                        	STA	men-$40
    39                        	endif
    40                        	ENDM
    41                        ;************************************
    42                        
    43                        LXLN	MACRO	mem
    44                        	if	mem<$100
    45                        	LDX	$780+mem
    46                        	else
    47                        	LDX	$700+mem
    48                        	endif
    49                        	ENDM
    50                        
    51                        LXHN	MACRO	mem
    52                        	if	mem<$100
    53                        	LDX	$F80+mem
    54                        	else
    55                        	LDX	$F00+mem
    56                        	endif
    57                        	ENDM
    58                        
    59                        SXLN	MACRO	mem
    60                        	if	mem<$100
    61                        	STX	$780+mem
    62                        	else
    63                        	STX	$700+mem
    64                        	endif
    65                        	ENDM
    66                        
    67                        SXHN	MACRO	mem
    68                        	if	mem<$100
    69                        	STX	$F80+mem
    70                        	else
    71                        	STX	$F00+mem
    72                        	endif
    73                        	ENDM
    74                        
    75                        LDLN_X	MACRO	mem
    76                        	if	mem<$100
    77                        	LDA	$780+mem,X
    78                        	else
    79                        	LDA	$700+mem,X
    80                        	endif
    81                        	ENDM
    82                        
    83                        STLN_X	MACRO	mem
    84                        	if	mem<$100
    85                        	STA	$780+mem,X
    86                        	else
    87                        	STA	$700+mem,X
    88                        	endif
    89                        	ENDM
    90                        
    91                        LDHN_X	MACRO	mem
    92                        	if	mem<$100
    93                        	LDA	$F80+mem,X
    94                        	else
    95                        	LDA	$F00+mem,X
    96                        	endif
    97                        	ENDM
    98                        
    99                        STHN_X	MACRO	mem
   100                        	if	mem<$100
   101                        	STA	$F80+mem,X
   102                        	else
   103                        	STA	$F00+mem,X
   104                        	endif
   105                        	ENDM
   106                        
   107                        INCHN_X	MACRO	mem
   108                        	if	mem<$100
   109                        	INC	$F80+mem,X
   110                        	else
   111                        	INC	$F00+mem,X
   112                        	endif
   113                        	ENDM
   114                        
   115                        DECHN_X	MACRO	mem
   116                        	if	mem<$100
   117                        	DEC	$F80+mem,X
   118                        	else
   119                        	DEC	$F00+mem,X
   120                        	endif
   121                        	ENDM
   122                        
   123                        ADCLN	MACRO	mem
   124                        	if	mem<$100
   125                        	ADC	$780+mem
   126                        	else
   127                        	ADC	$700+mem
   128                        	endif
   129                        	ENDM
   130                        
   131                        ADCHN	MACRO	mem
   132                        	if	mem<$100
   133                        	ADC	$F80+mem
   134                        	else
   135                        	ADC	$F00+mem
   136                        	endif
   137                        	ENDM
   138                        
   139                        CMPLN	MACRO	mem
   140                        	if	mem<$100
   141                        	CMP	$780+mem
   142                        	else
   143                        	CMP	$700+mem
   144                        	endif
   145                        	ENDM
   146                        
   147                        CMPHN	MACRO	mem
   148                        	if	mem<$100
   149                        	CMP	$F80+mem
   150                        	else
   151                        	CMP	$F00+mem
   152                        	endif
   153                        	ENDM
   154                        
   155                        
   156                        ;*************************
   157                        ;*************************
   158                        INCLN	MACRO	mem
   159                        	if	mem<$100
   160                        	INC	mem-$40
   161                        	else
   162                        	INC	mem-$60
   163                        	endif
   164                        	ENDM
   165                        
   166                        INCHN	MACRO	mem
   167                        	if	mem<$100
   168                        	INC	mem-$20
   169                        	else
   170                        	INC	mem-$40
   171                        	endif
   172                        	ENDM
   173                        
   174                        DECLN	MACRO	mem
   175                        	if	mem<$100
   176                        	DEC mem-$40
   177                        	else
   178                        	DEC mem-$60
   179                        	endif
   180                        	ENDM
   181                        
   182                        DECHN	MACRO	mem
   183                        	if	mem<$100
   184                        	DEC	mem-$20
   185                        	else
   186                        	DEC	mem-$40
   187                        	endif
   188                        	ENDM
   189                        ;*************************
   190                        ;*************************
   191                        
   192                        
   193                        
   194                        LDA_X	MACRO	mem
   195                        	if	mem<$100
   196                        	LDA	$80+mem,X
   197                        	else
   198                        	LDA	mem,X
   199                        	endif
   200                        	ENDM
   201                        
   202                        STA_X	MACRO	mem
   203                        	if	mem<$100
   204                        	STA	$80+mem,X
   205                        	else
   206                        	STA	mem,X
   207                        	endif
   208                        	ENDM
   209                        
   210                        STZ_X	MACRO	mem
   211                        	if	mem<$100
   212                        	STZ	$80+mem,X
   213                        	else
   214                        	STZ	mem,X
   215                        	endif
   216                        	ENDM
   217                        
   218                        INC_X	MACRO	mem
   219                        	if	mem<$100
   220                        	INC	$80+mem,X
   221                        	else
   222                        	INC	mem,X
   223                        	endif
   224                        	ENDM
   225                        
   226                        ADC_X	MACRO	mem
   227                        	if	mem<$100
   228                        	ADC	$80+mem,X
   229                        	else
   230                        	ADC	mem,X
   231                        	endif
   232                        	ENDM
   233                        
   234                        SBC_X	MACRO	mem
   235                        	if	mem<$100
   236                        	SBC	$80+mem,X
   237                        	else
   238                        	SBC	mem,X
   239                        	endif
   240                        	ENDM
   241                        
   242                        CMP_X	MACRO	mem
   243                        	if	mem<$100
   244                        	CMP	$80+mem,X
   245                        	else
   246                        	CMP	mem,X
   247                        	endif
   248                        	ENDM
   249                        
   250                        ASLLN	MACRO	mem
   251                        	if	mem<$100
   252                        	ASL	$780+mem
   253                        	else
   254                        	ASL	$700+mem
   255                        	endif
   256                        	ENDM
   257                        
   258                        LSRLN	MACRO	mem
   259                        	if	mem<$100
   260                        	LSR	$780+mem
   261                        	else
   262                        	LSR	$700+mem
   263                        	endif
   264                        	ENDM
   265                        
   266                        ROLLN	MACRO	mem
   267                        	if	mem<$100
   268                        	ROL	$780+mem
   269                        	else
   270                        	ROL	$700+mem
   271                        	endif
   272                        	ENDM
   273                        
   274                        RORLN	MACRO	mem
   275                        	if	mem<$100
   276                        	ROR	$780+mem
   277                        	else
   278                        	ROR	$700+mem
   279                        	endif
   280                        	ENDM
   281                        
   282                        ASLHN	MACRO	mem
   283                        	if	mem<$100
   284                        	ASL	$F80+mem
   285                        	else
   286                        	ASL	$F00+mem
   287                        	endif
   288                        	ENDM
   289                        
   290                        LSRHN	MACRO	mem
   291                        	if	mem<$100
   292                        	LSR	$F80+mem
   293                        	else
   294                        	LSR	$F00+mem
   295                        	endif
   296                        	ENDM
   297                        
   298                        ROLHN	MACRO	mem
   299                        	if	mem<$100
   300                        	ROL	$F80+mem
   301                        	else
   302                        	ROL	$F00+mem
   303                        	endif
   304                        	ENDM
   305                        
   306                        RORHN	MACRO	mem
   307                        	if	mem<$100
   308                        	ROR	$F80+mem
   309                        	else
   310                        	ROR	$F00+mem
   311                        	endif
   312                        	ENDM
   313                        
   314                        BR0	MACRO	PARA,VAR,LABLE
   315                        	BBR@<VAR.mod.8> PARA,LABLE
   316                        	ENDM
   317                        
   318                        BR1	MACRO	PARA,VAR,LABLE
   319                        	BBS@<VAR.mod.8>	PARA,LABLE
   320                        	ENDM
   321                        
   322                        xSETB	MACRO	flag,bit
   323                        	SMB@<bit>  flag
   324                        	ENDM
   325                        
   326                        xCLRB	MACRO	flag,bit
   327                        	RMB@<bit>  flag
   328                        	ENDM
   328                        
    27                        ;.INCLUDE 50X105.MAC
    28                        .INCLUDE 50P104.MAC
     1                        ;------------------------------------
     2                        PB2_PB2_CMOS MACRO
     3                                RMB0    P_PADF0
     4                                SMB2    P_PBTYPE ;COMS
     5                                ENDM
     6                        PB2_PB2_NMOS MACRO
     7                                RMB0    P_PADF0
     8                                RMB2    P_PBTYPE ;NOMS
     9                                ENDM
    10                        PB2_PWM MACRO
    11                                SMB0    P_PADF0
    12                                SMB2    P_PBTYPE ;COMS
    13                                ENDM
    14                        
    15                        PB3_PB3_CMOS MACRO
    16                                RMB1    P_PADF0
    17                                SMB3    P_PBTYPE ;CMOS
    18                                ENDM
    19                        PB3_PB3_NMOS MACRO
    20                                RMB1    P_PADF0
    21                                RMB3    P_PBTYPE ;CMOS
    22                                ENDM
    23                        PB3_PWM MACRO
    24                                SMB1    P_PADF0
    25                                SMB3    P_PBTYPE ;CMOS
    26                                ENDM
    27                        
    28                        PC67_PC67       MACRO
    29                                RMB5    P_PCSEG
    30                                RMB4    P_DIVC
    31                                ENDM
    32                        PC67_EL01       MACRO
    33                                RMB5    P_PCSEG
    34                                SMB4    P_DIVC
    35                                ENDM
    36                        PC67_SEG	MACRO
    37                                SMB5    P_PCSEG
    38                                ENDM
    39                        
    40                        PC45_PC45       MACRO
    41                                RMB4    P_PCSEG
    42                                ENDM
    43                        PC45_SEG       MACRO
    44                                SMB4    P_PCSEG
    45                                ENDM
    46                        
    47                        PC0_PC0       MACRO
    48                                RMB0    P_PCSEG
    49                                ENDM
    50                        PC03_PC03       MACRO
    51                                RMB0    P_PCSEG
    52                                RMB1    P_PCSEG
    53                                RMB2    P_PCSEG
    54                                RMB3    P_PCSEG
    55                                ENDM
    56                        PC0_SEG       MACRO
    57                                SMB0    P_PCSEG
    58                                ENDM
    59                        PC13_SEG       MACRO
    60                                SMB1    P_PCSEG
    61                                SMB2    P_PCSEG
    62                                SMB3    P_PCSEG
    63                        		RMB3	P_LCDCTRL
    64                                ENDM
    65                        
    66                        PD03_SEG	MACRO
    67                        		SMB6	P_PCSEG
    68                                ENDM
    69                        PD03_RFC	MACRO
    70                        		RMB6	P_PCSEG
    71                        		RMB0	P_PDSEG
    72                        		RMB1	P_PDSEG
    73                        		RMB2	P_PDSEG
    74                        		RMB3	P_PDSEG
    75                        		SMB0	P_RFCC0
    76                        		SMB1	P_RFCC0
    77                        		SMB2	P_RFCC0
    78                        		SMB3	P_RFCC0
    79                                ENDM
    80                        PD03_PD03	MACRO
    81                        		RMB6	P_PCSEG
    82                        		RMB0	P_PDSEG
    83                        		RMB1	P_PDSEG
    84                        		RMB2	P_PDSEG
    85                        		RMB3	P_PDSEG
    86                        		RMB0	P_RFCC0
    87                        		RMB1	P_RFCC0
    88                        		RMB2	P_RFCC0
    89                        		RMB3	P_RFCC0
    90                                ENDM
    91                        PD0_SEG	MACRO
    92                        		SMB0	P_PDSEG
    93                                ENDM
    94                        PD1_SEG	MACRO
    95                        		SMB1	P_PDSEG
    96                                ENDM
    97                        PD2_SEG	MACRO
    98                        		SMB2	P_PDSEG
    99                                ENDM
   100                        PD3_SEG	MACRO
   101                        		SMB3	P_PDSEG
   102                                ENDM
   103                        
   104                        PD47_SEG	MACRO
   105                        		SMB7	P_PCSEG
   106                                ENDM
   107                        PD4_RFC	MACRO
   108                        		RMB7	P_PCSEG
   109                        		RMB4	P_PDSEG
   110                        		SMB4	P_RFCC0
   111                                ENDM
   112                        PD4_PD4	MACRO
   113                        		RMB7	P_PCSEG
   114                        		RMB4	P_PDSEG
   115                        		RMB4	P_RFCC0
   116                                ENDM
   117                        PD47_PD47	MACRO
   118                        		RMB7	P_PCSEG
   119                        		RMB4	P_PDSEG
   120                        		RMB5	P_PDSEG
   121                        		RMB6	P_PDSEG
   122                        		RMB7	P_PDSEG
   123                        		RMB4	P_RFCC0
   124                                ENDM
   125                        PD57_PD57	MACRO
   126                        		RMB7	P_PCSEG
   127                        		RMB5	P_PDSEG
   128                        		RMB6	P_PDSEG
   129                        		RMB7	P_PDSEG
   130                                ENDM
   131                        PD4_SEG	MACRO
   132                        		SMB4	P_PDSEG
   133                                ENDM
   134                        PD5_SEG	MACRO
   135                        		SMB5	P_PDSEG
   136                                ENDM
   137                        PD5_PD5	MACRO
   138                        		RMB7	P_PCSEG
   139                        		RMB5	P_PDSEG
   140                                ENDM
   141                        PD6_SEG	MACRO
   142                        		SMB6	P_PDSEG
   143                                ENDM
   144                        PD6_PD6	MACRO
   145                        		RMB7	P_PCSEG
   146                        		RMB6	P_PDSEG
   147                                ENDM
   148                        PD7_SEG	MACRO
   149                        		SMB7	P_PDSEG
   150                                ENDM
   151                        PD7_PD7	MACRO
   152                        		RMB7	P_PCSEG
   153                        		RMB7	P_PDSEG
   154                                ENDM
   155                        
   156                        PC_PD_SEG	MACRO
   157                        		LDA		#$FF
   158                        		STA		P_PCSEG	;S1~S7,S8~S15
   159                                ENDM
   160                        
   161                        LCD_3COM	MACRO
   162                        		RMB0	P_LCDCOM
   163                        		RMB1	P_LCDCOM
   164                                ENDM
   165                        LCD_4COM	MACRO
   166                        		SMB0	P_LCDCOM
   167                        		RMB1	P_LCDCOM
   168                                ENDM
   169                        LCD_5COM	MACRO
   170                        		RMB0	P_LCDCOM
   171                        		SMB1	P_LCDCOM
   172                                ENDM
   173                        LCD_6COM	MACRO
   174                        		SMB0	P_LCDCOM
   175                        		SMB1	P_LCDCOM
   176                                ENDM
   177                        
   178                        LCD_ENCH_EN		MACRO
   179                        		SMB6	P_LCDCOM
   180                                ENDM
   181                        LCD_ENCH_DIS	MACRO
   182                        		RMB6	P_LCDCOM
   183                                ENDM
   184                        
   185                        LCD_DRIVE_2	MACRO
   186                        		SMB0	P_LCDCTRL
   187                        		RMB1	P_LCDCTRL
   188                                ENDM
   189                        LCD_DRIVE_4	MACRO
   190                        		RMB0	P_LCDCTRL
   191                        		SMB1	P_LCDCTRL
   192                                ENDM
   193                        LCD_DRIVE_8	MACRO
   194                        		SMB0	P_LCDCTRL
   195                        		SMB1	P_LCDCTRL
   196                                ENDM
   197                        LCD_DRIVE_FULL	MACRO
   198                        		RMB0	P_LCDCTRL
   199                        		RMB1	P_LCDCTRL
   200                                ENDM
   201                        
   202                        LCD_1_2_BAIS_3V	MACRO
   203                        		RMB2	P_LCDCTRL
   204                        		RMB3	P_LCDCTRL
   205                                ENDM
   206                        LCD_1_3_BAIS_4V	MACRO
   207                        		SMB2	P_LCDCTRL
   208                        		RMB3	P_LCDCTRL
   209                                ENDM
   210                        LCD_1_3_BAIS_3V	MACRO
   211                        		SMB3	P_LCDCTRL
   212                                ENDM
   213                        LCDS_2	MACRO
   214                        		RMB5	P_LCDCOM
   215                                ENDM
   216                        LCDS_1	MACRO
   217                        		SMB5	P_LCDCOM
   218                                ENDM
   219                        ;------------------------------------
   220                        Fext_WEAK       MACRO
   221                                RMB0    P_SYSCLK
   222                                ENDM
   223                        Fext_STRONG     MACRO
   224                                SMB0    P_SYSCLK
   225                                ENDM
   226                        
   227                        Fext_OFF        MACRO
   228                                RMB1    P_SYSCLK
   229                                ENDM
   230                        Fext_ON         MACRO
   231                                SMB1    P_SYSCLK
   232                                ENDM
   233                        
   234                        Fosc_OFF        MACRO
   235                                RMB2    P_SYSCLK
   236                                ENDM
   237                        Fosc_ON         MACRO
   238                                SMB2    P_SYSCLK
   239                                ENDM
   240                        
   241                        Fext_Xtal       MACRO
   242                                RMB3    P_SYSCLK
   243                                ENDM
   244                        Fext_RC         MACRO
   245                                SMB3    P_SYSCLK
   246                                ENDM
   247                        
   248                        Fsys_Fosc_1 MACRO
   249                                RMB4    P_SYSCLK
   250                                ENDM
   251                        Fsys_Fosc_2 MACRO
   252                                SMB4    P_SYSCLK
   253                                ENDM
   254                        
   255                        Fcpu_Fext  MACRO
   256                                SMB7    P_SYSCLK
   257                                ENDM
   258                        Fcpu_Fsys  MACRO
   259                                RMB7    P_SYSCLK
   260                                ENDM
   261                        ;------------------------------------
   262                        DIV_8KHZ  MACRO
   263                                RMB0    P_DIVC
   264                                RMB1    P_DIVC
   265                        		RMB5	P_DIVC
   266                                ENDM
   267                        DIV_16KHZ  MACRO
   268                                SMB0    P_DIVC
   269                                RMB1    P_DIVC
   270                        		RMB5	P_DIVC
   271                                ENDM
   272                        DIV_512HZ  MACRO
   273                                RMB0    P_DIVC
   274                                SMB1    P_DIVC
   275                        		RMB5	P_DIVC
   276                                ENDM
   277                        DIV_1KHZ  MACRO
   278                                SMB0    P_DIVC
   279                                SMB1    P_DIVC
   280                        		RMB5	P_DIVC
   281                                ENDM
   282                        DIV_256HZ  MACRO
   283                        		SMB5	P_DIVC
   284                                ENDM
   285                        ;------------------------------------
   286                        WDTC_CLK_256HZ   MACRO
   287                                RMB0    P_WDTC
   288                                RMB1    P_WDTC
   289                                ENDM
   290                        WDTC_CLK_DIV     MACRO
   291                                SMB0    P_WDTC
   292                                RMB1    P_WDTC
   293                                ENDM
   294                        WDTC_CLK_TMR1   MACRO
   295                                RMB0    P_WDTC
   296                                SMB1    P_WDTC
   297                                ENDM
   298                        WDTC_CLK_LCDS    MACRO
   299                                SMB0    P_WDTC
   300                                SMB1    P_WDTC
   301                                ENDM
   302                        
   303                        WDTC_CLR MACRO
   304                                RMB2    P_WDTC
   305                                ENDM
   306                        
   307                        WDTC_ON  MACRO
   308                                SMB3    P_WDTC
   309                                ENDM
   310                        WDTC_OFF MACRO
   311                                RMB3    P_WDTC
   312                                ENDM
   313                        
   314                        IF_WDTC MACRO   LAB
   315                                BBS4    P_WDTC,LAB
   316                                ENDM
   317                        
   318                        ;------------------------------------
   319                        TMR0_ON MACRO
   320                                SMB0    P_TMRC
   321                                ENDM
   322                        TMR0_OFF MACRO
   323                                RMB0    P_TMRC
   324                                ENDM
   325                        TMR0_CLK_FOSC   MACRO
   326                                SMB0    P_TMCLK
   327                                RMB1    P_TMCLK
   328                                ENDM
   329                        TMR0_CLK_FSUB    MACRO
   330                                RMB0    P_TMCLK
   331                                RMB1    P_TMCLK
   332                                RMB0	P_PADF1
   333                                ENDM
   334                        TMR0_CLK_128K	macro
   335                        		RMB0    P_TMCLK
   336                                SMB1    P_TMCLK
   337                                ENDM
   338                        TMR0_CLK_32K	macro
   339                        		RMB0    P_TMCLK
   340                                RMB1    P_TMCLK
   341                                SMB0	P_PADF1
   342                                ENDM
   343                        TMR0_CLK_FOSC_4   MACRO
   344                                SMB0    P_TMCLK
   345                                SMB1    P_TMCLK
   346                                RMB6	P_TMRC
   347                                ENDM
   348                        
   349                        TMR1_ON MACRO
   350                                SMB1    P_TMRC
   351                                ENDM
   352                        TMR1_OFF MACRO
   353                                RMB1    P_TMRC
   354                                ENDM
   355                        TMR1_CLK_TMR0   MACRO
   356                                RMB2    P_TMCLK
   357                                RMB3    P_TMCLK
   358                                ENDM
   359                        TMR1_CLK_512Hz    MACRO
   360                                SMB2    P_TMCLK
   361                                RMB3    P_TMCLK
   362                                ENDM
   363                        TMR1_CLK_128K	macro
   364                        		RMB2    P_TMCLK
   365                                SMB3    P_TMCLK
   366                                ENDM
   367                        TMR1_CLK_FOSC_4		macro
   368                        		SMB2    P_TMCLK
   369                                SMB3    P_TMCLK
   370                                ENDM
   371                        
   372                        TMR2_ON MACRO
   373                                SMB2    P_TMRC
   374                                ENDM
   375                        TMR2_OFF MACRO
   376                                RMB2    P_TMRC
   377                                ENDM
   378                        TMR2_CLK_512Hz MACRO
   379                                RMB2    P_TMRC
   380                                ENDM
   381                        
   382                        
   383                        TONE_2KHZ_1_2_Duty     MACRO
   384                                RMB2    P_DIVC
   385                                RMB3    P_DIVC
   386                                RMB7    P_DIVC
   387                                ENDM
   388                        TONE_TMR0_2_1_2_Duty      MACRO
   389                                SMB2    P_DIVC
   390                                RMB3    P_DIVC
   391                                RMB7    P_DIVC
   392                                ENDM
   393                        TONE_L       MACRO
   394                                RMB2    P_DIVC
   395                                SMB3    P_DIVC
   396                                ENDM
   397                        TONE_H       MACRO
   398                                SMB2    P_DIVC
   399                                SMB3    P_DIVC
   400                                ENDM
   401                        TONE_2KHZ_3_4_Duty     MACRO
   402                                RMB2    P_DIVC
   403                                RMB3    P_DIVC
   404                                SMB7    P_DIVC
   405                                ENDM
   406                        TONE_4KHZ_3_4_Duty      MACRO
   407                                SMB2    P_DIVC
   408                                RMB3    P_DIVC
   409                                SMB7    P_DIVC
   410                                ENDM
   411                        ;------------------------------------
   412                        EN_DIV_IRQ     MACRO
   413                                SMB0    P_IER
   414                                ENDM
   415                        EN_TMR0_IRQ     MACRO
   416                                SMB1    P_IER
   417                                ENDM
   418                        EN_TMR1_IRQ     MACRO
   419                                SMB2    P_IER
   420                                ENDM
   421                        EN_TMR2_IRQ     MACRO
   422                                SMB3    P_IER
   423                                ENDM
   424                        EN_KEY_IRQ      MACRO
   425                                SMB4    P_IER
   426                                ENDM
   427                        EN_PA_IRQ      MACRO
   428                                SMB4    P_IER
   429                                ENDM
   430                        EN_LCD_IRQ      MACRO
   431                                SMB6    P_IER
   432                                ENDM
   433                        
   434                        DIS_DIV_IRQ     MACRO
   435                                RMB0    P_IER
   436                                ENDM
   437                        DIS_TMR0_IRQ     MACRO
   438                                RMB1    P_IER
   439                                ENDM
   440                        DIS_TMR1_IRQ     MACRO
   441                                RMB2    P_IER
   442                                ENDM
   443                        DIS_TMR2_IRQ     MACRO
   444                                RMB3    P_IER
   445                                ENDM
   446                        DIS_KEY_IRQ      MACRO
   447                                RMB4    P_IER
   448                                ENDM
   449                        DIS_PA_IRQ		 MACRO
   450                                RMB4    P_IER
   451                                ENDM
   452                        DIS_LCD_IRQ      MACRO
   453                                RMB6    P_IER
   454                                ENDM
   455                        
   456                        CLR_DIV_IRQ_FLAG MACRO
   457                                RMB0    P_IFR
   458                                ENDM
   459                        CLR_TMR0_IRQ_FLAG      MACRO
   460                                RMB1    P_IFR
   461                                ENDM
   462                        CLR_TMR1_IRQ_FLAG      MACRO
   463                                RMB2    P_IFR
   464                                ENDM
   465                        CLR_TMR2_IRQ_FLAG      MACRO
   466                                RMB3    P_IFR
   467                                ENDM
   468                        CLR_KEY_IRQ_FLAG      MACRO
   469                                RMB4    P_IFR
   470                                ENDM
   471                        CLR_PA_IRQ_FLAG      MACRO
   472                                RMB4    P_IFR
   473                                ENDM
   474                        CLR_LCD_IRQ_FLAG       MACRO
   475                                RMB6    P_IFR
   476                                ENDM
   477                        
   478                        IF_DIV_IRQ_FLAG MACRO   LAB1
   479                                BBS0    P_IFR,LAB1
   480                                ENDM
   481                        IF_TMR0_IRQ_FLAG MACRO   LAB1
   482                                BBS1    P_IFR,LAB1
   483                                ENDM
   484                        IF_TMR1_IRQ_FLAG MACRO   LAB1
   485                                BBS2    P_IFR,LAB1
   486                                ENDM
   487                        IF_TMR2_IRQ_FLAG MACRO   LAB1
   488                                BBS3    P_IFR,LAB1
   489                                ENDM
   490                        IF_KEY_IRQ_FLAG MACRO   LAB1
   491                                BBS4    P_IFR,LAB1
   492                                ENDM
   493                        IF_LCD_IRQ_FLAG MACRO   LAB1
   494                                BBS6    P_IFR,LAB1
   495                                ENDM
   496                        ;------------------------------------
   497                        LCD_ON           MACRO
   498                                SMB4    P_TMRC
   499                                ENDM
   500                        LCD_OFF          MACRO
   501                                RMB4    P_TMRC
   502                                ENDM
   503                        
   504                        PWM_ON  MACRO
   505                        		SMB0	P_SYSCLK	;Strong Mode
   506                                SMB7    P_TMRC
   507                                ENDM
   508                        PWM_OFF MACRO
   509                                RMB7    P_TMRC
   510                        ;		LDA		R_Strong_2S
   511                        ;		BNE		?Skip
   512                        		RMB0	P_SYSCLK	;WeakMode
   513                        ?Skip:
   514                                ENDM
   515                        
   516                        IF_PWM_ON       MACRO   LAB
   517                                BBS7    P_TMRC,LAB
   518                                ENDM
   519                        IF_PWM_OFF      MACRO   LAB
   520                                BBR7    P_TMRC,LAB
   521                                ENDM
   522                        
   523                        SEL_PWM MACRO
   524                                SMB1    P_AUDCR
   525                                ENDM
   526                        SEL_TONE MACRO
   527                                RMB1    P_AUDCR
   528                                ENDM
   529                        ;------------------------------------
   530                        ClrAllRam MACRO
   531                            LDA		#$00
   532                        	LDX		#$FF
   533                        	STA		$1800
   534                        ?ClrAllRamLoop:
   535                        	STA		$1800,X
   536                        	DEX
   537                        	BNE		?ClrAllRamLoop
   538                            ENDM
   539                        ;------------------------------------
   539                        
    29                        ;********************************************************
    30                        STACK_BOT       EQU     FFH
    31                        ;********************************************************
    32                        .PROG
    33                        V_RESET:
    34 00:F000: 1A                NOP
    35 00:F001: 1A                NOP
    36 00:F002: 1A                NOP
    37 00:F003: 01                SEI
    38 00:F004: 5E FF             LDX     #STACK_BOT
    39 00:F006: 1E                TXS
    40 00:F007: 53 07             LDA     #$07
    41 00:F009: 7F 1D             STA     P_SYSCLK    ;Fcpu=560K, Fext=32768,Strong ,Fosc/1
    42                            ClrAllRam
+   42 00:F00B: 53 00          LDA #$0000
+   42 00:F00D: 5E FF          LDX #$00FF
+   42 00:F00F: 4F 00 18       STA $1800
+   42                        ?ClrAllRamLoop:
+   42 00:F012: 6F 00 18       STA $1800,X
+   42 00:F015: 0F             DEX
+   42 00:F016: 12 FA          BNE ?ClrAllRamLoop
    43 00:F018: 15 93 F0          JSR     L_InitSPR_Prog
    44 00:F01B: 15 00 F1          JSR     F_FillScreen
    45                            LCD_ON
+   45 00:F01E: 2C 16          SMB4 P_TMRC
    46                            TMR1_ON
+   46 00:F020: 29 16          SMB1 P_TMRC
    47                            EN_TMR1_IRQ
+   47 00:F022: 2A 0E          SMB2 P_IER
    48 00:F024: 73 3E             LDA     P_FUSE0
    49 00:F026: 7F 2F             STA     P_MF0
    50 00:F028: 7F 1E             STA     P_HALT
    51 00:F02A: 1A                NOP
    52 00:F02B: 1A                NOP
    53 00:F02C: 1A                NOP
    54 00:F02D: 22 0F             RMB2    P_IFR
    55 00:F02F: 7F 1E             STA     P_HALT
    56 00:F031: 1A                NOP
    57 00:F032: 1A                NOP
    58 00:F033: 1A                NOP
    59 00:F034: 22 0F             RMB2    P_IFR
    60 00:F036: 7F 1E             STA     P_HALT
    61 00:F038: 1A                NOP
    62 00:F039: 1A                NOP
    63 00:F03A: 1A                NOP
    64 00:F03B: 22 0F             RMB2    P_IFR
    65                            WDTC_CLR
+   65 00:F03D: 22 1C          RMB2 P_WDTC
    66                            Fsys_Fosc_1
+   66 00:F03F: 24 1D          RMB4 P_SYSCLK
    67                            EN_LCD_IRQ
+   67 00:F041: 2E 0E          SMB6 P_IER
    68                             ; JSR     Change_Key_BIT3
    69                        
    70 00:F043: 53 FF             LDA	    #$FF
    71 00:F045: 7F 05         	STA	    P_PB
    72                            ; JSR     F_KeyBeep
    73                            ; JSR     F_KeyLight
    74                            ; JSR     L_Beep_Control_Prog
    75                        
    76 00:F047: 53 A4             LDA     #10100100B
    77 00:F049: 7F 02             STA     P_PA_WAKE
    78                        
    79 00:F04B: 53 00             LDA     #0
    80 00:F04D: 7F A4             STA     R_Mode_Flag
    81                        
    82 00:F04F: 53 00             LDA     #0
    83 00:F051: 7F A1             STA     R_Set_Flag
    84                        
    85 00:F053: 53 05             LDA     #$5
    86 00:F055: 7F AC             STA     R_Stw_Min
    87                            ; LDA     #$00
    88                            ; STA     R_Stw_Sec
    89 00:F057: 22 9A             RMB2	Sys_Flag_B
    90                        
    91 00:F059: 53 00             LDA     #0
    92 00:F05B: 7F C8             STA     P_Temp+6
    93 00:F05D: 7F C9             STA     P_Temp+7
    94 00:F05F: 7F C7             STA     P_Temp+5
    95 00:F061: 15 04 F1          JSR     F_ClearScreen
    96                        ;    JSR     F_KeyUpdateDis
    97                        
    98 00:F064: 05                CLI
    99                        
   100                        ;--------------------------------------------------------
   101                        Mainloop:
   102                        
   103 00:F065: 15 39 F5          JSR     L_2Hz_Prog
   104 00:F068: 15 DA F1          JSR     L_32Hz_Prog
   105                        
   106                        
   107                        ;     RMB2    P_WDTC          ;CLR_WDTC
   108                        ; ;    JSR     L_Mode_Prog
   109                        ;     ; JSR     L_32Hz_Prog
   110                        
   111 00:F06B: 3F 16 F7          BBS7    P_TMRC,Mainloop
   112                            ; LDA     R_Light_Unit
   113                            ; BNE     Mainloop
   114                            Fsys_Fosc_2
+  114 00:F06E: 2C 1D          SMB4 P_SYSCLK
   115 00:F070: 7F 1E             STA     P_HALT
   116 00:F072: 15 7D F0          JSR     L_Judge_32hz
   117 00:F075: 1A                NOP
   118 00:F076: 1A                NOP
   119 00:F077: 1A                NOP
   120                            Fsys_Fosc_1
+  120 00:F078: 24 1D          RMB4 P_SYSCLK
   121 00:F07A: 16 65 F0          JMP     Mainloop
   122                        
   123                        L_Judge_32hz:
   124 00:F07D: 73 01             LDA     PA
   125 00:F07F: 52 A4             EOR     #10100100B
   126 00:F081: 51 A4             AND     #10100100B
   127 00:F083: 13 02             BEQ     ?OFF
   128                            EN_LCD_IRQ
+  128 00:F085: 2E 0E          SMB6 P_IER
   129                        
   130                        ?OFF:
   131 00:F087: 09                RTS
   132                        ;--------------------------------------------------------
   133                        .INCLUDE    Init.asm
     1                        
     2                        ;------------------------------------------------------
     3                        ;L_Init_SystemRam_Prog:
     4                        ;	LDA		#3
     5                        ;	STA		R_Reset_1S
     6                        ;	STA		R_Strong_2S
     7                        
     8                        ;	LDA		#$06
     9                        ;	STA		R_Alarm1_Hr
    10                        ;	LDA		#$12
    11                        ;	STA		R_Alarm2_Hr
    12                        ;	RTS
    13                        ;------------------------------------------------------
    14                        ;------------------------------------------------------
    15                        ;-----------------------------------------------------
    16                        ;-----------------------------------------------------
    17                        F_Delay30Ms_32KHz:
    18 00:F088: 53 8C         	LDA		#140		;2
    19 00:F08A: 7F C7         	STA		R_Temp+5
    20                        ?OOP_DELAY:
    21 00:F08C: 79 C7         	DEC		R_Temp+5	;2*256
    22 00:F08E: 73 C7         	LDA		R_Temp+5	;
    23 00:F090: 12 FA         	BNE		?OOP_DELAY	;3*256
    24 00:F092: 09            	RTS
    25                        ;------------------------------------------------------
    26                        L_InitSPR_Prog:
    27 00:F093: 53 0C         	LDA		#00001100B
    28 00:F095: 7F 02         	STA		P_PAWAKE
    29                        
    30 00:F097: 53 04         	LDA		#00000100B
    31 00:F099: 7F 04         	STA		P_PADIR
    32                        
    33 00:F09B: 53 00         	LDA		#0
    34 00:F09D: 7F 01         	STA		P_PA	;PA56���0,������������
    35                        
    36                        	PB2_PB2_CMOS
+   36 00:F09F: 20 0C          RMB0 P_PADF0
+   36 00:F0A1: 2A 06          SMB2 P_PBTYPE
    37                        	PB3_PB3_CMOS
+   37 00:F0A3: 21 0C          RMB1 P_PADF0
+   37 00:F0A5: 2B 06          SMB3 P_PBTYPE
    38                        	WDTC_CLR
+   38 00:F0A7: 22 1C          RMB2 P_WDTC
    39                        	PC03_PC03
+   39 00:F0A9: 20 09          RMB0 P_PCSEG
+   39 00:F0AB: 21 09          RMB1 P_PCSEG
+   39 00:F0AD: 22 09          RMB2 P_PCSEG
+   39 00:F0AF: 23 09          RMB3 P_PCSEG
    40                        	PC45_PC45
+   40 00:F0B1: 24 09          RMB4 P_PCSEG
    41                        	PC67_SEG
+   41 00:F0B3: 2D 09          SMB5 P_PCSEG
    42                        	PD03_SEG
+   42 00:F0B5: 2E 09          SMB6 P_PCSEG
    43                        	PD47_SEG
+   43 00:F0B7: 2F 09          SMB7 P_PCSEG
    44                        ;	LDA		#$FF
    45                        ;	STA		P_PB
    46 00:F0B9: 53 00         	LDA		#0
    47 00:F0BB: 7F 05         	STA		P_PB
    48 00:F0BD: 7F 08         	STA		P_PC_IO
    49 00:F0BF: 7F 07         	STA		P_PC
    50 00:F0C1: 7F 0B         	STA		P_PDDIR
    51 00:F0C3: 7F 0A         	STA		P_PD
    52                        	LCD_4COM
+   52 00:F0C5: 28 1A          SMB0 P_LCDCOM
+   52 00:F0C7: 21 1A          RMB1 P_LCDCOM
    53                        	LCD_DRIVE_4
+   53 00:F0C9: 20 19          RMB0 P_LCDCTRL
+   53 00:F0CB: 29 19          SMB1 P_LCDCTRL
    54                        	LCD_ENCH_EN
+   54 00:F0CD: 2E 1A          SMB6 P_LCDCOM
    55                        	LCD_1_2_BAIS_3V
+   55 00:F0CF: 22 19          RMB2 P_LCDCTRL
+   55 00:F0D1: 23 19          RMB3 P_LCDCTRL
    56                        	LCDS_2
+   56 00:F0D3: 25 1A          RMB5 P_LCDCOM
    57 00:F0D5: 53 00         	LDA		#0
    58 00:F0D7: 7F 0D         	STA		P_PADF1
    59 00:F0D9: 7F 10         	STA		P_TMR0
    60 00:F0DB: 7F 12         	STA		P_TMR1
    61 00:F0DD: 7F 14         	STA		P_TMR2
    62 00:F0DF: 7F 18         	STA		P_DIVC
    63 00:F0E1: 7F 0E         	STA		P_IER
    64 00:F0E3: 7F 0F         	STA		P_IFR
    65 00:F0E5: 7F 1F         	STA		P_AUD0
    66 00:F0E7: 7F 20         	STA		P_AUDCR
    67                        ;	LDA		#01111100B
    68                        ;	STA		P_PA_WAKE
    69                        	DIV_512HZ
+   69 00:F0E9: 20 18          RMB0 P_DIVC
+   69 00:F0EB: 29 18          SMB1 P_DIVC
+   69 00:F0ED: 25 18          RMB5 P_DIVC
    70                        	TMR0_CLK_128K
+   70 00:F0EF: 20 17          RMB0 P_TMCLK
+   70 00:F0F1: 29 17          SMB1 P_TMCLK
    71                        	TMR1_CLK_512Hz
+   71 00:F0F3: 2A 17          SMB2 P_TMCLK
+   71 00:F0F5: 23 17          RMB3 P_TMCLK
    72                        	TMR2_CLK_512Hz
+   72 00:F0F7: 22 16          RMB2 P_TMRC
    73                        	WDTC_CLK_TMR1
+   73 00:F0F9: 20 1C          RMB0 P_WDTC
+   73 00:F0FB: 29 1C          SMB1 P_WDTC
    74                        	WDTC_OFF
+   74 00:F0FD: 23 1C          RMB3 P_WDTC
    75 00:F0FF: 09            	RTS
    76                        ;------------------------------------------------------
    77                        
    77                        
   134                        .INCLUDE    Disp.asm
     1                        
     2                        
     3                        ;===========================================================
     4                        ;LCD_RamAddr		equ		RamStarAddr
     5                        ;===========================================================
     6                        F_FillScreen:
     7 00:F100: 53 FF         	LDA		#0FFH
     8 00:F102: 12 02         	BNE		L_FillLcd
     9                        F_ClearScreen:
    10 00:F104: 53 00         	LDA		#0
    11                        L_FillLcd:
    12 00:F106: 5E 00         	LDX		#0
    13                        L_FillLcd_1:
    14 00:F108: 6F 00 18         STA		LCD_RamAddr+0*6,X       ;;COM0
    15 00:F10B: 6F 06 18         STA		LCD_RamAddr+1*6,X       ;;COM1
    16 00:F10E: 6F 0C 18         STA		LCD_RamAddr+2*6,X       ;;COM2
    17 00:F111: 6F 12 18         STA		LCD_RamAddr+3*6,X       ;;COM3
    18                        ;   STA		Lcd_RamAddr+4*6,x       ;;COM4
    19                        ;   STA		Lcd_RamAddr+5*6,x       ;;COM5
    20 00:F114: 0B               INX
    21 00:F115: 57 06            CPX    	#6
    22 00:F117: 10 EF            BCC    	L_FillLcd_1
    23                        	; STA		0200H
    24                        	; STA		0201H
    25                        	; STA		0208H
    26                        	; STA		0209H
    27                        	; STA		0210H
    28                        	; STA		0211H
    29                        	; STA		0218H
    30                        	; STA		0219H
    31 00:F119: 09            	RTS
    32                        
    33                        
    34                        ;===========================================================
    35                        ;程序功能：	显示8BIT字段
    36                        ;程序入口：	A =  显示内容
    37                        ;			X =  ofc
    38                        ;影响资源：P_Temp，P_Temp+1，P_Temp+2，P_Temp+3,X，A
    39                        ;===========================================================
    40                        L_Dis_8Bit_DigitDot_Prog:
    41                        ;	STA		P_Temp
    42                        ;	LDA		Table_Digit_Add   r_Offset,X
    43 00:F11A: 7C C3         	STX		P_Temp+1
    44 00:F11C: 1B            	TAX
    45 00:F11D: 63 84 F1      	LDA		Table_Digit_DataDot,X
    46 00:F120: 7E C3         	LDX		P_Temp+1
    47                        F_DispPro:
    48 00:F122: 7F C2         	STA		P_Temp
    49 00:F124: 7C C3         	STX		P_Temp+1	;
    50 00:F126: 53 07         	LDA		#7
    51 00:F128: 7F C5         	STA		P_Temp+3	;显示段数
    52                        L_Judge_Dis_8Bit_DigitDot:
    53 00:F12A: 7E C3         	LDX		P_Temp+1
    54 00:F12C: 63 BA F1      	LDA		lcd_bit,X
    55 00:F12F: 7F C4         	STA		P_Temp+2
    56 00:F131: 63 9A F1      	LDA		lcd_byte,X
    57 00:F134: 1B            	TAX
    58 00:F135: 7B C2         	ROR		P_Temp
    59 00:F137: 10 0A         	BCC		L_CLR
    60 00:F139: 63 00 18      	LDA		LCD_RamAddr,X
    61 00:F13C: 70 C4         	ORA		P_Temp+2
    62 00:F13E: 6F 00 18      	STA		LCD_RamAddr,X
    63 00:F141: 17 0A         	BRA		L_Inc_Dis_Index_Prog
    64                        L_CLR:
    65 00:F143: 63 00 18      	LDA		LCD_RamAddr,X
    66 00:F146: 70 C4         	ORA		P_Temp+2
    67 00:F148: 72 C4         	EOR		P_Temp+2
    68 00:F14A: 6F 00 18      	STA		LCD_RamAddr,X
    69                        L_Inc_Dis_Index_Prog:
    70 00:F14D: 78 C3         	INC		P_Temp+1
    71 00:F14F: 79 C5         	DEC		P_Temp+3
    72 00:F151: 12 D7         	BNE		L_Judge_Dis_8Bit_DigitDot
    73 00:F153: 09            	RTS
    74                        
    75                        F_DispPro_8bit:
    76 00:F154: 7F C2         	STA		P_Temp
    77 00:F156: 7C C3         	STX		P_Temp+1
    78 00:F158: 53 08         	LDA		#8
    79 00:F15A: 7F C5         	STA		P_Temp+3	;显示段数
    80 00:F15C: 17 CC         	BRA		L_Judge_Dis_8Bit_DigitDot
    81                        ;-----------------------------------------
    82                        F_DispSymbol:		;input Xcc -> ofs
    83                        ;	LDA		Lcd_bit,X
    84                        ;	STA		P_Temp+2
    85                        ;	LDA		Lcd_byte,X
    86                        ;	TAX
    87                        ;	LDA		LCD_RamAddr,X
    88                        ;	ORA		P_Temp+2
    89 00:F15E: 15 6E F1      	JSR		F_DispSymbol_Com
    90 00:F161: 6F 00 18      	STA		LCD_RamAddr,X
    91 00:F164: 09            	RTS
    92                        ;-----------------------------------------
    93                        F_ClrpSymbol:		;input Xcc -> ofs
    94                        ;	LDA		Lcd_bit,X
    95                        ;	STA		P_Temp+2
    96                        ;	LDA		Lcd_byte,X
    97                        ;	TAX
    98                        ;	LDA		LCD_RamAddr,X
    99                        ;	ORA		P_Temp+2
   100 00:F165: 15 6E F1      	JSR		F_DispSymbol_Com
   101 00:F168: 72 C4         	EOR		P_Temp+2
   102 00:F16A: 6F 00 18      	STA		LCD_RamAddr,X
   103 00:F16D: 09            	RTS
   104                        
   105                        F_DispSymbol_Com:
   106 00:F16E: 63 BA F1      	LDA		lcd_bit,X
   107 00:F171: 7F C4         	STA		P_Temp+2
   108 00:F173: 63 9A F1      	LDA		lcd_byte,X
   109 00:F176: 1B            	TAX
   110 00:F177: 63 00 18      	LDA		LCD_RamAddr,X
   111 00:F17A: 70 C4         	ORA		P_Temp+2
   112 00:F17C: 09            	RTS
   113                        ;============================================================
   114                        ;==================================== ===========
   115                        L_ROR_4Bit_Prog:
   116                        L_ROR4Bit_Prog:
   117                        L_LSR4Bit_Prog:
   118                        F_MSBToLSB:
   119 00:F17D: 19            	ROR
   120 00:F17E: 19            	ROR
   121 00:F17F: 19            	ROR
   122 00:F180: 19            	ROR
   123 00:F181: 51 0F         	AND		#$0F
   124 00:F183: 09            	RTS
   125                        ;================================================
   126                        ;********************************************
   127                        Table_Digit_DataDot:	;显示内容对应显示的段码
   128 00:F184: 3F            	.BYTE 	3fh	;0
   129 00:F185: 06            	.BYTE	06h	;1
   130 00:F186: 5B            	.BYTE	5bh	;2
   131 00:F187: 4F            	.BYTE	4fh	;3
   132 00:F188: 66            	.BYTE	66h	;4
   133                        Tab_S:
   134                        Char_S  .EQU	Tab_S-Table_Digit_DataDot
   135 00:F189: 6D            	.BYTE	6dh	;5
   136 00:F18A: 7D            	.BYTE	7dh	;6
   137 00:F18B: 07            	.BYTE	07h	;7			;带钩	27h	;7
   138 00:F18C: 7F            	.BYTE	7fh	;8
   139 00:F18D: 6F            	.BYTE	6fh	;9
   140 00:F18E: 00            	.BYTE	00h	; 		;A
   141 00:F18F: 40            	.BYTE	40h	;负号	;B
   142 00:F190: 77            	.BYTE	77h	;A		;C
   143 00:F191: 38            	.BYTE	38h	;L		;D
   144 00:F192: 76            	.BYTE	76h	;H		;E
   145 00:F193: 50            	.BYTE	50H	;r		;F
   146                        	;.BYTE	01H	;test
   147                        Tab_C:
   148                        Char_C  .EQU	Tab_C-Table_Digit_DataDot
   149 00:F194: 39            	.BYTE	39h	;C		;10
   150 00:F195: 71            	.BYTE	71h	;F		;11
   151                        Tab_A:
   152                        Char_A	.EQU	Tab_A-Table_Digit_DataDot
   153 00:F196: 77            	.BYTE	77h	;A		;12
   154                        Tab_P:
   155                        Char_P  .EQU	Tab_P-Table_Digit_DataDot
   156 00:F197: 73            	.BYTE	73h	;P		;13
   157                        Tab_o:
   158                        Char_o  .EQU	Tab_o-Table_Digit_DataDot
   159 00:F198: 5C            	.BYTE	5Ch	;o		;14
   160                        Tab_n:
   161                        Char_n  .EQU	Tab_n-Table_Digit_DataDot
   162 00:F199: 54            	.BYTE	54h	;n		;15
   163                        ;-----------------------------------------------------------
   163                        
   135                        .INCLUDE    Lcdtab.asm
     1                        ;4 COM*8 SEG
     2                        
     3                        ;--------COM------------
     4                        C1  .equ    0
     5                        C2  .equ    1
     6                        C3  .equ    2
     7                        C4  .equ    3
     8                        ;;--------SEG------------
     9                        S3      .EQU    43
    10                        S4      .EQU    42
    11                        S5      .EQU    41
    12                        S6      .EQU    40
    13                        S7      .EQU    15
    14                        S8      .EQU    14
    15                        S9      .EQU    13
    16                        S10     .EQU    12
    17                        
    18                        db_c_s:      .macro  com,seg
    19                                    db com*6+seg/8
    20                                      .endm
    21                        
    22                        db_c_y:       .macro  com,seg
    23                                    db 1.shl.(seg-seg/8*8)
    24                                    .endm
    25                        
    26                        lcd_byte:
    27                        lcd_table1:
    28                        lcd_d1 .equ $-lcd_table1
    29                            db_c_s  C1,S3   ;;1A
+   29 00:F19A: 05             .DB C1*$0006+S3/$0008
    30                            db_c_s  C1,S4   ;;1B
+   30 00:F19B: 05             .DB C1*$0006+S4/$0008
    31                            db_c_s  C3,S4   ;;1C
+   31 00:F19C: 11             .DB C3*$0006+S4/$0008
    32                            db_c_s  C4,S4   ;;1D
+   32 00:F19D: 17             .DB C4*$0006+S4/$0008
    33                            db_c_s  C3,S3   ;;1E
+   33 00:F19E: 11             .DB C3*$0006+S3/$0008
    34                            db_c_s  C2,S3   ;;1F
+   34 00:F19F: 0B             .DB C2*$0006+S3/$0008
    35                            db_c_s  C2,S4   ;;1G
+   35 00:F1A0: 0B             .DB C2*$0006+S4/$0008
    36                        
    37                        lcd_d2 .equ $-lcd_table1
    38                            db_c_s  C1,S5   ;;2A
+   38 00:F1A1: 05             .DB C1*$0006+S5/$0008
    39                            db_c_s  C1,S6   ;;2B
+   39 00:F1A2: 05             .DB C1*$0006+S6/$0008
    40                            db_c_s  C3,S6   ;;2C
+   40 00:F1A3: 11             .DB C3*$0006+S6/$0008
    41                            db_c_s  C4,S6   ;;2D
+   41 00:F1A4: 17             .DB C4*$0006+S6/$0008
    42                            db_c_s  C3,S5   ;;2E
+   42 00:F1A5: 11             .DB C3*$0006+S5/$0008
    43                            db_c_s  C2,S5   ;;2F
+   43 00:F1A6: 0B             .DB C2*$0006+S5/$0008
    44                            db_c_s  C2,S6   ;;2G
+   44 00:F1A7: 0B             .DB C2*$0006+S6/$0008
    45                        
    46                        lcd_d3 equ $-lcd_table1
    47                            db_c_s  C1,S7   ;;3A
+   47 00:F1A8: 01             .DB C1*$0006+S7/$0008
    48                            db_c_s  C1,S8   ;;3B
+   48 00:F1A9: 01             .DB C1*$0006+S8/$0008
    49                            db_c_s  C3,S8   ;;3C
+   49 00:F1AA: 0D             .DB C3*$0006+S8/$0008
    50                            db_c_s  C4,S8   ;;3D
+   50 00:F1AB: 13             .DB C4*$0006+S8/$0008
    51                            db_c_s  C3,S7   ;;3E
+   51 00:F1AC: 0D             .DB C3*$0006+S7/$0008
    52                            db_c_s  C2,S7   ;;3F
+   52 00:F1AD: 07             .DB C2*$0006+S7/$0008
    53                            db_c_s  C2,S8   ;;3G
+   53 00:F1AE: 07             .DB C2*$0006+S8/$0008
    54                        
    55                        lcd_d4 equ $-lcd_table1
    56                            db_c_s  C1,S9   ;;4A
+   56 00:F1AF: 01             .DB C1*$0006+S9/$0008
    57                            db_c_s  C1,S10  ;;4B
+   57 00:F1B0: 01             .DB C1*$0006+S10/$0008
    58                            db_c_s  C3,S10  ;;4C
+   58 00:F1B1: 0D             .DB C3*$0006+S10/$0008
    59                            db_c_s  C4,S10  ;;4D
+   59 00:F1B2: 13             .DB C4*$0006+S10/$0008
    60                            db_c_s  C3,S9   ;;4E
+   60 00:F1B3: 0D             .DB C3*$0006+S9/$0008
    61                            db_c_s  C2,S9   ;;4F
+   61 00:F1B4: 07             .DB C2*$0006+S9/$0008
    62                            db_c_s  C2,S10  ;;4G
+   62 00:F1B5: 07             .DB C2*$0006+S10/$0008
    63                        
    64                        lcd_dot:
    65                        lcd_col equ $-lcd_table1
    66                            db_c_s  C4,S7  ;;COL
+   66 00:F1B6: 13             .DB C4*$0006+S7/$0008
    67                        lcd_am equ $-lcd_table1
    68                            db_c_s  C4,S3  ;;AM
+   68 00:F1B7: 17             .DB C4*$0006+S3/$0008
    69                        lcd_pm equ $-lcd_table1
    70                            db_c_s  C4,S5  ;;PM
+   70 00:F1B8: 17             .DB C4*$0006+S5/$0008
    71                        lcd_ms equ $-lcd_table1
    72                            db_c_s  C4,S9  ;;M,S
+   72 00:F1B9: 13             .DB C4*$0006+S9/$0008
    73                        
    74                        ;=========================================
    75                        lcd_bit:
    76                            db_c_y  C1,S3   ;;1A
+   76 00:F1BA: 08             .DB $0001<<(S3-S3/$0008*$0008)
    77                            db_c_y  C1,S4   ;;1B
+   77 00:F1BB: 04             .DB $0001<<(S4-S4/$0008*$0008)
    78                            db_c_y  C3,S4   ;;1C
+   78 00:F1BC: 04             .DB $0001<<(S4-S4/$0008*$0008)
    79                            db_c_y  C4,S4   ;;1D
+   79 00:F1BD: 04             .DB $0001<<(S4-S4/$0008*$0008)
    80                            db_c_y  C3,S3   ;;1E
+   80 00:F1BE: 08             .DB $0001<<(S3-S3/$0008*$0008)
    81                            db_c_y  C2,S3   ;;1F
+   81 00:F1BF: 08             .DB $0001<<(S3-S3/$0008*$0008)
    82                            db_c_y  C2,S4   ;;1G
+   82 00:F1C0: 04             .DB $0001<<(S4-S4/$0008*$0008)
    83                        
    84                            db_c_y  C1,S5   ;;2A
+   84 00:F1C1: 02             .DB $0001<<(S5-S5/$0008*$0008)
    85                            db_c_y  C1,S6   ;;2B
+   85 00:F1C2: 01             .DB $0001<<(S6-S6/$0008*$0008)
    86                            db_c_y  C3,S6   ;;2C
+   86 00:F1C3: 01             .DB $0001<<(S6-S6/$0008*$0008)
    87                            db_c_y  C4,S6   ;;2D
+   87 00:F1C4: 01             .DB $0001<<(S6-S6/$0008*$0008)
    88                            db_c_y  C3,S5   ;;2E
+   88 00:F1C5: 02             .DB $0001<<(S5-S5/$0008*$0008)
    89                            db_c_y  C2,S5   ;;2F
+   89 00:F1C6: 02             .DB $0001<<(S5-S5/$0008*$0008)
    90                            db_c_y  C2,S6   ;;2G
+   90 00:F1C7: 01             .DB $0001<<(S6-S6/$0008*$0008)
    91                        
    92                            db_c_y  C1,S7   ;;3A
+   92 00:F1C8: 80             .DB $0001<<(S7-S7/$0008*$0008)
    93                            db_c_y  C1,S8   ;;3B
+   93 00:F1C9: 40             .DB $0001<<(S8-S8/$0008*$0008)
    94                            db_c_y  C3,S8   ;;3C
+   94 00:F1CA: 40             .DB $0001<<(S8-S8/$0008*$0008)
    95                            db_c_y  C4,S8   ;;3D
+   95 00:F1CB: 40             .DB $0001<<(S8-S8/$0008*$0008)
    96                            db_c_y  C3,S7   ;;3E
+   96 00:F1CC: 80             .DB $0001<<(S7-S7/$0008*$0008)
    97                            db_c_y  C2,S7   ;;3F
+   97 00:F1CD: 80             .DB $0001<<(S7-S7/$0008*$0008)
    98                            db_c_y  C2,S8   ;;3G
+   98 00:F1CE: 40             .DB $0001<<(S8-S8/$0008*$0008)
    99                        
   100                            db_c_y  C1,S9   ;;4A
+  100 00:F1CF: 20             .DB $0001<<(S9-S9/$0008*$0008)
   101                            db_c_y  C1,S10  ;;4B
+  101 00:F1D0: 10             .DB $0001<<(S10-S10/$0008*$0008)
   102                            db_c_y  C3,S10  ;;4C
+  102 00:F1D1: 10             .DB $0001<<(S10-S10/$0008*$0008)
   103                            db_c_y  C4,S10  ;;4D
+  103 00:F1D2: 10             .DB $0001<<(S10-S10/$0008*$0008)
   104                            db_c_y  C3,S9   ;;4E
+  104 00:F1D3: 20             .DB $0001<<(S9-S9/$0008*$0008)
   105                            db_c_y  C2,S9   ;;4F
+  105 00:F1D4: 20             .DB $0001<<(S9-S9/$0008*$0008)
   106                            db_c_y  C2,S10  ;;4G
+  106 00:F1D5: 10             .DB $0001<<(S10-S10/$0008*$0008)
   107                        
   108                            db_c_y  C4,S7  ;;COL
+  108 00:F1D6: 80             .DB $0001<<(S7-S7/$0008*$0008)
   109                            db_c_y  C4,S3  ;;AM
+  109 00:F1D7: 08             .DB $0001<<(S3-S3/$0008*$0008)
   110                            db_c_y  C4,S5  ;;PM
+  110 00:F1D8: 02             .DB $0001<<(S5-S5/$0008*$0008)
   111                            db_c_y  C4,S9  ;;M,S
+  111 00:F1D9: 20             .DB $0001<<(S9-S9/$0008*$0008)
   112                        ;=========================================
   112                        
   136                        ; .include    Key\KeyBeep.asm
   137                        .include    Key\KeyScan.asm
     1                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
     2                        D_Key1S		.EQU  32*1
     3                        D_Key2S		.EQU  25*2
     4                        D_Key3S		.EQU  30*3
     5                        
     6                        D_Key2		.EQU  %00000100
     7                        D_Key5		.EQU  %00100000
     8                        D_Key7		.EQU  %10000000
     9                        D_Key57		.EQU  %10100000
    10                        
    11                        ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    12                        L_32Hz_Prog:
    13 00:F1DA: 73 99         	LDA		Sys_Flag_A
    14 00:F1DC: 51 04         	AND		#BIT2
    15 00:F1DE: 13 0B         	BEQ		L_End_32Hz_Prog
    16                        
    17 00:F1E0: 01            	SEI
    18 00:F1E1: 73 99         	LDA		Sys_Flag_A
    19 00:F1E3: 51 FB         	AND		#BIT2_
    20 00:F1E5: 7F 99         	STA		Sys_Flag_A
    21 00:F1E7: 05            	CLI
    22                        	; JSR		L_Beep_Control_Prog
    23 00:F1E8: 15 EC F1      	JSR		L_Scankey_Prog
    24                        L_End_32Hz_Prog:
    25 00:F1EB: 09            	RTS
    26                        ;---------------------------------------------------------
    27                        L_Scankey_Prog:
    28 00:F1EC: 15 1F F5      	JSR		F_KeyIoPAInputHigh
    29                        
    30 00:F1EF: 15 30 F5      	JSR		L_ScanKey_Delay_Prog		;	等待功能，跑循环
    31 00:F1F2: 73 01         	LDA     P_PA
    32 00:F1F4: 52 A4             EOR     #10100100B			;;取反，区分按下和未按下的键
    33 00:F1F6: 51 A4             AND     #10100100B			;;去除其余干扰位，确定按键
    34 00:F1F8: 7F C3             STA     P_Temp+1
    35 00:F1FA: 12 03         	BNE		L_Havekey
    36 00:F1FC: 16 CB F2      	JMP		L_Null_Key_Prog
    37                        L_Havekey:
    38 00:F1FF: 73 C3         	LDA		P_Temp+1
    39 00:F201: 76 CF         	CMP		R_KeyValue
    40 00:F203: 13 03         	BEQ		L_KeyLine1
    41 00:F205: 7F CF         	STA		R_KeyValue
    42 00:F207: 09            	RTS
    43                        
    44                        L_KeyLine1:
    45 00:F208: 73 9D         	LDA		R_Key_Flag
    46 00:F20A: 51 80         	AND		#BIT7
    47 00:F20C: 13 01         	BEQ		L_KeyLine1_
    48 00:F20E: 09            	RTS
    49                        
    50                        L_KeyLine1_:
    51                        ;	JSR		Stop_Alarm_Beep		;有键按下即关闭闹钟
    52                        
    53 00:F20F: 73 C3         	LDA		P_Temp+1
    54 00:F211: 56 04         	CMP		#D_Key2
    55 00:F213: 13 25         	BEQ		L_Key2_Enter
    56                        
    57 00:F215: 56 20         	CMP		#D_Key5
    58 00:F217: 13 4B         	BEQ		L_Key5_Enter
    59                        
    60 00:F219: 56 80         	CMP		#D_Key7
    61 00:F21B: 13 73         	BEQ		L_Key7_Enter
    62                        
    63 00:F21D: 56 A0         	CMP		#D_Key57
    64 00:F21F: 13 03         	BEQ		L_Key57_Enter
    65                        
    66 00:F221: 16 C4 F2      	JMP		L_ManyKey
    67                        ;============================================================
    68                        L_Key57_Enter:
    69 00:F224: 30 9A 12      	BBR0	Sys_Flag_B,L_Key57_Enter_RTS	;;判断是否在计时模式下
    70 00:F227: 3C 99 0F      	BBS4	Sys_Flag_A,L_Key57_Enter_RTS	;;标记57键是否为按下状态
    71 00:F22A: 2C 99         	SMB4	Sys_Flag_A
    72                        
    73 00:F22C: 53 00         	LDA		#0
    74 00:F22E: 7F AB         	STA		R_Stw_Sec		;;同时按下则清零
    75 00:F230: 7F AC         	STA		R_Stw_Min
    76 00:F232: 22 9A         	RMB2	Sys_Flag_B			;;清零后，标记为正计时
    77 00:F234: 21 9A         	RMB1	Sys_Flag_B			;;计时暂停状态
    78 00:F236: 16 AE F3      	JMP		L_Display_Mode0Prog
    79                        L_Key57_Enter_RTS:
    80 00:F239: 09            	RTS
    81                        ;============================================================
    82                        L_Key2_Enter:
    83 00:F23A: 3C 99 04      	BBS4	Sys_Flag_A,?RTS		;;判断Sys_Flag_A的bit4=1？ 不为1，则往下执行；为1 说明按键已经按下，直接跳转
    84 00:F23D: 2C 99         	SMB4	Sys_Flag_A		;;标记Sys_Flag_A的bit4=1
    85 00:F23F: 28 9D         	SMB0	R_Key_Flag		;;R_Key_Flag的bit0=1
    86                        
    87                        ?RTS:
    88 00:F241: 73 BE         	LDA		R_KeyHold_Time
    89 00:F243: 56 5A         	CMP		#D_Key3S
    90 00:F245: 13 06         	BEQ		L_Key2_Enter_End		;;判断是否按下满足3S
    91 00:F247: 73 BE         	LDA		R_KeyHold_Time
    92 00:F249: 03            	INC
    93 00:F24A: 7F BE         	STA		R_KeyHold_Time
    94 00:F24C: 09            	RTS
    95                        
    96                        L_Key2_Enter_End:			;;满足3S
    97 00:F24D: 30 9D 13      	BBR0	R_Key_Flag, ?RTS  ;;判断bit0=0?  =0：不是2key，跳转
    98 00:F250: 20 9D         	RMB0	R_Key_Flag			;;bit0=1时，清除-->bit0=0
    99 00:F252: 53 00         	LDA		#0
   100 00:F254: 7F A2         	STA		R_No_Key			;;若10S内有按键按下，重置R_No_Key
   101 00:F256: 53 00         	LDA		#0
   102 00:F258: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   103 00:F25A: 73 A1         	LDA		R_Set_Flag
   104 00:F25C: 12 05         	BNE		?RTS				;;判断R_Set_Flag不为0 ？ 不为0：跳转	为0 ：R_Set_Flag加1,R_Set_Flag=1
   105 00:F25E: 78 A1         	INC		R_Set_Flag
   106 00:F260: 15 AE F3      	JSR		L_Display_Mode0Prog	;;R_Set_Flag=1
   107                        ?RTS:
   108 00:F263: 09            	RTS
   109                        ;=================================================
   110                        L_Key5_Enter:
   111 00:F264: 3E 99 04      	BBS6	Sys_Flag_A,?RTS
   112 00:F267: 2E 99         	SMB6	Sys_Flag_A
   113 00:F269: 29 9D         	SMB1	R_Key_Flag		;;bit1=1
   114                        
   115                        ?RTS:
   116 00:F26B: 73 BE         	LDA		R_KeyHold_Time
   117 00:F26D: 56 5A         	CMP		#D_Key3S
   118 00:F26F: 13 07         	BEQ		L_Key5_Enter_End
   119 00:F271: 73 BE         	LDA		R_KeyHold_Time
   120 00:F273: 03            	INC
   121 00:F274: 7F BE         	STA		R_KeyHold_Time
   122 00:F276: 09            	RTS
   123                        ?End:
   124 00:F277: 09            	RTS
   125                        
   126                        L_Key5_Enter_End:
   127 00:F278: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   128 00:F27A: 53 00         	LDA		#0
   129 00:F27C: 7F A2         	STA		R_No_Key			;;若10S内有按键按下，重置R_No_Key
   130 00:F27E: 53 00         	LDA		#0
   131 00:F280: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   132 00:F282: 73 BF         	LDA		R_Fast_Time
   133 00:F284: 56 04         	CMP		#C_Fast_Time
   134 00:F286: 10 34         	BCC		L_Inc_Fast_Time		;;R_Fast_Time<C_Fast_Time,C=0时跳转,R_Fast_Time继续累加
   135 00:F288: 53 00         	LDA		#0
   136 00:F28A: 7F BF         	STA		R_Fast_Time			;;达到按键时长,R_Fast_Time>=C_Fast_Time,C=1不跳转,R_Fast_Time重置为0,一次快加结束
   137                        	; BBS0	Sys_Flag_B,?STW_CTW		;;判断时间(0)/计时(1)模式
   138 00:F28C: 15 90 F4      	JSR		L_FastAdd_Prog
   139 00:F28F: 09            	RTS
   140                        ; ?STW_CTW:
   141                        ; 	BBS1	Sys_Flag_B,?RTS		;;判断计时开始(1)/暂停(0)
   142                        ; 	JSR		L_FastAdd_Prog
   143                        ; ?RTS:
   144                        ; 	RTS
   145                        
   146                        ;==================================================
   147                        L_Key7_Enter:
   148 00:F290: 3F 99 04      	BBS7	Sys_Flag_A,?RTS
   149 00:F293: 2F 99         	SMB7	Sys_Flag_A
   150 00:F295: 2A 9D         	SMB2	R_Key_Flag		;;bit2=1
   151                        
   152                        ?RTS:
   153 00:F297: 73 BE         	LDA		R_KeyHold_Time
   154 00:F299: 56 5A         	CMP		#D_Key3S
   155 00:F29B: 13 07         	BEQ		L_Key7_Enter_End
   156 00:F29D: 73 BE         	LDA		R_KeyHold_Time
   157 00:F29F: 03            	INC
   158 00:F2A0: 7F BE         	STA		R_KeyHold_Time
   159 00:F2A2: 09            	RTS
   160                        ?End:
   161 00:F2A3: 09            	RTS
   162                        
   163                        L_Key7_Enter_End:
   164 00:F2A4: 53 00         	LDA		#0
   165 00:F2A6: 7F A2         	STA		R_No_Key		;;若10S内有按键按下，重置R_No_Key
   166 00:F2A8: 53 00         	LDA		#0
   167 00:F2AA: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   168 00:F2AC: 22 9D         	RMB2	R_Key_Flag
   169 00:F2AE: 73 BF         	LDA		R_Fast_Time
   170 00:F2B0: 56 04         	CMP		#C_Fast_Time
   171 00:F2B2: 10 08         	BCC		L_Inc_Fast_Time		;;R_Fast_Time<C_Fast_Time,C=0时跳转,R_Fast_Time继续累加
   172 00:F2B4: 53 00         	LDA		#0
   173 00:F2B6: 7F BF         	STA		R_Fast_Time
   174 00:F2B8: 15 D4 F4      	JSR		L_FastDec_Prog
   175 00:F2BB: 09            	RTS
   176                        
   177                        ;============================================================
   178                        L_Inc_Fast_Time:
   179 00:F2BC: 04            	CLC
   180 00:F2BD: 73 BF         	LDA		R_Fast_Time
   181 00:F2BF: 54 01         	ADC		#1
   182 00:F2C1: 7F BF         	STA		R_Fast_Time
   183 00:F2C3: 09            	RTS
   184                        ;============================================================
   185                        L_ManyKey:
   186 00:F2C4: 73 9D         	LDA		R_Key_Flag
   187 00:F2C6: 50 80         	ORA		#BIT7
   188 00:F2C8: 7F 9D         	STA		R_Key_Flag
   189                        L_End_KeyScan_Prog:
   190 00:F2CA: 09            	RTS
   191                        
   192                        ;============================================================
   193                        ;============================================================
   194                        L_Null_Key_Prog:
   195 00:F2CB: 15 1F F5      	JSR		F_KeyIoPAInputHigh
   196 00:F2CE: 53 00         	LDA		#$0
   197 00:F2D0: 7F BE         	STA		R_KeyHold_Time
   198                        
   199 00:F2D2: 15 F7 F2      	JSR		L_REALSE_2KEY
   200 00:F2D5: 15 3C F3      	JSR		L_REALSE_5KEY
   201 00:F2D8: 15 75 F3      	JSR		L_REALSE_7KEY
   202                        
   203 00:F2DB: 24 99         	RMB4 	Sys_Flag_A
   204 00:F2DD: 26 99         	RMB6 	Sys_Flag_A
   205 00:F2DF: 27 99         	RMB7 	Sys_Flag_A
   206                        
   207 00:F2E1: 20 9B         	RMB0	Sys_Flag_C		;;清除快加/快减标志位
   208                        
   209 00:F2E3: 73 9D         	LDA		R_Key_Flag
   210 00:F2E5: 51 7F         	AND		#%01111111
   211 00:F2E7: 7F 9D         	STA		R_Key_Flag
   212                        
   213 00:F2E9: 15 18 F5      	JSR		Stz_Fast_Hold_Key
   214 00:F2EC: 73 BD         	LDA		R_Voice_Unit
   215 00:F2EE: 12 06         	BNE		L_End_Null_Key_Prog
   216                        
   217                        ;	JSR		L_Mode_Prog
   218                        ;;L_Exit_Null_Key_Prog:
   219                        ;	ST_DIS
   220                        	DIS_LCD_IRQ
+  220 00:F2F0: 26 0E          RMB6 P_IER
   221 00:F2F2: 24 0F         	RMB4	P_IFR
   222                        	EN_PA_IRQ
+  222 00:F2F4: 2C 0E          SMB4 P_IER
   223                        L_End_Null_Key_Prog:
   224 00:F2F6: 09            	RTS
   225                        ;============================================================
   226                        L_REALSE_2KEY:
   227 00:F2F7: 30 9D 41      	BBR0	R_Key_Flag, L_REALSE_2KEY_RTS  ;;判断bit0=0?  =0：不是2key，跳转
   228 00:F2FA: 20 9D         	RMB0	R_Key_Flag			;;bit0=1时，清除-->bit0=0
   229 00:F2FC: 53 00         	LDA		#0
   230 00:F2FE: 7F A2         	STA		R_No_Key		;;若10S内有按键按下，重置R_No_Key
   231 00:F300: 53 00         	LDA		#0
   232 00:F302: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   233 00:F304: 38 9A 1D      	BBS0	Sys_Flag_B,?Start		;;判断是否已经进入计时模式
   234 00:F307: 73 A1         	LDA		R_Set_Flag
   235 00:F309: 13 11         	BEQ		?RTS		;;判断R_Set_Flag=0？ 为0 ：不执行 不为0：R_Set_Flag+1
   236 00:F30B: 78 A1         	INC		R_Set_Flag
   237 00:F30D: 73 A1         	LDA		R_Set_Flag
   238 00:F30F: 56 04         	CMP		#4			;;判断R_Set_Flag
   239 00:F311: 13 04         	BEQ		?ZERO
   240 00:F313: 15 AE F3      	JSR		L_Display_Mode0Prog
   241 00:F316: 09            	RTS
   242                        ?ZERO:
   243 00:F317: 53 00         	LDA		#0				;;R_Set_Flag置0
   244 00:F319: 7F A1         	STA		R_Set_Flag
   245 00:F31B: 09            	RTS
   246                        
   247                        ?RTS:
   248 00:F31C: 28 9A         	SMB0	Sys_Flag_B			;;set=0，短按标记，进入计时模式(默认正计时)
   249 00:F31E: 2A 9A         	SMB2	Sys_Flag_B			;;标记倒计时
   250 00:F320: 15 AE F3      	JSR		L_Display_Mode0Prog
   251 00:F323: 09            	RTS
   252                        
   253                        ?Start:
   254 00:F324: 3B 9A 07      	BBS3	Sys_Flag_B,?CTW_Zero	;;判断是否是正计时最大状态下
   255 00:F327: 73 9A         	LDA		Sys_Flag_B		;;控制计时开始/暂停
   256 00:F329: 52 02         	EOR		#BIT1
   257 00:F32B: 7F 9A         	STA		Sys_Flag_B
   258 00:F32D: 09            	rts
   259                        ?CTW_Zero:
   260 00:F32E: 53 00         	LDA		#0
   261 00:F330: 7F AB         	STA		R_Stw_Sec		;;清零
   262 00:F332: 7F AC         	STA		R_Stw_Min
   263 00:F334: 23 9A         	RMB3	Sys_Flag_B
   264 00:F336: 22 9A         	RMB2	Sys_Flag_B			;;清零后，标记为正计时
   265 00:F338: 16 AE F3      	JMP		L_Display_Mode0Prog
   266                        
   267                        L_REALSE_2KEY_RTS:
   268 00:F33B: 09            	RTS
   269                        ;============================================================
   270                        L_REALSE_5KEY:
   271 00:F33C: 31 9D 33      	BBR1	R_Key_Flag,L_REALSE_5KEY_RTS	;;判断是否是PA5按下
   272 00:F33F: 53 00         	LDA		#0
   273 00:F341: 7F A2         	STA		R_No_Key
   274 00:F343: 53 00         	LDA		#0
   275 00:F345: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   276 00:F347: 73 A1         	LDA		R_Set_Flag
   277 00:F349: 13 07         	BEQ		?STW					;;Set=0？ =0：跳转去判断计时模式
   278 00:F34B: 15 11 F4      	JSR		L_Set_Flag_Prog
   279 00:F34E: 15 AE F3      	JSR		L_Display_Mode0Prog
   280 00:F351: 09            	RTS
   281                        ?STW:
   282 00:F352: 30 9A 13      	BBR0	Sys_Flag_B,?CTW_5Key		;;判断是否为计时模式(BIT0=0,跳转)，时间模式切换为计时模式的时候
   283 00:F355: 3A 9A 09      	BBS2	Sys_Flag_B,?Ctw_D			;;计时模式下，判断正/倒计时
   284 00:F358: 39 9A 17      	BBS1	Sys_Flag_B,L_REALSE_5KEY_RTS	;;正计时模式，判断是否为暂停状态
   285 00:F35B: 2A 9A         	SMB2	Sys_Flag_B						;;正计时暂停状态下，按下PA5，标记倒计时
   286 00:F35D: 15 11 F4      	JSR		L_Set_Flag_Prog
   287 00:F360: 09            	RTS
   288                        
   289                        ?Ctw_D:
   290 00:F361: 39 9A 0E      	BBS1	Sys_Flag_B,L_REALSE_5KEY_RTS	;;倒计时模式，判断是否为暂停状态
   291 00:F364: 15 11 F4      	JSR		L_Set_Flag_Prog
   292 00:F367: 09            	RTS
   293                        
   294                        ?CTW_5Key:
   295 00:F368: 21 9D         	RMB1	R_Key_Flag
   296 00:F36A: 28 9A         	SMB0	Sys_Flag_B			;;标记计时模式
   297 00:F36C: 2A 9A         	SMB2	Sys_Flag_B			;;标记开始时进入计时为倒计时
   298 00:F36E: 15 AE F3      	JSR		L_Display_Mode0Prog
   299 00:F371: 09            	RTS
   300                        
   301                        L_REALSE_5KEY_RTS:
   302 00:F372: 21 9D         	RMB1	R_Key_Flag
   303 00:F374: 09            	RTS
   304                        
   305                        ;===============================================================
   306                        L_REALSE_7KEY:
   307 00:F375: 32 9D 33      	BBR2	R_Key_Flag,L_REALSE_7KEY_RTS
   308 00:F378: 53 00         	LDA		#0
   309 00:F37A: 7F A2         	STA		R_No_Key
   310 00:F37C: 53 00         	LDA		#0
   311 00:F37E: 7F A3         	STA		R_STW_Key			;;若30S内有按键按下，重置R_STW_Key
   312 00:F380: 73 A1         	LDA		R_Set_Flag
   313 00:F382: 13 07         	BEQ		?STW
   314 00:F384: 15 11 F4      	JSR		L_Set_Flag_Prog
   315 00:F387: 15 AE F3      	JSR		L_Display_Mode0Prog
   316 00:F38A: 09            	RTS
   317                        ?STW:
   318 00:F38B: 30 9A 13      	BBR0	Sys_Flag_B,?CTW_7Key		;;判断是否为计时模式(BIT0=0,跳转)，时间模式切换为计时模式的时候
   319 00:F38E: 3A 9A 09      	BBS2	Sys_Flag_B,?Ctw_D			;;判断正/倒计时
   320 00:F391: 39 9A 17      	BBS1	Sys_Flag_B,L_REALSE_7KEY_RTS	;;正计时模式，判断是否为暂停状态
   321 00:F394: 2A 9A         	SMB2	Sys_Flag_B						;;正计时暂停状态下，按下PA7，标记倒计时
   322 00:F396: 15 11 F4      	JSR		L_Set_Flag_Prog
   323 00:F399: 09            	RTS
   324                        
   325                        ?Ctw_D:
   326 00:F39A: 39 9A 0E      	BBS1	Sys_Flag_B,L_REALSE_7KEY_RTS	;;倒计时模式，判断是否为暂停状态
   327 00:F39D: 15 11 F4      	JSR		L_Set_Flag_Prog
   328 00:F3A0: 09            	RTS
   329                        
   330                        ?CTW_7Key:
   331 00:F3A1: 22 9D         	RMB2	R_Key_Flag
   332 00:F3A3: 28 9A         	SMB0	Sys_Flag_B			;;标记计时模式
   333 00:F3A5: 2A 9A         	SMB2	Sys_Flag_B			;;标记开始进入计时为倒计时
   334 00:F3A7: 15 AE F3      	JSR		L_Display_Mode0Prog
   335 00:F3AA: 09            	RTS
   336                        
   337                        L_REALSE_7KEY_RTS:
   338 00:F3AB: 22 9D         	RMB2	R_Key_Flag
   339 00:F3AD: 09            	RTS
   340                        
   341                        ;===============================================================
   342                        ;===============================================================
   343                        L_Display_Mode0Prog:
   344 00:F3AE: 38 9A 0E      	BBS0	Sys_Flag_B,?STW
   345 00:F3B1: 73 A1         	LDA		R_Set_Flag
   346 00:F3B3: 04            	CLC
   347 00:F3B4: 18            	ROL
   348 00:F3B5: 1B            	TAX
   349 00:F3B6: 63 C7 F3      	LDA		T_Display_Table+1,X
   350 00:F3B9: 0A            	PHA
   351 00:F3BA: 63 C6 F3      	LDA		T_Display_Table,X
   352 00:F3BD: 0A            	PHA
   353 00:F3BE: 09            	RTS
   354                        ?STW:
   355 00:F3BF: 21 9D         	RMB1	R_Key_Flag
   356 00:F3C1: 22 9D         	RMB2	R_Key_Flag
   357 00:F3C3: 16 91 F5      	JMP		L_STWDisplay_Prog
   358                        
   359                        T_Display_Table:
   360 00:F3C6: CD F3         	DW		L_Display_Prog-1	;;R_Set_Flag=0
   361 00:F3C8: 58 F6         	DW		L_Key5_DisHR-1		;;R_Set_Flag=1
   362 00:F3CA: CD F3         	DW		L_Display_Prog-1	;;R_Set_Flag=2
   363 00:F3CC: CD F3         	DW		L_Display_Prog-1	;;R_Set_Flag=3
   364                        
   365                        L_Display_Prog:
   366 00:F3CE: 15 E7 F5      	JSR		F_ClrMs
   367 00:F3D1: 15 68 F7      	JSR		L_Dis_TimeHr
   368 00:F3D4: 15 53 F6      	JSR		L_Dis_TimeMin
   369 00:F3D7: 15 4F F6      	JSR		L_DisCol_Prog
   370 00:F3DA: 09            	RTS
   371                        ;===============================================================
   372                        ;===============================================================
   373                        L_1Hz_Flash_Prog:
   374 00:F3DB: 39 9A 2F      	BBS1	Sys_Flag_B,L_MS_Flash
   375 00:F3DE: 38 9B 0D      	BBS0	Sys_Flag_C,?RTS			;;判断bit0=1? =1:快加/快减标志,不执行闪烁
   376 00:F3E1: 73 A1         	LDA		R_Set_Flag
   377 00:F3E3: 04            	CLC
   378 00:F3E4: 18            	ROL
   379 00:F3E5: 1B            	TAX
   380 00:F3E6: 63 F0 F3      	LDA		T_Flash_Table+1,X
   381 00:F3E9: 0A            	PHA
   382 00:F3EA: 63 EF F3      	LDA		T_Flash_Table,X
   383 00:F3ED: 0A            	PHA
   384                        ?RTS:
   385 00:F3EE: 09            	RTS
   386                        
   387                        T_Flash_Table:
   388 00:F3EF: F6 F3         	DW		L_Flash_Set0-1		;;R_Set_Flag=0
   389 00:F3F1: FD F3         	DW		L_Flash_Set1-1		;;R_Set_Flag=1
   390 00:F3F3: 04 F4         	DW		L_Flash_Set2-1		;;R_Set_Flag=2
   391 00:F3F5: 08 F4         	DW		L_Flash_Set3-1		;;R_Set_Flag=3
   392                        
   393                        L_Flash_Set0:
   394 00:F3F7: 38 9A 03      	BBS0	Sys_Flag_B,?RTS
   395 00:F3FA: 15 AD F5      	JSR		F_ClrCol
   396                        ?RTS:
   397 00:F3FD: 09            	rts
   398                        L_Flash_Set1:
   399 00:F3FE: 15 B2 F5      	JSR		F_Clr12
   400 00:F401: 15 C0 F5      	JSR		F_Clr34
   401 00:F404: 09            	rts
   402                        L_Flash_Set2:
   403 00:F405: 15 B2 F5      	JSR		F_Clr12
   404 00:F408: 09            	rts
   405                        L_Flash_Set3:
   406 00:F409: 15 C0 F5      	JSR		F_Clr34
   407 00:F40C: 09            	rts
   408                        
   409                        L_MS_Flash:
   410 00:F40D: 15 E7 F5      	JSR		F_ClrMs
   411 00:F410: 09            	RTS
   412                        ; ;=======================================================
   413                        L_Set_Flag_Prog:
   414 00:F411: 73 A1         	LDA		R_Set_Flag
   415 00:F413: 04            	CLC
   416 00:F414: 18            	ROL
   417 00:F415: 1B            	TAX
   418 00:F416: 63 20 F4      	LDA		T_Set_Table+1,X
   419 00:F419: 0A            	PHA
   420 00:F41A: 63 1F F4      	LDA		T_Set_Table,X
   421 00:F41D: 0A            	PHA
   422 00:F41E: 09            	RTS
   423                        
   424                        T_Set_Table:
   425 00:F41F: 26 F4         	DW		L_Flag_Set0-1		;;R_Set_Flag=0
   426 00:F421: 43 F4         	DW		L_Flag_Set1-1		;;R_Set_Flag=1
   427 00:F423: 5D F4         	DW		L_Flag_Set2-1		;;R_Set_Flag=2
   428 00:F425: 76 F4         	DW		L_Flag_Set3-1		;;R_Set_Flag=3
   429                        
   430                        L_Flag_Set0:
   431 00:F427: 31 9D 0B      	BBR1	R_Key_Flag, L_REALSE_CTW7KEY_SecFlag  ;;判断bit1=0?  =0：不是5key，跳转
   432 00:F42A: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   433 00:F42C: 15 51 F7      	JSR		R_CtwInc_Min				;;"分"加
   434 00:F42F: 73 AC         	LDA		R_Stw_Min
   435 00:F431: 15 05 F6      	JSR		L_Dis_Digit12
   436 00:F434: 09            	RTS
   437                        L_REALSE_CTW7KEY_SecFlag:
   438 00:F435: 32 9D 0B      	BBR2	R_Key_Flag,?RTS  ;;判断bit2=0?  =0：不是7key，跳转
   439 00:F438: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   440 00:F43A: 15 4D F7      	JSR		R_CtwInc_Sec				;;"秒"加
   441 00:F43D: 73 AB         	LDA		R_Stw_Sec
   442 00:F43F: 15 18 F6      	JSR		L_Dis_Digit34
   443 00:F442: 09            	RTS
   444                        ?RTS:
   445 00:F443: 09            	rts
   446                        
   447                        
   448                        L_Flag_Set1:					;;12/24HR
   449 00:F444: 31 9D 06      	BBR1	R_Key_Flag, L_REALSE_7KEY_12or24Flag  ;;判断bit1=0?  =0：不是5key，跳转
   450 00:F447: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   451 00:F449: 15 57 F4      	JSR		L_REALSE_12or24Flag
   452 00:F44C: 09            	RTS
   453                        L_REALSE_7KEY_12or24Flag:
   454 00:F44D: 32 9D 06      	BBR2	R_Key_Flag,?RTS  	;;判断bit2=0?  =0：不是7key，跳转
   455 00:F450: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   456 00:F452: 15 57 F4      	JSR		L_REALSE_12or24Flag
   457 00:F455: 09            	RTS
   458                        ?RTS:
   459 00:F456: 09            	rts
   460                        
   461                        L_REALSE_12or24Flag:
   462 00:F457: 73 9A         	LDA		Sys_Flag_B
   463 00:F459: 52 20         	EOR		#BIT5
   464 00:F45B: 7F 9A         	STA		Sys_Flag_B			;;改变bit5位
   465 00:F45D: 09            	RTS
   466                        
   467                        
   468                        L_Flag_Set2:
   469 00:F45E: 31 9D 09      	BBR1	R_Key_Flag, L_REALSE_7KEY_HrFlag  ;;判断bit1=0?  =0：不是5key，跳转
   470 00:F461: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   471 00:F463: 15 F1 F6      	JSR		F_HrInc				;;"时"加
   472 00:F466: 15 68 F7      	JSR		L_Dis_TimeHr
   473 00:F469: 09            	RTS
   474                        L_REALSE_7KEY_HrFlag:
   475 00:F46A: 32 9D 09      	BBR2	R_Key_Flag,?RTS  ;;判断bit2=0?  =0：不是7key，跳转
   476 00:F46D: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   477 00:F46F: 15 F7 F6      	JSR		F_HrDec				;;"时"减
   478 00:F472: 15 68 F7      	JSR		L_Dis_TimeHr
   479 00:F475: 09            	RTS
   480                        ?RTS:
   481 00:F476: 09            	rts
   482                        
   483                        L_Flag_Set3:
   484 00:F477: 31 9D 09      	BBR1	R_Key_Flag, L_REALSE_7KEY_MinFlag  ;;判断bit1=0?  =0：不是5key，跳转
   485 00:F47A: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   486 00:F47C: 15 FD F6      	JSR		F_MinInc				;;"分"加
   487 00:F47F: 15 68 F7      	JSR		L_Dis_TimeHr
   488 00:F482: 09            	RTS
   489                        L_REALSE_7KEY_MinFlag:
   490 00:F483: 32 9D 09      	BBR2	R_Key_Flag,?RTS	 ;;判断bit2=0?  =0：不是7key，跳转
   491 00:F486: 22 9D         	RMB2	R_Key_Flag			;;bit2=1时，清除-->bit2=0
   492 00:F488: 15 01 F7      	JSR		F_MinDec				;;"分"减
   493 00:F48B: 15 68 F7      	JSR		L_Dis_TimeHr
   494 00:F48E: 09            	RTS
   495                        ?RTS:
   496 00:F48F: 09            	rts
   497                        ; ;=======================================================
   498                        L_FastAdd_Prog:
   499 00:F490: 28 9B         	SMB0	Sys_Flag_C			;;标记快加
   500 00:F492: 73 A1         	LDA		R_Set_Flag
   501 00:F494: 04            	CLC
   502 00:F495: 18            	ROL
   503 00:F496: 1B            	TAX
   504 00:F497: 63 A1 F4      	LDA		T_FastAdd_Table+1,X
   505 00:F49A: 0A            	PHA
   506 00:F49B: 63 A0 F4      	LDA		T_FastAdd_Table,X
   507 00:F49E: 0A            	PHA
   508 00:F49F: 09            	RTS
   509                        
   510                        T_FastAdd_Table:
   511 00:F4A0: A7 F4         	DW		L_FastAdd_Set0-1		;;R_Set_Flag=0
   512 00:F4A2: C4 F4         	DW		L_FastAdd_Set1-1		;;R_Set_Flag=1
   513 00:F4A4: C5 F4         	DW		L_FastAdd_Set2-1		;;R_Set_Flag=2
   514 00:F4A6: CC F4         	DW		L_FastAdd_Set3-1		;;R_Set_Flag=3
   515                        
   516                        L_FastAdd_Set0:
   517 00:F4A8: 31 9D 0B      	BBR1	R_Key_Flag, L_FsatAdd_CTW7KEY_SecFlag  ;;判断bit1=0?  =0：不是5key，跳转
   518 00:F4AB: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   519 00:F4AD: 15 51 F7      	JSR		R_CtwInc_Min				;;"分"加
   520 00:F4B0: 73 AC         	LDA		R_Stw_Min
   521 00:F4B2: 15 05 F6      	JSR		L_Dis_Digit12
   522 00:F4B5: 09            	RTS
   523                        L_FsatAdd_CTW7KEY_SecFlag:
   524 00:F4B6: 32 9D 0B      	BBR2	R_Key_Flag,?RTS  ;;判断bit1=0?  =0：不是7key，跳转
   525 00:F4B9: 22 9D         	RMB2	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   526 00:F4BB: 15 4D F7      	JSR		R_CtwInc_Sec				;;"秒"加
   527 00:F4BE: 73 AB         	LDA		R_Stw_Sec
   528 00:F4C0: 15 18 F6      	JSR		L_Dis_Digit34
   529 00:F4C3: 09            	rts
   530                        ?RTS:
   531 00:F4C4: 09            	RTS
   532                        L_FastAdd_Set1:
   533 00:F4C5: 09            	rts
   534                        L_FastAdd_Set2:
   535 00:F4C6: 15 F1 F6      	JSR		F_HrInc				;;"时"加
   536 00:F4C9: 15 68 F7      	JSR		L_Dis_TimeHr
   537 00:F4CC: 09            	RTS
   538                        
   539                        L_FastAdd_Set3:
   540 00:F4CD: 15 FD F6      	JSR		F_MinInc				;;"分"加
   541 00:F4D0: 15 53 F6      	JSR		L_Dis_TimeMin
   542 00:F4D3: 09            	RTS
   543                        ; ;=======================================================
   544                        L_FastDec_Prog:
   545 00:F4D4: 28 9B         	SMB0	Sys_Flag_C		;;标记快减
   546 00:F4D6: 73 A1         	LDA		R_Set_Flag
   547 00:F4D8: 04            	CLC
   548 00:F4D9: 18            	ROL
   549 00:F4DA: 1B            	TAX
   550 00:F4DB: 63 E5 F4      	LDA		T_FastDec_Table+1,X
   551 00:F4DE: 0A            	PHA
   552 00:F4DF: 63 E4 F4      	LDA		T_FastDec_Table,X
   553 00:F4E2: 0A            	PHA
   554 00:F4E3: 09            	RTS
   555                        
   556                        T_FastDec_Table:
   557 00:F4E4: EB F4         	DW		L_FastDec_Set0-1		;;R_Set_Flag=0
   558 00:F4E6: 08 F5         	DW		L_FastDec_Set1-1		;;R_Set_Flag=1
   559 00:F4E8: 09 F5         	DW		L_FastDec_Set2-1		;;R_Set_Flag=2
   560 00:F4EA: 10 F5         	DW		L_FastDec_Set3-1		;;R_Set_Flag=3
   561                        
   562                        L_FastDec_Set0:
   563 00:F4EC: 31 9D 0B      	BBR1	R_Key_Flag, L_FsatAdd_STW7KEY_SecFlag  ;;判断bit1=0?  =0：不是5key，跳转
   564 00:F4EF: 21 9D         	RMB1	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   565 00:F4F1: 15 51 F7      	JSR		R_CtwInc_Min				;;"分"加
   566 00:F4F4: 73 AC         	LDA		R_Stw_Min
   567 00:F4F6: 15 05 F6      	JSR		L_Dis_Digit12
   568 00:F4F9: 09            	RTS
   569                        L_FsatAdd_STW7KEY_SecFlag:
   570 00:F4FA: 32 9D 0B      	BBR2	R_Key_Flag,?RTS  ;;判断bit1=0?  =0：不是7key，跳转
   571 00:F4FD: 22 9D         	RMB2	R_Key_Flag			;;bit1=1时，清除-->bit1=0
   572 00:F4FF: 15 4D F7      	JSR		R_CtwInc_Sec				;;"秒"加
   573 00:F502: 73 AB         	LDA		R_Stw_Sec
   574 00:F504: 15 18 F6      	JSR		L_Dis_Digit34
   575 00:F507: 09            	rts
   576                        ?RTS:
   577 00:F508: 09            	RTS
   578                        
   579                        L_FastDec_Set1:
   580 00:F509: 09            	rts
   581                        L_FastDec_Set2:
   582 00:F50A: 15 F7 F6      	JSR		F_HrDec				;;"时"减
   583 00:F50D: 15 68 F7      	JSR		L_Dis_TimeHr
   584 00:F510: 09            	RTS
   585                        
   586                        L_FastDec_Set3:
   587 00:F511: 15 01 F7      	JSR		F_MinDec				;;"分"减
   588 00:F514: 15 53 F6      	JSR		L_Dis_TimeMin
   589 00:F517: 09            	RTS
   590                        
   591                        
   592                        ;============================================================
   593                        Stz_Fast_Hold_Key:
   594 00:F518: 53 00         	LDA		#0
   595 00:F51A: 7F BF         	STA		R_Fast_Time
   596 00:F51C: 7F BE         	STA		R_KeyHold_Time
   597 00:F51E: 09            	RTS
   598                        ;============================================================
   599                        ;===============================================================
   600                        ; F_KeyUpdateDis:
   601                        ; 	JSR		F_ClearScreen
   602                        ; 	; JMP		L_Display_Prog
   603                        
   604                        
   605                        ; L_Beep_Control_Prog:			;控制声音频率
   606                        ; 	LDA		Sys_Flag_B
   607                        ; 	AND		#BIT2				;静音状态不发出声音
   608                        ; 	BNE		L_StzVoice
   609                        
   610                        ; 	LDA     Sys_Flag_B
   611                        ;     AND     #BIT3
   612                        ;     BEQ     L_Set16HzBIT
   613                        
   614                        ; 	LDA		Sys_Flag_B
   615                        ; 	AND		#BIT3_
   616                        ; 	STA		Sys_Flag_B
   617                        
   618                        
   619                        
   620                        ; 	LDA		R_Voice_Unit
   621                        ; 	BEQ		L_End_OpenBeep
   622                        ; 	DEC		R_Voice_Unit
   623                        ; 	BNE		L_ContinueJudge
   624                        ; 	;JSR		L_LightOff
   625                        ; 	BRA		L_CloseBeep
   626                        ; L_ContinueJudge:
   627                        ; 	LDA		R_Voice_Unit
   628                        ; 	AND		#BIT0
   629                        ; 	BEQ		L_JudgeOpenBeep	;L_OpenBeep
   630                        ; 	BRA		L_CloseBeep
   631                        ; ;	JSR		L_LightOn
   632                        ; L_StzVoice:
   633                        ; 	LDA		#0
   634                        ; 	STA		R_Voice_Unit
   635                        ; L_CloseBeep:
   636                        ; 	PB2_PB2_NMOS
   637                        ; 	PB3_PB3_NMOS
   638                        ; 	LDA	 #$FF
   639                        ; 	STA	 P_PB
   640                        ; 	PWM_OFF
   641                        ; 	RTS
   642                        
   643                        ; L_JudgeOpenBeep:
   644                        ; ;	JSR		L_LightOff
   645                        ; L_OpenBeep:
   646                        ; 	PB2_PWM
   647                        ;     LDA	 #$FF
   648                        ; 	STA	 P_PB
   649                        ; 	PB3_PWM
   650                        ; 	PWM_ON
   651                        
   652                        ; ?3Key:
   653                        ;     TONE_4KHZ_3_4_Duty
   654                        ; 	;TONE_2KHZ_3_4_Duty
   655                        ; 	;PWM_ON
   656                        ; 	RTS
   657                        ; L_End_OpenBeep:
   658                        ; 	RTS
   659                        
   660                        ; L_Set16HzBIT:
   661                        ; 	LDA		Sys_Flag_B
   662                        ; 	ORA		#BIT3
   663                        ; 	STA		Sys_Flag_B
   664                        ; 	RTS
   665                        ;;--------------------------------------------------------------
   666                        ;;==============================================================
   667                        ;;==============================================================
   668                        ; F_KeyIoPCInputLow:
   669                        ; 	LDA		PCDIR_TEMP
   670                        ; 	AND		#00000000B
   671                        ; 	STA		PCDIR_TEMP
   672                        ; 	STA		PCDIR
   673                        ; 	LDA		PC_TEMP
   674                        ; 	AND		#00000000B
   675                        ; 	STA		PC_TEMP
   676                        ; 	STA		PC
   677                        ; 	NOP
   678                        ; 	LDA		PCDIR_TEMP
   679                        ; 	ORA		#00111111B
   680                        ; 	STA		PCDIR_TEMP
   681                        ; 	STA		PCDIR
   682                        ; 	LDA		PC_TEMP
   683                        ; 	ORA		#00111111B
   684                        ; 	STA		PC_TEMP
   685                        ; 	STA		PC
   686                        ; 	RTS
   687                        
   688                        ; F_KeyIoPCOutputLow:
   689                        ; 	LDA		PCDIR_TEMP
   690                        ; 	AND		#00000000B
   691                        ; 	STA		PCDIR_TEMP
   692                        ; 	STA		PCDIR
   693                        ; 	LDA		PC_TEMP
   694                        ; 	AND		#00000000B
   695                        ; 	STA		PC_TEMP
   696                        ; 	STA		PC
   697                        ; 	RTS
   698                        
   699                        
   700                        ; F_KeyIoPAOutputLow:
   701                        ; 	LDA		PADIR_TEMP
   702                        ; 	AND		#11111011B
   703                        ; 	STA		PADIR_TEMP
   704                        ; 	STA		PADIR
   705                        ; 	LDA		PA_TEMP
   706                        ; 	ORA		#00000100B
   707                        ; 	STA		PA_TEMP
   708                        ; 	STA		PA
   709                        ; 	RTS
   710                        
   711                        F_KeyIoPAInputHigh:
   712 00:F51F: 73 CB         	LDA		PADIR_TEMP
   713 00:F521: 50 A4         	ORA		#10100100B
   714 00:F523: 7F CB         	STA		PADIR_TEMP
   715 00:F525: 7F 04         	STA		PADIR
   716 00:F527: 73 CC         	LDA		PA_TEMP
   717 00:F529: 51 5B         	AND		#01011011B
   718 00:F52B: 7F CC         	STA		PA_TEMP
   719 00:F52D: 7F 01         	STA		PA
   720 00:F52F: 09            	RTS
   721                        
   722                        
   723                        ;;===========================
   724                        L_ScanKey_Delay_Prog:		;等待功能，循环
   725 00:F530: 53 F0         	LDA		#$F0
   726 00:F532: 7F C2         	STA		P_Temp
   727                        L_Loop_ScanKey_Delay:
   728 00:F534: 78 C2         	INC		P_Temp
   729 00:F536: 12 FC         	BNE		L_Loop_ScanKey_Delay
   730 00:F538: 09            	RTS
   731                        ;;===========================
   732                        
   733                        ;;==========================
   734                        
   735                        ;===========================
   736                        
   737                        ;=================================================
   738                        ; Judge_Stw_Ending_Voice:
   739                        ;     LDA     Sys_Flag_B
   740                        ;     AND     #BIT4
   741                        ;     BNE     Judge_Stw_Ending_Voice_AlRun
   742                        
   743                        ; 	LDA		R_Key_Flag
   744                        ; 	AND		#BIT7
   745                        ; 	BNE		Skip_Then
   746                        
   747                        ; 	BRA		Judge_Stw_Ending_Voice_End
   748                        
   749                        ; Judge_Stw_Ending_Voice_AlRun:
   750                        ; 	LDA     Sys_Flag_B
   751                        ;     AND     #BIT4_
   752                        ; 	STA		Sys_Flag_B
   753                        
   754                        ; 	LDA		#0
   755                        ; 	STA		R_Beep_Time
   756                        ; ;	JSR		Judge_F_AlarmBeepControl
   757                        ; 	LDA		R_KeyValue
   758                        ; 	CMP		#D_Key4
   759                        ; 	BNE		Skip_Then
   760                        
   761                        ; 	LDA		Sys_Flag_B
   762                        ; 	ORA		#BIT1
   763                        ; 	STA		Sys_Flag_B
   764                        
   765                        
   766                        ; ;	JSR		Judge_Alarm_Spl
   767                        
   768                        ; 	JSR		F_DisZZ
   769                        
   770                        ;     BRA     Skip_Then
   771                        ; Skip_Then:
   772                        ; 	LDA     R_Key_Flag
   773                        ;     ORA     #BIT7
   774                        ;     STA     R_Key_Flag
   775                        
   776                        ;     SEC
   777                        ;     RTS
   778                        ; Judge_Stw_Ending_Voice_End:
   779                        ;     CLC
   780                        ;     RTS
   781                        ; ;===============
   782                        ; Judge_NoVoice:
   783                        ; 	LDA		Sys_Flag_B
   784                        ; 	AND		#BIT2
   785                        ; 	BEQ		Judge_NoVoice_End
   786                        ; 	JSR		F_DisMute
   787                        ; 	RTS
   788                        ; Judge_NoVoice_End:
   789                        ; 	JSR		F_ClrMute
   790                        ; 	RTS
   790                        
   138                        ; .include    Key\KeyNumb.asm
   139                        ; .include    Key\KeyLock.asm
   140                        ; .include    Key\KeyShort.asm
   141                        ; .include    Key\KeyLong.asm
   142                        
   143                        .include    Half_S.asm
     1                        ;=======================================================
     2                        L_2Hz_Prog:
     3 00:F539: 73 99         	LDA		Sys_Flag_A
     4 00:F53B: 51 01         	AND		#BIT0
     5 00:F53D: 13 11         	BEQ		L_End_2Hz_Prog
     6                        
     7                        
     8 00:F53F: 73 99         	LDA		Sys_Flag_A
     9 00:F541: 51 FE         	AND		#~BIT0		;清半秒标志
    10 00:F543: 52 02         	EOR		#BIT1
    11 00:F545: 7F 99         	STA		Sys_Flag_A
    12                        
    13                        	;JSR		Judge_Alarm_T1_Flash
    14                        	;JSR		Judge_Stw_TimeKeeping
    15                        	;JSR		Judge_Stw_Forward
    16                        
    17 00:F547: 73 99         	LDA		Sys_Flag_A
    18 00:F549: 51 02         	AND		#BIT1
    19 00:F54B: 13 04         	BEQ		L_1Hz_Prog
    20                        
    21 00:F54D: 15 DB F3      	JSR		L_1Hz_Flash_Prog	;;闪烁
    22                        L_End_2Hz_Prog:
    23 00:F550: 09            	RTS
    24                        ;========================================================
    25                        
    26                        L_1Hz_Prog:
    27 00:F551: 15 A1 F6      	JSR		F_Update_Time_Prog
    28 00:F554: 15 B1 F6      	JSR		F_Update_STW_Prog	;;更新计时
    29 00:F557: 15 61 F5      	JSR		L_Nokey_Save		;;10S无操作保存退出设置
    30 00:F55A: 15 74 F5      	JSR		L_STWKey_Exit		;;计时模式30S无操作退出
    31 00:F55D: 15 AE F3      	JSR		L_Display_Mode0Prog
    32                        
    33                        L_1Hz_Prog_End:
    34 00:F560: 09            	RTS
    35                        
    36                        ; ;======================================================
    37                        ; ;============================================================
    38                        ;;设置过程中无操作10S，自动保存当前值，并退出设置模式
    39                        L_Nokey_Save:
    40 00:F561: 73 A2         	LDA		R_No_Key
    41 00:F563: 56 0A         	CMP		#10
    42 00:F565: 10 07         	BCC		L_Inc_Nokey_Time
    43 00:F567: 53 00         	LDA		#0
    44 00:F569: 7F A1         	STA		R_Set_Flag
    45 00:F56B: 7F A2         	STA		R_No_Key
    46 00:F56D: 09            	RTS
    47                        L_Inc_Nokey_Time:
    48 00:F56E: 73 A2         	LDA		R_No_Key
    49 00:F570: 03            	INC
    50 00:F571: 7F A2         	STA		R_No_Key
    51 00:F573: 09            	RTS
    52                        ;===============================================================
    53                        ;==============================================================
    54                        ;;计时结束后30秒内无操作退出到时间界面
    55                        L_STWKey_Exit:
    56 00:F574: 30 9A 12      	BBR0	Sys_Flag_B,?RTS
    57 00:F577: 39 9A 0F      	BBS1	Sys_Flag_B,?RTS
    58 00:F57A: 73 A3         	LDA		R_STW_Key
    59 00:F57C: 56 1E         	CMP		#30
    60 00:F57E: 10 0A         	BCC		L_Inc_STWKey_Time
    61 00:F580: 53 00         	LDA		#0
    62 00:F582: 7F A1         	STA		R_Set_Flag
    63 00:F584: 7F A3         	STA		R_STW_Key
    64 00:F586: 20 9A         	RMB0	Sys_Flag_B
    65 00:F588: 09            	RTS
    66                        
    67                        ?RTS:
    68 00:F589: 09            	RTS
    69                        L_Inc_STWKey_Time:
    70 00:F58A: 73 A3         	LDA		R_STW_Key
    71 00:F58C: 03            	INC
    72 00:F58D: 7F A3         	STA		R_STW_Key
    73 00:F58F: 09            	RTS
    74                        ;===============================================================
    75                        ; L_1Hz_Prog_Num:
    76                        ; 	JSR		F_Update_Time_Prog
    77                        
    78                        ; 	JSR		Judge_F_AlarmBeepControl	;闹钟声音
    79                        ; 	JSR		F_StwBeepControl
    80                        
    81                        ; 	JSR		L_Mode_Prog
    82                        ; L_Skip_Update_Time_Prog:
    83                        ; 	RTS
    84                        ; ;========================================================
    85                        
    86                        ; Judge_Lock_Num:
    87                        ; 	LDA		R_Mode
    88                        ; 	CMP		#D_Time_Mode
    89                        ; 	BNE		Judge_Lock_Num_End
    90                        
    91                        ; 	LDA		Sys_Flag_A
    92                        ; 	AND		#BIT6
    93                        ; 	BNE		Judge_Lock_Num_End
    94                        
    95                        ; 	LDA		R_Num
    96                        ; 	DEC
    97                        ; 	STA		R_Num
    98                        ; 	BNE		Judge_Lock_Num_End
    99                        
   100                        ; 	LDA		Sys_Flag_A
   101                        ; 	ORA		#BIT6
   102                        ; 	STA		Sys_Flag_A
   103                        ; Judge_Lock_Num_End:
   104                        ; 	RTS
   105                        
   105                        
   144                        .include    Display.asm
     1                        ;===========================================================
     2                         ;;;;;;;;;;;;;;;;;;;;Display Program;;;;;;;;;;;;;;;;;;;;;;;;
     3                        ;===========================================================
     4                        ; To_Timer:
     5                        ; 	JSR		L_Dis_Time
     6                        ; 	BRA		L_End_Mode_Prog
     7                        ; To_Stw:
     8                        ; 	JSR		L_Dis_Stw_Mode
     9                        ; 	BRA		L_End_Mode_Prog
    10                        ; To_AL:
    11                        ; 	JSR		L_Dis_Al_Mode
    12                        ; 	BRA		L_End_Mode_Prog
    13                        
    14                        
    15                        
    16                        ;lcd_alarm
    17                        ; L_Mode_Prog:
    18                        ; 	LDA		R_Mode
    19                        ; 	JSR		Judge_Alarm_Start
    20                        ; 	JSR		Judge_NoVoice
    21                        
    22                        ; 	JSR		Judge_Alarm_T1_Flash
    23                        
    24                        ; 	LDA		R_Mode
    25                        ; 	CMP		#D_Time_Mode
    26                        ; 	BEQ		To_Timer
    27                        ; 	CMP		#D_Stw_Mode
    28                        ; 	BEQ		To_Stw
    29                        ; 	CMP		#D_Al_Mode
    30                        ; 	BEQ		To_AL
    31                        
    32                        
    33                        L_End_Mode_Prog:
    34 00:F590: 09            	RTS
    35                        
    36                        
    37                        ; L_Display_Prog:
    38                        ; 	JMP		L_Mode_Prog
    39                        
    40                        ;========================================
    41                        
    42                        L_STWDisplay_Prog:
    43 00:F591: 15 D3 F5      	JSR		F_ClrAm
    44 00:F594: 15 DD F5      	JSR		F_ClrPm
    45 00:F597: 15 A8 F5      	JSR		F_DisCol
    46 00:F59A: 15 E2 F5      	JSR		F_DisMs
    47                        
    48 00:F59D: 73 AC         	LDA		R_Stw_Min
    49 00:F59F: 15 05 F6      	JSR		L_Dis_Digit12
    50 00:F5A2: 73 AB         	LDA		R_Stw_Sec
    51 00:F5A4: 15 18 F6      	JSR		L_Dis_Digit34
    52 00:F5A7: 09            	RTS
    53                        
    54                        F_DisCol:
    55 00:F5A8: 5E 1C         	LDX		#lcd_col
    56 00:F5AA: 16 5E F1      	JMP		F_DispSymbol	;显示 两点
    57                        F_ClrCol:
    58 00:F5AD: 5E 1C         	LDX		#lcd_col
    59 00:F5AF: 16 65 F1      	JMP		F_ClrpSymbol
    60                        
    61                        F_Clr12:
    62 00:F5B2: 53 0A         	LDA		#0AH
    63 00:F5B4: 5E 00         	LDX		#lcd_d1
    64 00:F5B6: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    65 00:F5B9: 53 0A         	LDA		#0AH
    66 00:F5BB: 5E 07         	LDX		#lcd_d2
    67 00:F5BD: 16 1A F1      	JMP		L_Dis_8Bit_DigitDot_Prog
    68                        
    69                        F_Clr34:
    70 00:F5C0: 53 0A         	LDA		#0AH
    71 00:F5C2: 5E 0E         	LDX		#lcd_d3
    72 00:F5C4: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    73 00:F5C7: 53 0A         	LDA		#0AH
    74 00:F5C9: 5E 15         	LDX		#lcd_d4
    75 00:F5CB: 16 1A F1      	JMP		L_Dis_8Bit_DigitDot_Prog
    76                        
    77                        F_DisAm:
    78 00:F5CE: 5E 1D         	LDX		#lcd_am
    79 00:F5D0: 16 5E F1      	JMP		F_DispSymbol	;显示AM
    80                        F_ClrAm:
    81 00:F5D3: 5E 1D         	LDX		#lcd_am
    82 00:F5D5: 16 65 F1      	JMP		F_ClrpSymbol
    83                        
    84                        
    85                        F_DisPM:
    86 00:F5D8: 5E 1E         	LDX		#lcd_pm
    87 00:F5DA: 16 5E F1      	JMP		F_DispSymbol	;显示PM
    88                        F_ClrPm:
    89 00:F5DD: 5E 1E         	LDX		#lcd_pm
    90 00:F5DF: 16 65 F1      	JMP		F_ClrpSymbol
    91                        
    92                        F_DisMs:
    93 00:F5E2: 5E 1F         	LDX		#lcd_ms
    94 00:F5E4: 16 5E F1      	JMP		F_DispSymbol	;显示MS
    95                        
    96                        
    97                        F_ClrMs:
    98 00:F5E7: 5E 1F         	LDX		#lcd_ms
    99 00:F5E9: 16 65 F1      	JMP		F_ClrpSymbol	;显示MS
   100                        ; F_DisClock:
   101                        ; 	LDX		#lcd_clock
   102                        ; 	JMP		F_DispSymbol	;显示时钟图标
   103                        
   104                        ; F_DisMute:
   105                        ; 	LDX		#lcd_mute
   106                        ; 	JMP		F_DispSymbol	;显示 静音 图标
   107                        
   108                        ; F_DisTime_end:
   109                        ; 	LDX		#lcd_time_end
   110                        ; 	JMP		F_DispSymbol	;显示时间到图标
   111                        
   112                        ; F_DisTimekeeping:
   113                        ; 	LDX		#lcd_timekeeping
   114                        ; 	JMP		F_DispSymbol	;显示计时图标
   115                        
   116                        ; F_DisStwOne:
   117                        ; 	LDX		#lcd_StwOne
   118                        ; 	JMP		F_DispSymbol
   119                        
   120                        ; F_DisStwTwo:
   121                        ; 	LDX		#lcd_StwTwo
   122                        ; 	JMP		F_DispSymbol
   123                        
   124                        ; F_DisZZ:
   125                        ; 	LDX		#lcd_ZZ
   126                        ; 	JMP		F_DispSymbol
   127                        
   128                        ; F_DisForward:
   129                        ; 	LDX		#lcd_forward
   130                        ; 	JMP		F_DispSymbol	;显示 正 图标
   131                        
   132                        ; F_DisT1:
   133                        ; 	LDX		#lcd_T1
   134                        ; 	JMP		F_DispSymbol	;显示时间到图标
   135                        ; ;=========================================
   136                        ; F_ClrClock:
   137                        ; 	LDX		#lcd_clock
   138                        ; 	JMP		F_ClrpSymbol	;清除时钟图标
   139                        
   140                        ; F_ClrMute:
   141                        ; 	LDX		#lcd_mute
   142                        ; 	JMP		F_ClrpSymbol	;清除 静音 图标
   143                        
   144                        ; F_ClrTime_end:
   145                        ; 	LDX		#lcd_time_end
   146                        ; 	JMP		F_ClrpSymbol	;清除时间到图标
   147                        
   148                        ; F_ClrTimekeeping:
   149                        ; 	LDX		#lcd_timekeeping
   150                        ; 	JMP		F_ClrpSymbol	;清除计时图标
   151                        
   152                        ; F_ClrStwOne:
   153                        ; 	LDX		#lcd_StwOne
   154                        ; 	JMP		F_ClrpSymbol
   155                        
   156                        ; F_ClrStwTwo:
   157                        ; 	LDX		#lcd_StwTwo
   158                        ; 	JMP		F_ClrpSymbol
   159                        
   160                        ; F_ClrZZ:
   161                        ; 	LDX		#lcd_ZZ
   162                        ; 	JMP		F_ClrpSymbol
   163                        
   164                        ; F_ClrForward:
   165                        ; 	LDX		#lcd_forward
   166                        ; 	JMP		F_ClrpSymbol	;清除 正 图标
   167                        
   168                        ; F_ClrT1:
   169                        ; 	LDX		#lcd_T1
   170                        ; 	JMP		F_ClrpSymbol	;显示时间到图标
   171                        ;==========================================
   172                        ;L_Judge_ClrAllDis:
   173                        ;	LDA		R_Bop
   174                        ;	BEQ		L_5Alarm_ClrAllDis
   175                        ;	CMP		#D_Num
   176                        ;	BEQ		L_Numtimer_ClrAllDis
   177                        ;	CMP		#D_Timer5
   178                        ;	BCC		L_4Timer_ClrAllDis
   179                        ;	LDX		#lcd_alarm
   180                        ;	JSR		F_ClrpSymbol
   181                        
   182                        ;	LDX		#lcd_motor
   183                        ;	JSR		F_ClrpSymbol
   184                        ;	RTS
   185                        
   186                        ;L_5Alarm_ClrAllDis:
   187                        ;	LDX		#lcd_t1_t
   188                        ;	JSR		F_ClrpSymbol
   189                        ;	LDX		#lcd_t2_t
   190                        ;	JSR		F_ClrpSymbol
   191                        ;	LDX		#lcd_t3_t
   192                        ;	JSR		F_ClrpSymbol
   193                        ;	LDX		#lcd_t4_t
   194                        ;	JSR		F_ClrpSymbol
   195                        ;	LDX		#lcd_t5_t
   196                        ;	JSR		F_ClrpSymbol
   197                        ;	LDX		#lcd_timer
   198                        ;	JSR		F_ClrpSymbol
   199                        ;	LDX		#lcd_up
   200                        ;	JSR		F_ClrpSymbol
   201                        ;	LDX		#lcd_down
   202                        ;	JMP		F_ClrpSymbol
   203                        
   204                        ;L_4Timer_ClrAllDis:
   205                        ;	LDX		#lcd_motor
   206                        ;	JSR		F_ClrpSymbol
   207                        
   208                        ;	LDX		#lcd_alarm
   209                        ;	JSR		F_ClrpSymbol
   210                        ;	LDX		#lcd_t5_t
   211                        ;	JSR		F_ClrpSymbol
   212                        ;	LDX		#lcd_t5_5
   213                        ;	JSR		F_ClrpSymbol
   214                        ;	LDX		#lcd_al5
   215                        ;	JMP		F_ClrpSymbol
   216                        
   217                        L_Numtimer_ClrAllDis:
   218 00:F5EC: 53 00         	LDA		#0
   219 00:F5EE: 4F 01 02      	STA		0201H
   220 00:F5F1: 4F 02 02      	STA		0202H
   221 00:F5F4: 4F 09 02      	STA		0209H
   222 00:F5F7: 53 80         	LDA		#$80
   223 00:F5F9: 4F 03 02      	STA		0203H
   224 00:F5FC: 53 FE         	LDA		#$FE
   225 00:F5FE: 4F 0A 02      	STA		020AH
   226 00:F601: 4F 12 02      	STA		0212H
   227 00:F604: 09            	RTS
   228                        ;==========================================
   229                        L_Dis_Digit_AlHr:
   230                        L_Dis_Digit_TimeHr:
   231                        L_Dis_Digit_TimeMonth:
   232                        L_Dis_Digit_TimerHr:
   233                        L_Dis_Digit12:
   234 00:F605: 5E 00         	LDX		#lcd_d1
   235 00:F607: 0A            	PHA
   236 00:F608: 15 7D F1      	JSR		L_ROR_4Bit_Prog
   237                        	; TAX
   238                        	; LDA		Lcd_1_table,X
   239 00:F60B: 5E 00         	LDX		#lcd_d1
   240 00:F60D: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
   241 00:F610: 5E 07         	LDX		#lcd_d2
   242 00:F612: 0C            	PLA
   243                        
   244 00:F613: 51 0F         	AND		#$0F
   245 00:F615: 16 1A F1      	JMP		L_Dis_8Bit_DigitDot_Prog
   246                        	;BRA		F_Dis_2Digit
   247                        ;=====================================================
   248                        ;=====================================================
   249                        L_Dis_Digit_AlMin:
   250                        L_Dis_Digit_TimeMin:
   251                        L_Dis_Digit_TimeDay:
   252                        L_Dis_Digit_TimerMin:
   253                        L_Dis_Digit34:
   254 00:F618: 5E 0E         	LDX		#lcd_d3
   255 00:F61A: 17 00         	BRA		F_Dis_2Digit
   256                        ;===============================================
   257                        L_Dis_Digit_AlSec:
   258                        L_Dis_Digit_TimeSec:
   259                        L_Dis_Digit_TimerSec:
   260                        L_Dis_Digit56:
   261                        ; 	LDX		#lcd_d5
   262                        ; ;	BRA		F_Dis_2Digit
   263                        F_Dis_2Digit:
   264 00:F61C: 0A            	PHA
   265 00:F61D: 15 7D F1      	JSR		L_ROR_4Bit_Prog
   266 00:F620: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
   267 00:F623: 7E C3         	LDX		P_Temp+1
   268 00:F625: 0C            	PLA
   269 00:F626: 51 0F         	AND		#$0F
   270 00:F628: 16 1A F1      	JMP		L_Dis_8Bit_DigitDot_Prog
   271                        ;===========================================================
   272                         ;;;;;;;;;;;;;;;;;;;;Flash Program;;;;;;;;;;;;;;;;;;;;;;;;
   273                        ;===========================================================
   274                        ;F_1Hz_Flash_Prog:
   275                        ;	LDA		R_Bop
   276                        ;	BEQ		L_1Hz_Flash_5Alarm
   277                        ;	CMP		#D_Num
   278                        ;	BEQ		L_1Hz_Flash_Num
   279                        ;L_1Hz_Flash_45Timer:
   280                        ;	JMP		L_Flash_Prog_5Timer
   281                        ;L_1Hz_Flash_5Alarm:
   282                        ;	JMP		L_Flash_Prog_5Alarm
   283                        ;L_1Hz_Flash_Num:
   284                        ;	JMP		L_Flash_Prog_Number
   285                        
   286                        L_Flash_Digit3:
   287 00:F62B: 5E 0E         	LDX		#lcd_d3
   288                        L_Flash_Digit:
   289 00:F62D: 53 0A         	LDA		#$0A
   290 00:F62F: 16 1A F1      	JMP		L_Dis_8Bit_DigitDot_Prog
   291                        L_Flash_Digit4:
   292 00:F632: 5E 15         	LDX		#lcd_d4
   293 00:F634: 17 F7         	BRA		L_Flash_Digit
   294                        ; L_Flash_Digit5:
   295                        ; 	LDX		#lcd_d5
   296                        ; 	BRA		L_Flash_Digit
   297                        ; L_Flash_Digit6:
   298                        ; 	LDX		#lcd_d6
   299                        ; 	BRA		L_Flash_Digit
   300                        
   301                        L_Flash_Digit12:
   302 00:F636: 53 AA         	LDA		#$AA
   303 00:F638: 16 05 F6      	JMP		L_Dis_Digit12
   304                        L_Flash_Digit34:
   305 00:F63B: 53 AA         	LDA		#$AA
   306 00:F63D: 16 18 F6      	JMP		L_Dis_Digit34
   307                        L_Flash_Digit56:
   308 00:F640: 53 AA         	LDA		#$AA
   309 00:F642: 16 1C F6      	JMP		L_Dis_Digit56
   310                        
   311                        L_Flash_Digit23:
   312 00:F645: 53 AA         	LDA		#$AA
   313 00:F647: 5E 07         	LDX		#lcd_d2
   314 00:F649: 16 1C F6      	JMP		F_Dis_2Digit
   315                        ;============================================================
   316                        ;============================================================
   317                        Lcd_1_table:
   318 00:F64C: 00            	.BYTE 	00h	;0
   319 00:F64D: 06            	.BYTE	06h	;1
   320 00:F64E: 03            	.BYTE	03h	;2
   321                        
   322                        
   323                        
   324                        
   325                        ;============================================================
   325                        
   145                        .include    Time\Dis_number.asm
     1                        L_DisCol_Prog:
     2 00:F64F: 15 A8 F5      	JSR		F_DisCol
     3 00:F652: 09            	RTS
     4                        
     5                        L_Dis_TimeMin:
     6 00:F653: 73 A7         	LDA		R_Time_Min
     7 00:F655: 15 18 F6      	JSR		L_Dis_Digit34
     8 00:F658: 09            	RTS
     9                        
    10                        L_Key5_DisHR:
    11 00:F659: 15 AD F5      	JSR		F_ClrCol
    12 00:F65C: 15 D3 F5      	JSR		F_ClrAm
    13 00:F65F: 15 DD F5      	JSR		F_ClrPm
    14 00:F662: 3D 9A 1F      	BBS5	Sys_Flag_B,L_Key5_Dis12HR
    15 00:F665: 17 00         	BRA		L_Key5_Dis24HR
    16                        
    17                        L_Key5_Dis24HR:
    18 00:F667: 53 02         	LDA		#2
    19 00:F669: 5E 00         	LDX		#lcd_d1
    20 00:F66B: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    21 00:F66E: 53 04         	LDA		#4
    22 00:F670: 5E 07         	LDX		#lcd_d2
    23 00:F672: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    24 00:F675: 53 76         	LDA		#76H
    25 00:F677: 5E 0E         	LDX		#lcd_d3
    26 00:F679: 15 22 F1      	JSR		F_DispPro
    27 00:F67C: 53 50         	LDA		#50H
    28 00:F67E: 5E 15         	LDX		#lcd_d4
    29 00:F680: 15 22 F1      	JSR		F_DispPro
    30 00:F683: 09            	RTS
    31                        
    32                        L_Key5_Dis12HR:
    33 00:F684: 53 01         	LDA		#1
    34 00:F686: 5E 00         	LDX		#lcd_d1
    35 00:F688: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    36 00:F68B: 53 02         	LDA		#2
    37 00:F68D: 5E 07         	LDX		#lcd_d2
    38 00:F68F: 15 1A F1      	JSR		L_Dis_8Bit_DigitDot_Prog
    39 00:F692: 53 76         	LDA		#76H
    40 00:F694: 5E 0E         	LDX		#lcd_d3
    41 00:F696: 15 22 F1      	JSR		F_DispPro
    42 00:F699: 53 50         	LDA		#50H
    43 00:F69B: 5E 15         	LDX		#lcd_d4
    44 00:F69D: 15 22 F1      	JSR		F_DispPro
    45 00:F6A0: 09            	RTS
    46                        
    47                        
    47                        
   146                        .include    Time\Time.asm
     1                        ;=====================================================
     2                        ; ;=====================================================
     3                        F_Update_Time_Prog:
     4 00:F6A1: 15 07 F7      	JSR		F_SecInc
     5 00:F6A4: 10 0A         	BCC		L_End_Update_Time_Prog
     6 00:F6A6: 15 FD F6      	JSR		F_MinInc
     7 00:F6A9: 10 05         	BCC		L_End_Update_Time_Prog
     8 00:F6AB: 15 F1 F6      	JSR		F_HrInc
     9 00:F6AE: 10 00         	BCC		L_End_Update_Time_Prog
    10                        
    11                        L_End_Update_Time_Prog:
    12 00:F6B0: 09            	RTS
    13                        ;====================================================
    14                        F_Update_STW_Prog:
    15 00:F6B1: 3B 9A 15      	BBS3	Sys_Flag_B,L_End_MAX_STW_Prog		;判断是否到结束(正计时最大值)
    16                        
    17 00:F6B4: 31 9A 15      	BBR1	Sys_Flag_B,L_End_Update_STW_Prog	;;判断计时是否暂停
    18 00:F6B7: 32 9A 1C      	BBR2	Sys_Flag_B,L_Update_STW_FORW_Prog	;;0：正计时/1：倒计时
    19 00:F6BA: 15 BE F6      	JSR		L_Update_CTW_FORW_Prog
    20 00:F6BD: 09            	RTS
    21                        
    22                        
    23                        ;;倒计时
    24                        L_Update_CTW_FORW_Prog:
    25 00:F6BE: 15 5D F7      	JSR		R_CtwDec_Sec
    26 00:F6C1: 11 05         	BCS		L_Update_CTW_FORW_End_Prog
    27 00:F6C3: 15 61 F7      	JSR		R_CtwDec_Min
    28 00:F6C6: 11 00         	BCS		L_Update_CTW_FORW_End_Prog
    29                        L_Update_CTW_FORW_End_Prog:
    30 00:F6C8: 09            	RTS
    31                        
    32                        L_End_MAX_STW_Prog:
    33 00:F6C9: 21 9A         	RMB1	Sys_Flag_B		;;正计时最大值，结束计时(暂停计时)
    34 00:F6CB: 09            	rts
    35                        L_End_Update_STW_Prog:
    36 00:F6CC: 73 AB         	LDA		R_Stw_Sec
    37 00:F6CE: 71 AC         	AND		R_Stw_Min
    38 00:F6D0: 12 01         	BNE		?CTW			;;min sec均为0时，为正计时
    39                        	; RMB2	Sys_Flag_B		;;标记正计时
    40 00:F6D2: 09            	RTS
    41                        ?CTW:
    42 00:F6D3: 2A 9A         	SMB2	Sys_Flag_B		;;标记倒计时
    43 00:F6D5: 09            	RTS
    44                        
    45                        ;;正计时
    46                        L_Update_STW_FORW_Prog:
    47 00:F6D6: 15 4D F7      	JSR		R_CtwInc_Sec
    48 00:F6D9: 10 05         	BCC		L_Update_STW_FORW_End_Prog
    49 00:F6DB: 15 51 F7      	JSR		R_CtwInc_Min
    50 00:F6DE: 10 00         	BCC		L_Update_STW_FORW_End_Prog
    51                        L_Update_STW_FORW_End_Prog:
    52                        	;对比正计时最大值
    53 00:F6E0: 73 AB         	LDA		R_Stw_Sec
    54 00:F6E2: 56 59         	CMP		#$59
    55 00:F6E4: 10 0A         	BCC		?RTS
    56 00:F6E6: 73 AC         	LDA		R_Stw_Min
    57 00:F6E8: 56 99         	CMP		#$99
    58 00:F6EA: 10 04         	BCC		?RTS
    59                        
    60 00:F6EC: 21 9A         	RMB1	Sys_Flag_B
    61 00:F6EE: 2B 9A         	SMB3	Sys_Flag_B		;;标记正计时达到99M59S
    62                        ?RTS:
    63 00:F6F0: 09            	RTS
    64                        ;====================================================
    65                        ; L_STWorCTW_Display:
    66                        ; 	; LDA		R_Stw_Sec
    67                        ; 	; BNE		?STW_Display
    68                        ; 	; LDA		R_Stw_Min
    69                        ; 	; BNE		?STW_Display
    70                        ; 	LDA		R_Stw_Sec
    71                        ; 	AND		R_Stw_Min
    72                        ; 	BNE		L_Update_CTW_FORW_Prog		;;倒
    73                        
    74                        ; 	JSR		L_Update_STW_FORW_Prog		;;正
    75                        ; 	RTS
    76                        
    77                        ; ?STW_Display:
    78                        ; 	JSR		L_Update_CTW_FORW_Prog		;;倒
    79                        ; 	RTS
    80                        ;====================================================
    81                        ;----------------------------------------------------
    82                        F_HrInc:
    83 00:F6F1: 5E 02         	LDX		#(R_Time_Hr-Time_str_Addr)
    84                        L_Inc_0_To_23_Prog:
    85                        L_Inc_To_24:
    86 00:F6F3: 53 23         	LDA		#$23
    87 00:F6F5: 17 14         	BRA		L_Inc_0_To_Any_Count_Prog
    88                        
    89                        F_HrDec:
    90 00:F6F7: 5E 02         	LDX		#(R_Time_Hr-Time_str_Addr)
    91 00:F6F9: 53 23         	LDA		#$23
    92 00:F6FB: 17 30         	BRA		L_Dec_To_0_Prog
    93                        
    94                        ; F_AlHrInc:	;注意范围
    95                        ; 	LDX		#(R_Al_Hr-Time_str_Addr)
    96                        ; 	LDA		#$23
    97                        ; 	; JMP		L_Inc_0_To_Any_Count_Prog
    98                        ; 	BRA		L_Inc_0_To_23_Prog
    99                        
   100                        ;----------------------------------------------------
   101                        F_MinInc:
   102 00:F6FD: 5E 00         	LDX		#(R_Time_Min-Time_str_Addr)
   103 00:F6FF: 17 08         	BRA		L_Inc_0_To_59_Prog
   104                        
   105                        F_MinDec:
   106 00:F701: 5E 00         	LDX		#(R_Time_Min-Time_str_Addr)
   107 00:F703: 53 59         	LDA		#$59
   108 00:F705: 17 26         	BRA		L_Dec_To_0_Prog
   109                        
   110                        ; F_MinSplDec:
   111                        ; 	LDX		#(R_Al_Min_Spl-Time_str_Addr)
   112                        ; 	LDA		#10
   113                        ; 	BRA		L_Dec_To_0_Prog
   114                        
   115                        ; F_SecSplDec:
   116                        ; 	LDX		#(R_Al_Sec_Spl-Time_str_Addr)
   117                        ; 	BRA		L_Dec_To_60_Prog
   118                        
   119                        
   120                        ; F_AlMinInc:
   121                        ; 	LDX		#(R_Al_Min-Time_str_Addr)
   122                        ; 	BRA		L_Inc_0_To_59_Prog
   123                        ; F_AlInc:
   124                        ; 	LDX		#(R_Al_Sec-Time_str_Addr)
   125                        ; 	BRA		L_Inc_0_To_59_Prog
   126                        
   127                        F_SecInc:
   128 00:F707: 5E 01         	LDX 	#(R_Time_Sec-Time_str_Addr)
   129                        L_Inc_0_To_59_Prog:
   130                        L_Inc_To_60:
   131 00:F709: 53 59         	LDA		#$59
   132                        L_Inc_0_To_Any_Count_Prog:
   133 00:F70B: 7F C3         	STA		P_Temp+1	;最大值
   134 00:F70D: 53 00         	LDA		#$00
   135                        L_Inc_Any_To_Any_Count_Prog:
   136 00:F70F: 7F C2         	STA		P_Temp		;最小值
   137 00:F711: 63 27 18      	LDA		Time_Addr,X	;P_Temp+1
   138 00:F714: 76 C3         	CMP		P_Temp+1	;Time_Addr,X
   139 00:F716: 11 0C         	BCS		L_Inc_Over
   140 00:F718: 04            	CLC
   141 00:F719: 02            	SED
   142 00:F71A: 63 27 18      	LDA		Time_Addr,X
   143 00:F71D: 54 01         	ADC		#1
   144 00:F71F: 6F 27 18      	STA		Time_Addr,X
   145 00:F722: 06            	CLD
   146 00:F723: 09            	RTS
   147                        L_Inc_Over:
   148 00:F724: 73 C2         	LDA		P_Temp
   149 00:F726: 6F 27 18      	STA		Time_Addr,X
   150 00:F729: 00            	SEC
   151 00:F72A: 09            	RTS
   152                        ;=====================================================
   153                        L_Dec_To_60_Prog:
   154 00:F72B: 53 59         	LDA		#$59
   155                        L_Dec_To_0_Prog:
   156 00:F72D: 7F C2         	STA		P_Temp
   157 00:F72F: 53 00         	LDA		#0
   158                        L_Dec_To_Anycount_Prog:
   159 00:F731: 00            	SEC
   160 00:F732: 65 27 18          SBC     Time_Addr,X
   161 00:F735: 13 0F         	BEQ		L_Dec_Over_Prog
   162 00:F737: 11 0D         	BCS		L_Dec_Over_Prog
   163                        
   164 00:F739: 00            	SEC
   165 00:F73A: 02            	SED
   166 00:F73B: 63 27 18      	LDA		Time_Addr,X
   167 00:F73E: 55 01         	SBC		#1
   168 00:F740: 6F 27 18      	STA		Time_Addr,X
   169 00:F743: 06            	CLD
   170 00:F744: 00            	SEC
   171 00:F745: 09            	RTS
   172                        L_Dec_Over_Prog:
   173 00:F746: 73 C2         	LDA		P_Temp
   174 00:F748: 6F 27 18      	STA		Time_Addr,X
   175 00:F74B: 04            	CLC
   176 00:F74C: 09            	RTS
   177                        ;=====================================================
   178                        R_CtwInc_Sec:
   179 00:F74D: 5E 04         	LDX		#(R_Stw_Sec-Time_str_Addr)
   180                        	; TXA
   181                        	; CLC
   182                        	; ADC		P_Temp+4
   183                        	; TAX
   184 00:F74F: 17 B8         	BRA		L_Inc_To_60
   185                        
   186                        R_CtwInc_Min:
   187 00:F751: 5E 05         	LDX		#(R_Stw_Min-Time_str_Addr)
   188 00:F753: 53 99         	LDA		#$99
   189                        	; TXA
   190                        	; CLC
   191                        	; ADC		P_Temp+4
   192                        	; TAX
   193 00:F755: 17 00         	BRA		L_Inc_0_To_99_Count_Prog
   194                        
   195                        L_Inc_0_To_99_Count_Prog:
   196 00:F757: 7F C3         	STA		P_Temp+1	;最大值
   197 00:F759: 53 00         	LDA		#$00
   198 00:F75B: 17 B2         	BRA		L_Inc_Any_To_Any_Count_Prog
   199                        
   200                        
   201                        ; F_StwHrInc:
   202                        ; 	LDX		#(R_Stw_Hr-Time_str_Addr)
   203                        ; 	TXA
   204                        ; 	CLC
   205                        ; 	ADC		P_Temp+4
   206                        ; 	TAX
   207                        ; 	LDA		#$23
   208                        ; 	BRA		L_Inc_0_To_Any_Count_Prog
   209                        ;-------------------------------------------------
   210                        
   211                        R_CtwDec_Sec:
   212 00:F75D: 5E 04         	LDX		#(R_Stw_Sec-Time_str_Addr)
   213                        	; TXA
   214                        	; CLC
   215                        	; ADC		P_Temp+4
   216                        	; TAX
   217 00:F75F: 17 CA         	BRA		L_Dec_To_60_Prog
   218                        
   219                        R_CtwDec_Min:
   220 00:F761: 5E 05         	LDX		#(R_Stw_Min-Time_str_Addr)
   221                        	; TXA
   222                        	; CLC
   223                        	; ADC		P_Temp+4
   224                        	; TAX
   225 00:F763: 17 C6         	BRA		L_Dec_To_60_Prog
   226                        
   227                        ; F_StwHrDec:
   228                        ; 	LDX		#(R_Stw_Hr-Time_str_Addr)
   229                        ; 	TXA
   230                        ; 	CLC
   231                        ; 	ADC		P_Temp+4
   232                        ; 	TAX
   233                        ; 	LDA		#$99
   234                        ; 	BRA		L_Dec_To_0_Prog
   235                        
   236                        ;-------------------------------------------------
   237                        
   238                        ; F_KeyIncSec:
   239                        ; 	JSR		F_SecInc
   240                        ; 	JSR		L_Dis_Time ;L_Dis_TimeSec
   241                        ; 	RTS
   242                        
   243                        ; F_KeyIncMin:
   244                        ; 	JSR		F_MinInc
   245                        ; 	JMP		L_Dis_Time ;L_Dis_TimeMin
   246                        ; F_KeyIncHr:
   247                        ; 	JSR		F_HrInc
   248                        ; 	LDA		R_Time_Hr
   249                        ; 	BNE		L_Exit_KeyIncHr
   250                        ; 	LDA		Sys_Flag_B
   251                        ; 	EOR		#BIT5
   252                        ; 	STA		Sys_Flag_B	;12hr/24hr
   253                        ; L_Exit_KeyIncHr:
   254                        ; 	JMP		L_Dis_Time ;L_Dis_TimeHr
   254                        
   147                        .include    Time\Dis_time.asm
     1                        ;==========================================
     2                        L_Dis_Time_Mode:
     3                        ;T_DisTimeSetTable:
     4                        ;	.word	L_Dis_TimeOrDate-1
     5                        ;	.word	L_Dis_Time-1
     6                        ;	.word	L_Dis_Time-1
     7                        ;	.word	L_Dis_Time-1
     8                        ;	.word	L_Dis_Date-1
     9                        ;	.word	L_Dis_Date-1
    10                        ;	.word	L_Dis_Date-1
    11                        
    12                        
    13                        L_Dis_Time:
    14 00:F765: 15 A8 F5      	JSR		F_DisCol
    15                        L_Dis_TimeHr:
    16 00:F768: 73 A9         	LDA		R_Time_Hr
    17 00:F76A: 16 6D F7      	JMP		L_Dis_Hr_Common
    18                        
    19                        L_Dis_Hr_Common:
    20 00:F76D: 7F C6         	STA		P_Temp+4
    21 00:F76F: 73 9A         	LDA		Sys_Flag_B
    22 00:F771: 51 20         	AND		#BIT5
    23 00:F773: 13 2B         	BEQ		L_Dis_TimeHr_24
    24 00:F775: 00            	SEC
    25 00:F776: 02            	SED
    26 00:F777: 73 C6         	LDA		P_Temp+4
    27 00:F779: 55 12         	SBC		#$12
    28 00:F77B: 06            	CLD
    29 00:F77C: 10 0E         	BCC		L_Dis_Hour_12AM
    30 00:F77E: 7F C6         	STA		P_Temp+4
    31 00:F780: 5E 1D         	LDX		#lcd_am
    32 00:F782: 15 65 F1      	JSR		F_ClrpSymbol
    33 00:F785: 5E 1E         	LDX		#lcd_pm
    34 00:F787: 15 5E F1      	JSR		F_DispSymbol
    35 00:F78A: 17 0A         	BRA		L_TimeHr_0To12
    36                        L_Dis_Hour_12AM:
    37 00:F78C: 5E 1D         	LDX		#lcd_am
    38 00:F78E: 15 5E F1      	JSR		F_DispSymbol
    39 00:F791: 5E 1E         	LDX		#lcd_pm
    40 00:F793: 15 65 F1      	JSR		F_ClrpSymbol
    41                        L_TimeHr_0To12:
    42 00:F796: 73 C6         	LDA		P_Temp+4
    43 00:F798: 12 10         	BNE		L_Dis_HourDate_Prog
    44 00:F79A: 53 12         	LDA		#$12
    45 00:F79C: 7F C6         	STA		P_Temp+4
    46 00:F79E: 17 0A         	BRA		L_Dis_HourDate_Prog
    47                        L_Dis_TimeHr_24:
    48 00:F7A0: 5E 1D         	LDX		#lcd_am
    49 00:F7A2: 15 65 F1      	JSR		F_ClrpSymbol
    50 00:F7A5: 5E 1E         	LDX		#lcd_pm
    51 00:F7A7: 15 65 F1      	JSR		F_ClrpSymbol
    52                        L_Dis_HourDate_Prog:
    53 00:F7AA: 15 B4 F7      	JSR		L_HighBitDealWith
    54 00:F7AD: 5E 00         	LDX		#lcd_d1
    55 00:F7AF: 73 C6         	LDA		P_Temp+4
    56 00:F7B1: 16 05 F6      	JMP		L_Dis_Digit12
    57                        
    58                        L_HighBitDealWith:
    59 00:F7B4: 73 C6         	LDA		P_Temp+4
    60 00:F7B6: 51 F0         	AND		#$F0
    61 00:F7B8: 12 06         	BNE		L_Exit_HighBitDealWith
    62                        
    63 00:F7BA: 73 C6         	LDA		P_Temp+4
    64 00:F7BC: 50 A0         	ORA		#$A0
    65 00:F7BE: 7F C6         	STA		P_Temp+4
    66                        L_Exit_HighBitDealWith:
    67 00:F7C0: 09            	RTS
    68                        ; ;=====================================================
    69                        ;L_TimeHrDealwith:
    70                        ;	lda		R_Time_Hr
    71                        ;	beq		Load12
    72                        ;	cmp		#$12
    73                        ;	beq		L_End_TimeHrDealwith
    74                        ;	bcc		L_End_TimeHrDealwith
    75                        ;	sec
    76                        ;	sed
    77                        ;	sbc		#$12
    78                        ;	CLD
    79                        ;	rts
    80                        ;Load12:
    81                        ;	lda		#$12
    82                        ;L_End_TimeHrDealwith:
    83                        ;	rts
    84                        ; ;=====================================================
    85                        ; ;L_Dis_TimeOrDate:
    86                        ; ;	LDA		Sys_Flag_B
    87                        ; ;	AND		#BIT1
    88                        ; ;	BEQ		L_Dis_Time
    89                        ; ;;=====================================================
    90                        ; ;L_Dis_Date:
    91                        ; ;	LDX		#lcd_date
    92                        ; ;	JSR		F_DispSymbol
    93                        ; ;
    94                        ; ;	JSR		L_Dis_TimeDay
    95                        ; ;	JMP		L_Dis_TimeMonth
    96                        ; ;=====================================================
    97                        ; L_Dis_TimeSec:
    98                        ; 	LDA		R_Time_Sec
    99                        ; 	JMP		L_Dis_Digit_TimeSec
   100                        
   101                        ; L_Dis_TimeMin:
   102                        ; 	LDA		R_Time_Min
   103                        ; 	JMP		L_Dis_Digit_TimeMin
   104                        ;
   105                        ;L_Dis_TimeDay:
   106                        ;	LDA		R_Day
   107                        ;	PHA
   108                        ;	AND		#$F0
   109                        ;	BNE		L_Skip_Dis_TimeDay
   110                        ;;	LDA		R_Day
   111                        ;	PLA
   112                        ;	ORA		#$A0
   113                        ;	JMP		L_Dis_Digit_TimeDay
   114                        ;L_Skip_Dis_TimeDay:
   115                        ;;	LDA		R_Day
   116                        ;	PLA
   117                        ;	JMP		L_Dis_Digit_TimeDay
   118                        ;
   119                        ;L_Dis_TimeMonth:
   120                        ;	LDA		R_Month
   121                        ;	JMP		L_Dis_Digit_TimeMonth
   122                        
   123                        ;L_Dis_TimeYear:
   124                        ;	LDA		R_Year
   125                        ;	JMP		L_Dis_Digit_TimeYear
   126                        ;===============================================
   127                        ;F_JudgeDisWeek:
   128                        ;;	LDA		R_Mode
   129                        ;;	BNE		F_DisAllWeek
   130                        ;;	LDA		R_Set
   131                        ;;	BEQ		F_DisWeek
   132                        ;;	CMP		#4
   133                        ;;	BCC		F_DisAllWeek
   134                        ;F_DisWeek:
   135                        ;	LDX		R_Week
   136                        ;	LDA		TabWeek,X
   137                        ;L_DisWeek_Com:
   138                        ;	LDX		#lcd_Week
   139                        ;	JMP		F_DispPro
   140                        ;TabWeek:
   141                        ;	.BYTE	$01,$02,$04,$08,$10,$20,$40,$01
   142                        ;
   143                        ;;F_DisAllWeek:
   144                        ;;	LDA		#$7F
   145                        ;;	LDX		#lcd_Week
   146                        ;;	JMP		F_DispPro
   147                        ;
   148                        ;L_FlashWeek:
   149                        ;	LDA		#$00
   150                        ;	BRA		L_DisWeek_Com
   151                        ;===============================================
   151                        
   148                        ; .include    stw\Stw.asm
   149                        ; .include    stw\Dis_stw.asm
   150                        ; .include    Day_Ctw\Dayctw.asm
   151                        ; .include    Day_Ctw\Dis_Day.asm
   152                        ; .include    Alarm\Al.asm
   153                        ; .include    Alarm\Dis_al.asm
   154                        ; .include    Test\Test.asm
   155                        ;.include    Time\Tool.asm
   156                        
   157                        
   158                        ;--------------------------------------------------------
   159                        ; ISR
   160                        ;--------------------------------------------------------
   161                        V_IRQ:
   162 00:F7C1: 0A                PHA
   163 00:F7C2: 1C                TXA
   164 00:F7C3: 0A                PHA
   165 00:F7C4: 73 0E             LDA     P_IER
   166 00:F7C6: 71 0F             AND     P_IFR
   167 00:F7C8: 7F 98             STA     R_Int_Backup
   168                        ;   AND     #$01
   169                        ;   BNE     L_Div_IRQ_Prog
   170                        ;   LDA     R_Int_Backup
   171                        ;   AND     #$02
   172                        ;   BNE     L_Timer0_IRQ_Prog
   173                        ;   LDA     R_Int_Backup
   174 00:F7CA: 51 04             AND     #$04
   175 00:F7CC: 12 19             BNE     L_Timer1_IRQ_Prog
   176 00:F7CE: 73 98             LDA     R_Int_Backup
   177 00:F7D0: 51 10             AND     #$10
   178 00:F7D2: 12 1E             BNE     L_PA_IRQ_Prog
   179 00:F7D4: 73 98             LDA     R_Int_Backup
   180 00:F7D6: 51 40             AND     #$40
   181 00:F7D8: 12 21             BNE     L_LCD_IRQ_Prog
   182 00:F7DA: 16 03 F8          JMP     L_End_IRQ_Prog
   183                        L_Div_IRQ_Prog:
   184 00:F7DD: 20 0F             RMB0    P_IFR
   185 00:F7DF: 16 03 F8          JMP     L_End_IRQ_Prog
   186                        
   187                        L_Timer0_IRQ_Prog:
   188 00:F7E2: 21 0F             RMB1    P_IFR
   189 00:F7E4: 16 03 F8          JMP     L_End_IRQ_Prog
   190                        
   191                        L_Timer1_IRQ_Prog:
   192 00:F7E7: 22 0F             RMB2    P_IFR
   193                        ;   SMB0    Sys_Flag_A      ;Half Second Flag
   194                        
   195 00:F7E9: 73 99             LDA     Sys_Flag_A
   196 00:F7EB: 50 01             ORA     #BIT0               ;2hz
   197 00:F7ED: 7F 99             STA     Sys_Flag_A
   198 00:F7EF: 16 03 F8          JMP     L_End_IRQ_Prog
   199                        
   200                        L_PA_IRQ_Prog:
   201 00:F7F2: 24 0F             RMB4    P_IFR
   202                            DIS_PA_IRQ
+  202 00:F7F4: 24 0E          RMB4 P_IER
   203                            EN_LCD_IRQ
+  203 00:F7F6: 2E 0E          SMB6 P_IER
   204 00:F7F8: 16 03 F8          JMP     L_End_IRQ_Prog
   205                        
   206                        L_LCD_IRQ_Prog:
   207 00:F7FB: 26 0F             RMB6    P_IFR
   208                        ;   SMB2    Sys_Flag_A
   209 00:F7FD: 73 99             LDA     Sys_Flag_A
   210 00:F7FF: 50 04             ORA     #BIT2
   211 00:F801: 7F 99             STA     Sys_Flag_A      ;32HZ
   212                        L_End_IRQ_Prog:
   213 00:F803: 3A 0F E1          BBS2    P_IFR,L_Timer1_IRQ_Prog
   214 00:F806: 0C                PLA
   215 00:F807: 1B                TAX
   216 00:F808: 0C                PLA
   217 00:F809: 08                RTI
   218                        ;--------------------------------------------------------
   219                        ; Interrupt vector
   220                        ;--------------------------------------------------------
   221 00:F80A: 1A 1A 1A 1A       .BLKB   $FFD5-$,$1A
   221 00:F80A: 1A 1A 1A 1A   
   221 00:F80A: 1A 1A 1A 1A   
   222                            .ORG    0FFD5H
   223 00:FFD5: 16 00 F0          JMP     V_RESET
   224 00:FFD8: FF FF FF FF       .BLKB   $FFFF-$,$FF
   224 00:FFD8: FF FF FF FF   
   224 00:FFD8: FF FF FF FF   
   225                            .ORG    0FFF8H
   226 00:FFF8: B7                DB      10110111B      ;;bit7=1 bit6=0  bit3=0
   227                            ; DB      10111111B   ;bit6=1:PB23 CMOS L;BIT0=1 Unprotected
   228                        
   229                        
   230                            .ORG    0FFFCH
   231 00:FFFC: 00 F0             DW      V_RESET
   232 00:FFFE: C1 F7             DW      V_IRQ
   233                            .ENDS
   234                             END

 --------------------
      Warnings:0
      Errors  :0
